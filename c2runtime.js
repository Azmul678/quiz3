// Generated by Construct 3, the game and app creator :: https://www.construct.net
'use strict';var cr=window.cr={};cr.plugins_={};cr.behaviors={};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});
(function(){function b(e,u){this.x=e;this.y=u;cr.seal(this)}function k(e,u,F,H){this.set(e,u,F,H);cr.seal(this)}function v(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function A(e,u,F,H){e<u?F<H?(G=e<F?e:F,M=u>H?u:H):(G=e<H?e:H,M=u>F?u:F):F<H?(G=u<F?u:F,M=e>H?e:H):(G=u<H?u:H,M=e>F?e:F)}function J(){this.items=this.s=null;this.item_count=0;y&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function K(e){N[Q++]=e}function n(){this.sum=
this.t=this.y=this.c=0;cr.seal(this)}function a(e,u){e||(e=[0,0,1,0,1,1,0,1]);this.pts_cache=[];this.bboxBottom=this.bboxRight=this.bboxTop=this.bboxLeft=0;this.convexpolys=null;this.enabled="undefined"===typeof u?!0:u;this.set_pts(e);cr.seal(this)}function c(e,u){this.cellwidth=e;this.cellheight=u;this.cells={}}function g(e,u){this.cellwidth=e;this.cellheight=u;this.cells={}}function p(e,u,F){c.prototype.totalCellCount++;if(d.length){var H=d.pop();H.grid=e;H.x=u;H.y=F;return H}return new cr.GridCell(e,
u,F)}function m(e,u,F){this.grid=e;this.x=u;this.y=F;this.objects=new cr.ObjectSet}function t(e,u,F){g.prototype.totalCellCount++;if(h.length){var H=h.pop();H.grid=e;H.x=u;H.y=F;return H}return new cr.RenderCell(e,u,F)}function D(e,u,F){this.grid=e;this.x=u;this.y=F;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function z(e,u){return e.zindex-u.zindex}cr.logexport=function(e){window.console&&window.console.log&&window.console.log(e)};cr.logerror=
function(e){window.console&&window.console.error&&window.console.error(e)};cr.seal=function(e){return e};cr.freeze=function(e){return e};cr.is_undefined=function(e){return"undefined"===typeof e};cr.is_number=function(e){return"number"===typeof e};cr.is_string=function(e){return"string"===typeof e};cr.isPOT=function(e){return 0<e&&0===(e-1&e)};cr.nextHighestPowerOfTwo=function(e){--e;for(var u=1;32>u;u<<=1)e|=e>>u;return e+1};cr.abs=function(e){return 0>e?-e:e};cr.max=function(e,u){return e>u?e:u};
cr.min=function(e,u){return e<u?e:u};cr.PI=Math.PI;cr.round=function(e){return e+.5|0};cr.floor=function(e){return 0<=e?e|0:(e|0)-1};cr.ceil=function(e){var u=e|0;return u===e?u:u+1};b.prototype.offset=function(e,u){this.x+=e;this.y+=u;return this};b.prototype.mul=function(e,u){this.x*=e;this.y*=u;return this};cr.vector2=b;cr.segments_intersect=function(e,u,F,H,R,S,V,T){if(e<F){var Z=e;var aa=F}else Z=F,aa=e;if(R<V){var f=R;var q=V}else f=V,q=R;if(aa<f||Z>q)return!1;u<H?(Z=u,aa=H):(Z=H,aa=u);S<T?
(f=S,q=T):(f=T,q=S);if(aa<f||Z>q)return!1;aa=R-e+V-F;Z=S-u+T-H;e=F-e;u=H-u;R=V-R;S=T-S;T=cr.abs(u*R-S*e);return cr.abs(R*Z-S*aa)>T?!1:cr.abs(e*Z-u*aa)<=T};k.prototype.set=function(e,u,F,H){this.left=e;this.top=u;this.right=F;this.bottom=H};k.prototype.copy=function(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom};k.prototype.width=function(){return this.right-this.left};k.prototype.height=function(){return this.bottom-this.top};k.prototype.offset=function(e,u){this.left+=
e;this.top+=u;this.right+=e;this.bottom+=u;return this};k.prototype.normalize=function(){if(this.left>this.right){var e=this.left;this.left=this.right;this.right=e}this.top>this.bottom&&(e=this.top,this.top=this.bottom,this.bottom=e)};k.prototype.intersects_rect=function(e){return!(e.right<this.left||e.bottom<this.top||e.left>this.right||e.top>this.bottom)};k.prototype.intersects_rect_off=function(e,u,F){return!(e.right+u<this.left||e.bottom+F<this.top||e.left+u>this.right||e.top+F>this.bottom)};
k.prototype.contains_pt=function(e,u){return e>=this.left&&e<=this.right&&u>=this.top&&u<=this.bottom};k.prototype.equals=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom};cr.rect=k;v.prototype.set_from_rect=function(e){this.tlx=e.left;this.tly=e.top;this.trx=e.right;this.try_=e.top;this.brx=e.right;this.bry=e.bottom;this.blx=e.left;this.bly=e.bottom};v.prototype.set_from_rotated_rect=function(e,u){if(0===u)this.set_from_rect(e);else{var F=Math.sin(u),
H=Math.cos(u);u=e.left*F;var R=e.top*F,S=e.right*F;F*=e.bottom;var V=e.left*H,T=e.top*H,Z=e.right*H;e=e.bottom*H;this.tlx=V-R;this.tly=T+u;this.trx=Z-R;this.try_=T+S;this.brx=Z-F;this.bry=e+S;this.blx=V-F;this.bly=e+u}};v.prototype.offset=function(e,u){this.tlx+=e;this.tly+=u;this.trx+=e;this.try_+=u;this.brx+=e;this.bry+=u;this.blx+=e;this.bly+=u;return this};var G=0,M=0;v.prototype.bounding_box=function(e){A(this.tlx,this.trx,this.brx,this.blx);e.left=G;e.right=M;A(this.tly,this.try_,this.bry,this.bly);
e.top=G;e.bottom=M};v.prototype.contains_pt=function(e,u){var F=this.tlx,H=this.tly,R=this.trx-F,S=this.try_-H,V=this.brx-F,T=this.bry-H;e-=F;u-=H;var Z=R*R+S*S,aa=R*V+S*T;S=R*e+S*u;var f=V*V+T*T,q=V*e+T*u,x=1/(Z*f-aa*aa);R=(f*S-aa*q)*x;Z=(Z*q-aa*S)*x;if(0<=R&&0<Z&&1>R+Z)return!0;R=this.blx-F;S=this.bly-H;Z=R*R+S*S;aa=R*V+S*T;S=R*e+S*u;x=1/(Z*f-aa*aa);R=(f*S-aa*q)*x;Z=(Z*q-aa*S)*x;return 0<=R&&0<Z&&1>R+Z};v.prototype.at=function(e,u){if(u)switch(e){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;
case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(e){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};v.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};v.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};v.prototype.intersects_segment=function(e,u,F,H){if(this.contains_pt(e,u)||this.contains_pt(F,H))return!0;var R;for(R=0;4>R;R++){var S=
this.at(R,!0);var V=this.at(R,!1);var T=this.at(R+1,!0);var Z=this.at(R+1,!1);if(cr.segments_intersect(e,u,F,H,S,V,T,Z))return!0}return!1};v.prototype.intersects_quad=function(e){var u=e.midX(),F=e.midY();if(this.contains_pt(u,F))return!0;u=this.midX();F=this.midY();if(e.contains_pt(u,F))return!0;var H,R;for(H=0;4>H;H++)for(R=0;4>R;R++){u=this.at(H,!0);F=this.at(H,!1);var S=this.at(H+1,!0);var V=this.at(H+1,!1);var T=e.at(R,!0);var Z=e.at(R,!1);var aa=e.at(R+1,!0);var f=e.at(R+1,!1);if(cr.segments_intersect(u,
F,S,V,T,Z,aa,f))return!0}return!1};cr.quad=v;cr.RGB=function(e,u,F){return Math.max(Math.min(e,255),0)|Math.max(Math.min(u,255),0)<<8|Math.max(Math.min(F,255),0)<<16};cr.RGBAEx=function(e,u,F,H){e=cr.clamp(Math.floor(1024*e),-8192,8191);u=cr.clamp(Math.floor(1024*u),-8192,8191);F=cr.clamp(Math.floor(1024*F),-8192,8191);H=cr.clamp(Math.floor(1024*H),0,1024);0>e&&(e+=16384);0>u&&(u+=16384);0>F&&(F+=16384);return-(274877906944*e+16777216*u+1024*F+H)};cr.RGBEx=function(e,u,F){return cr.RGBAEx(e,u,F,1)};
cr.GetRValue=function(e){if(0<=e)return(e&255)/255;e=Math.floor(-e/274877906944);8191<e&&(e-=16384);return e/1024};cr.GetGValue=function(e){if(0<=e)return((e&65280)>>8)/255;e=Math.floor(-e%274877906944/16777216);8191<e&&(e-=16384);return e/1024};cr.GetBValue=function(e){if(0<=e)return((e&16711680)>>16)/255;e=Math.floor(-e%16777216/1024);8191<e&&(e-=16384);return e/1024};cr.GetAValue=function(e){return 0===e&&0>1/e?0:0<=e?1:Math.floor(-e%1024)/1024};cr.shallowCopy=function(e,u,F){for(var H in u)u.hasOwnProperty(H)&&
(e[H]=u[H]);return e};cr.arrayRemove=function(e,u){var F;u=cr.floor(u);if(!(0>u||u>=e.length)){for(F=e.length-1;u<F;u++)e[u]=e[u+1];cr.truncateArray(e,F)}};cr.truncateArray=function(e,u){e.length=u};cr.clearArray=function(e){cr.truncateArray(e,0)};cr.shallowAssignArray=function(e,u){cr.clearArray(e);var F;var H=0;for(F=u.length;H<F;++H)e[H]=u[H]};cr.appendArray=function(e,u){e.push.apply(e,u)};cr.fastIndexOf=function(e,u){var F;var H=0;for(F=e.length;H<F;++H)if(e[H]===u)return H;return-1};cr.arrayFindRemove=
function(e,u){u=cr.fastIndexOf(e,u);-1!==u&&cr.arrayRemove(e,u)};cr.clamp=function(e,u,F){return e<u?u:e>F?F:e};cr.to_radians=function(e){return e/(180/cr.PI)};cr.to_degrees=function(e){return 180/cr.PI*e};cr.clamp_angle_degrees=function(e){e%=360;0>e&&(e+=360);return e};cr.clamp_angle=function(e){e%=2*cr.PI;0>e&&(e+=2*cr.PI);return e};cr.to_clamped_degrees=function(e){return cr.clamp_angle_degrees(cr.to_degrees(e))};cr.to_clamped_radians=function(e){return cr.clamp_angle(cr.to_radians(e))};cr.angleTo=
function(e,u,F,H){return Math.atan2(H-u,F-e)};cr.angleDiff=function(e,u){if(e===u)return 0;e=Math.sin(e)*Math.sin(u)+Math.cos(e)*Math.cos(u);return 1<=e?0:-1>=e?cr.PI:Math.acos(e)};cr.angleRotate=function(e,u,F){var H=Math.sin(e),R=Math.cos(e),S=Math.sin(u),V=Math.cos(u);return Math.acos(H*S+R*V)>F?0<R*S-H*V?cr.clamp_angle(e+F):cr.clamp_angle(e-F):cr.clamp_angle(u)};cr.angleClockwise=function(e,u){return 0>=Math.cos(e)*Math.sin(u)-Math.sin(e)*Math.cos(u)};cr.rotatePtAround=function(e,u,F,H,R,S){if(0===
F)return S?e:u;var V=Math.sin(F);F=Math.cos(F);e-=H;u-=R;var T=e*V;e=e*F-u*V;return S?e+H:u*F+T+R};cr.distanceTo=function(e,u,F,H){e=F-e;u=H-u;return Math.sqrt(e*e+u*u)};cr.xor=function(e,u){return!e!==!u};cr.lerp=function(e,u,F){return e+(u-e)*F};cr.unlerp=function(e,u,F){return e===u?0:(F-e)/(u-e)};cr.anglelerp=function(e,u,F){var H=cr.angleDiff(e,u);return cr.angleClockwise(u,e)?e+H*F:e-H*F};cr.qarp=function(e,u,F,H){return cr.lerp(cr.lerp(e,u,H),cr.lerp(u,F,H),H)};cr.cubic=function(e,u,F,H,R){return cr.lerp(cr.qarp(e,
u,F,R),cr.qarp(u,F,H,R),R)};cr.cosp=function(e,u,F){return(e+u+(e-u)*Math.cos(F*Math.PI))/2};cr.hasAnyOwnProperty=function(e){for(var u in e)if(e.hasOwnProperty(u))return!0;return!1};cr.wipe=function(e){for(var u in e)e.hasOwnProperty(u)&&delete e[u]};var l=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var e=window.performance;if("undefined"!==typeof e.now)return e.now();if("undefined"!==typeof e.webkitNow)return e.webkitNow();if("undefined"!==typeof e.mozNow)return e.mozNow();
if("undefined"!==typeof e.msNow)return e.msNow()}return Date.now()-l};var r=!1;"undefined"!==typeof window&&(r=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),!r&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var y="undefined"!==typeof Set&&"undefined"!==typeof Set.prototype.forEach;J.prototype.contains=function(e){return this.isEmpty()?!1:y?this.s.has(e):this.items&&this.items.hasOwnProperty(e)};J.prototype.add=function(e){if(y)this.s.has(e)||
(this.s.add(e),this.cache_valid=!1);else{var u=e.toString(),F=this.items;F?F.hasOwnProperty(u)||(F[u]=e,this.item_count++,this.cache_valid=!1):(this.items={},this.items[u]=e,this.item_count=1,this.cache_valid=!1)}};J.prototype.remove=function(e){if(!this.isEmpty())if(y)this.s.has(e)&&(this.s["delete"](e),this.cache_valid=!1);else if(this.items){e=e.toString();var u=this.items;u.hasOwnProperty(e)&&(delete u[e],this.item_count--,this.cache_valid=!1)}};J.prototype.clear=function(){this.isEmpty()||(y?
this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};J.prototype.isEmpty=function(){return 0===this.count()};J.prototype.count=function(){return y?this.s.size:this.item_count};var N=null,Q=0;J.prototype.update_cache=function(){if(!this.cache_valid){if(y)cr.clearArray(this.values_cache),N=this.values_cache,Q=0,this.s.forEach(K),N=null,Q=0;else{var e=this.values_cache;cr.clearArray(e);var u,F=0,H=this.items;if(H)for(u in H)H.hasOwnProperty(u)&&(e[F++]=
H[u])}this.cache_valid=!0}};J.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=J;var E=new cr.ObjectSet;cr.removeArrayDuplicates=function(e){var u;var F=0;for(u=e.length;F<u;++F)E.add(e[F]);cr.shallowAssignArray(e,E.valuesRef());E.clear()};cr.arrayRemoveAllFromObjectSet=function(e,u){y?cr.arrayRemoveAll_set(e,u.s):cr.arrayRemoveAll_arr(e,u.valuesRef())};cr.arrayRemoveAll_set=function(e,u){var F,H;var R=F=0;for(H=e.length;F<H;++F){var S=e[F];u.has(S)||(e[R++]=
S)}cr.truncateArray(e,R)};cr.arrayRemoveAll_arr=function(e,u){var F,H;var R=F=0;for(H=e.length;F<H;++F){var S=e[F];-1===cr.fastIndexOf(u,S)&&(e[R++]=S)}cr.truncateArray(e,R)};n.prototype.add=function(e){this.y=e-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};n.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=n;cr.regexp_escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};a.prototype.set_pts=function(e){this.pts_array=e;this.pts_count=
e.length/2;this.pts_cache.length=e.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};a.prototype.is_empty=function(){return!this.pts_array.length};a.prototype.update_bbox=function(){for(var e=this.pts_cache,u=e[0],F=u,H=e[1],R=H,S,V,T=1,Z=this.pts_count;T<Z;++T)V=2*T,S=e[V],V=e[V+1],S<u&&(u=S),S>F&&(F=S),V<H&&(H=V),V>R&&(R=V);this.bboxLeft=u;this.bboxRight=F;this.bboxTop=H;this.bboxBottom=R};a.prototype.set_from_rect=function(e,u,F){this.pts_cache.length=8;this.pts_count=4;var H=this.pts_cache;
H[0]=e.left-u;H[1]=e.top-F;H[2]=e.right-u;H[3]=e.top-F;H[4]=e.right-u;H[5]=e.bottom-F;H[6]=e.left-u;H[7]=e.bottom-F;this.cache_width=e.right-e.left;this.cache_height=e.bottom-e.top;this.update_bbox()};a.prototype.set_from_quad=function(e,u,F,H,R){this.pts_cache.length=8;this.pts_count=4;var S=this.pts_cache;S[0]=e.tlx-u;S[1]=e.tly-F;S[2]=e.trx-u;S[3]=e.try_-F;S[4]=e.brx-u;S[5]=e.bry-F;S[6]=e.blx-u;S[7]=e.bly-F;this.cache_width=H;this.cache_height=R;this.update_bbox()};a.prototype.set_from_poly=function(e){this.pts_count=
e.pts_count;cr.shallowAssignArray(this.pts_cache,e.pts_cache);this.bboxLeft=e.bboxLeft;this.bboxTop-e.bboxTop;this.bboxRight=e.bboxRight;this.bboxBottom=e.bboxBottom};a.prototype.cache_poly=function(e,u,F){if(this.cache_width!==e||this.cache_height!==u||this.cache_angle!==F){this.cache_width=e;this.cache_height=u;this.cache_angle=F;var H,R=0,S=1,V=this.pts_array,T=this.pts_cache;0!==F&&(R=Math.sin(F),S=Math.cos(F));F=0;for(H=this.pts_count;F<H;F++){var Z=2*F;var aa=Z+1;var f=V[Z]*e;var q=V[aa]*u;
T[Z]=f*S-q*R;T[aa]=q*S+f*R}this.update_bbox()}};a.prototype.contains_pt=function(e,u){var F=this.pts_cache;if(e===F[0]&&u===F[1])return!0;var H,R=this.pts_count,S=this.bboxLeft-110,V=this.bboxTop-101,T=this.bboxRight+131,Z=this.bboxBottom+120,aa=0,f=0;for(H=0;H<R;H++){var q=2*H;var x=(H+1)%R*2;var C=F[q];q=F[q+1];var w=F[x];x=F[x+1];cr.segments_intersect(S,V,e,u,C,q,w,x)&&aa++;cr.segments_intersect(T,Z,e,u,C,q,w,x)&&f++}return 1===aa%2||1===f%2};a.prototype.intersects_poly=function(e,u,F){var H=e.pts_cache,
R=this.pts_cache;if(this.contains_pt(H[0]+u,H[1]+F)||e.contains_pt(R[0]-u,R[1]-F))return!0;var S,V;var T=0;for(S=this.pts_count;T<S;T++){var Z=2*T;var aa=(T+1)%S*2;var f=R[Z];Z=R[Z+1];var q=R[aa];var x=R[aa+1];aa=0;for(V=e.pts_count;aa<V;aa++){var C=2*aa;var w=(aa+1)%V*2;var I=H[C]+u;C=H[C+1]+F;var L=H[w]+u;w=H[w+1]+F;if(cr.segments_intersect(f,Z,q,x,I,C,L,w))return!0}}return!1};a.prototype.intersects_segment=function(e,u,F,H,R,S){var V=this.pts_cache;if(this.contains_pt(F-e,H-u))return!0;var T;var Z=
0;for(T=this.pts_count;Z<T;Z++){var aa=2*Z;var f=(Z+1)%T*2;var q=V[aa]+e;aa=V[aa+1]+u;var x=V[f]+e;f=V[f+1]+u;if(cr.segments_intersect(F,H,R,S,q,aa,x,f))return!0}return!1};a.prototype.mirror=function(e){var u;var F=0;for(u=this.pts_count;F<u;++F){var H=2*F;this.pts_cache[H]=2*e-this.pts_cache[H]}};a.prototype.flip=function(e){var u;var F=0;for(u=this.pts_count;F<u;++F){var H=2*F+1;this.pts_cache[H]=2*e-this.pts_cache[H]}};a.prototype.diag=function(){var e;var u=0;for(e=this.pts_count;u<e;++u){var F=
2*u;var H=F+1;var R=this.pts_cache[F];this.pts_cache[F]=this.pts_cache[H];this.pts_cache[H]=R}};a.prototype.is_enabled=function(){return this.enabled};cr.CollisionPoly=a;c.prototype.totalCellCount=0;c.prototype.getCell=function(e,u,F){var H=this.cells[e];return H?(H=H[u])?H:F?(H=p(this,e,u),this.cells[e][u]=H):null:F?(H=p(this,e,u),this.cells[e]={},this.cells[e][u]=H):null};c.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};c.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)};
c.prototype.update=function(e,u,F){var H,R,S;if(u){var V=u.left;for(H=u.right;V<=H;++V){var T=u.top;for(R=u.bottom;T<=R;++T)if(!F||!F.contains_pt(V,T))if(S=this.getCell(V,T,!1))S.remove(e),S.isEmpty()&&(c.prototype.totalCellCount--,S.objects.clear(),1E3>d.length&&d.push(S),this.cells[V][T]=null)}}if(F)for(V=F.left,H=F.right;V<=H;++V)for(T=F.top,R=F.bottom;T<=R;++T)u&&u.contains_pt(V,T)||this.getCell(V,T,!0).insert(e)};c.prototype.queryRange=function(e,u){var F,H;var R=this.XToCell(e.left);var S=this.YToCell(e.top);
var V=this.XToCell(e.right);for(F=this.YToCell(e.bottom);R<=V;++R)for(e=S;e<=F;++e)(H=this.getCell(R,e,!1))&&H.dump(u)};cr.SparseGrid=c;g.prototype.totalCellCount=0;g.prototype.getCell=function(e,u,F){var H=this.cells[e];return H?(H=H[u])?H:F?(H=t(this,e,u),this.cells[e][u]=H):null:F?(H=t(this,e,u),this.cells[e]={},this.cells[e][u]=H):null};g.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};g.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)};g.prototype.update=function(e,
u,F){var H,R,S;if(u){var V=u.left;for(H=u.right;V<=H;++V){var T=u.top;for(R=u.bottom;T<=R;++T)if(!F||!F.contains_pt(V,T))if(S=this.getCell(V,T,!1))S.remove(e),S.isEmpty()&&(g.prototype.totalCellCount--,S.reset(),1E3>h.length&&h.push(S),this.cells[V][T]=null)}}if(F)for(V=F.left,H=F.right;V<=H;++V)for(T=F.top,R=F.bottom;T<=R;++T)u&&u.contains_pt(V,T)||this.getCell(V,T,!0).insert(e)};g.prototype.queryRange=function(e,u,F,H,R){var S,V;e=this.XToCell(e);u=this.YToCell(u);F=this.XToCell(F);for(S=this.YToCell(H);e<=
F;++e)for(H=u;H<=S;++H)(V=this.getCell(e,H,!1))&&V.dump(R)};g.prototype.markRangeChanged=function(e){var u,F;var H=e.left;var R=e.top;var S=e.right;for(u=e.bottom;H<=S;++H)for(e=R;e<=u;++e)if(F=this.getCell(H,e,!1))F.is_sorted=!1};cr.RenderGrid=g;var d=[];m.prototype.isEmpty=function(){return this.objects.isEmpty()};m.prototype.insert=function(e){this.objects.add(e)};m.prototype.remove=function(e){this.objects.remove(e)};m.prototype.dump=function(e){cr.appendArray(e,this.objects.valuesRef())};cr.GridCell=
m;var h=[];D.prototype.isEmpty=function(){if(!this.objects.length)return!0;if(this.objects.length>this.pending_removal.count())return!1;this.flush_pending();return!0};D.prototype.insert=function(e){this.pending_removal.contains(e)?(this.pending_removal.remove(e),this.pending_removal.isEmpty()&&(this.any_pending_removal=!1)):this.objects.length?(this.objects[this.objects.length-1].get_zindex()>e.get_zindex()&&(this.is_sorted=!1),this.objects.push(e)):(this.objects.push(e),this.is_sorted=!0)};D.prototype.remove=
function(e){this.pending_removal.add(e);this.any_pending_removal=!0;30<=this.pending_removal.count()&&this.flush_pending()};D.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()===this.objects.length?this.reset():(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1))};D.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(z),this.is_sorted=!0)};D.prototype.reset=function(){cr.clearArray(this.objects);
this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};D.prototype.dump=function(e){this.flush_pending();this.ensure_sorted();this.objects.length&&e.push(this.objects)};cr.RenderCell=D;var B="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");cr.effectToCompositeOp=function(e){return 0>=e||11<=e?"source-over":B[e-1]};cr.setGLBlend=function(e,u,F){if(F)switch(e.srcBlend=F.ONE,e.destBlend=F.ONE_MINUS_SRC_ALPHA,
u){case 1:e.srcBlend=F.ONE;e.destBlend=F.ONE;break;case 3:e.srcBlend=F.ONE;e.destBlend=F.ZERO;break;case 4:e.srcBlend=F.ONE_MINUS_DST_ALPHA;e.destBlend=F.ONE;break;case 5:e.srcBlend=F.DST_ALPHA;e.destBlend=F.ZERO;break;case 6:e.srcBlend=F.ZERO;e.destBlend=F.SRC_ALPHA;break;case 7:e.srcBlend=F.ONE_MINUS_DST_ALPHA;e.destBlend=F.ZERO;break;case 8:e.srcBlend=F.ZERO;e.destBlend=F.ONE_MINUS_SRC_ALPHA;break;case 9:e.srcBlend=F.DST_ALPHA;e.destBlend=F.ONE_MINUS_SRC_ALPHA;break;case 10:e.srcBlend=F.ONE_MINUS_DST_ALPHA,
e.destBlend=F.SRC_ALPHA}};cr.round6dp=function(e){return Math.round(1E6*e)/1E6};cr.equals_nocase=function(e,u){return"string"!==typeof e||"string"!==typeof u||e.length!==u.length?!1:e===u?!0:e.toLowerCase()===u.toLowerCase()};cr.cssToCamelCase=function(e){var u="",F,H=!1;var R=0;for(F=e.length;R<F;++R){var S=e.charAt(R);"-"===S?H=!0:H?(u+=S.toUpperCase(),H=!1):u+=S}return u};cr.isCanvasInputEvent=function(e){e=e.target;return!e||e===document||e===window||document&&document.body&&e===document.body||
cr.equals_nocase(e.tagName,"canvas")?!0:!1}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(b){var k=new MatrixArray(3);b&&(k[0]=b[0],k[1]=b[1],k[2]=b[2]);return k};vec3.set=function(b,k){k[0]=b[0];k[1]=b[1];k[2]=b[2];return k};vec3.add=function(b,k,v){if(!v||b===v)return b[0]+=k[0],b[1]+=k[1],b[2]+=k[2],b;v[0]=b[0]+k[0];v[1]=b[1]+k[1];v[2]=b[2]+k[2];return v};
vec3.subtract=function(b,k,v){if(!v||b===v)return b[0]-=k[0],b[1]-=k[1],b[2]-=k[2],b;v[0]=b[0]-k[0];v[1]=b[1]-k[1];v[2]=b[2]-k[2];return v};vec3.negate=function(b,k){k||(k=b);k[0]=-b[0];k[1]=-b[1];k[2]=-b[2];return k};vec3.scale=function(b,k,v){if(!v||b===v)return b[0]*=k,b[1]*=k,b[2]*=k,b;v[0]=b[0]*k;v[1]=b[1]*k;v[2]=b[2]*k;return v};
vec3.normalize=function(b,k){k||(k=b);var v=b[0],A=b[1];b=b[2];var J=Math.sqrt(v*v+A*A+b*b);if(J){if(1===J)return k[0]=v,k[1]=A,k[2]=b,k}else return k[0]=0,k[1]=0,k[2]=0,k;J=1/J;k[0]=v*J;k[1]=A*J;k[2]=b*J;return k};vec3.cross=function(b,k,v){v||(v=b);var A=b[0],J=b[1];b=b[2];var K=k[0],n=k[1];k=k[2];v[0]=J*k-b*n;v[1]=b*K-A*k;v[2]=A*n-J*K;return v};vec3.length=function(b){var k=b[0],v=b[1];b=b[2];return Math.sqrt(k*k+v*v+b*b)};vec3.dot=function(b,k){return b[0]*k[0]+b[1]*k[1]+b[2]*k[2]};
vec3.direction=function(b,k,v){v||(v=b);var A=b[0]-k[0],J=b[1]-k[1];b=b[2]-k[2];k=Math.sqrt(A*A+J*J+b*b);if(!k)return v[0]=0,v[1]=0,v[2]=0,v;k=1/k;v[0]=A*k;v[1]=J*k;v[2]=b*k;return v};vec3.lerp=function(b,k,v,A){A||(A=b);A[0]=b[0]+v*(k[0]-b[0]);A[1]=b[1]+v*(k[1]-b[1]);A[2]=b[2]+v*(k[2]-b[2]);return A};vec3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+"]"};
mat3.create=function(b){var k=new MatrixArray(9);b&&(k[0]=b[0],k[1]=b[1],k[2]=b[2],k[3]=b[3],k[4]=b[4],k[5]=b[5],k[6]=b[6],k[7]=b[7],k[8]=b[8]);return k};mat3.set=function(b,k){k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];return k};mat3.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};
mat3.transpose=function(b,k){if(!k||b===k){k=b[1];var v=b[2],A=b[5];b[1]=b[3];b[2]=b[6];b[3]=k;b[5]=b[7];b[6]=v;b[7]=A;return b}k[0]=b[0];k[1]=b[3];k[2]=b[6];k[3]=b[1];k[4]=b[4];k[5]=b[7];k[6]=b[2];k[7]=b[5];k[8]=b[8];return k};mat3.toMat4=function(b,k){k||(k=mat4.create());k[15]=1;k[14]=0;k[13]=0;k[12]=0;k[11]=0;k[10]=b[8];k[9]=b[7];k[8]=b[6];k[7]=0;k[6]=b[5];k[5]=b[4];k[4]=b[3];k[3]=0;k[2]=b[2];k[1]=b[1];k[0]=b[0];return k};
mat3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+"]"};mat4.create=function(b){var k=new MatrixArray(16);b&&(k[0]=b[0],k[1]=b[1],k[2]=b[2],k[3]=b[3],k[4]=b[4],k[5]=b[5],k[6]=b[6],k[7]=b[7],k[8]=b[8],k[9]=b[9],k[10]=b[10],k[11]=b[11],k[12]=b[12],k[13]=b[13],k[14]=b[14],k[15]=b[15]);return k};
mat4.set=function(b,k){k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];k[9]=b[9];k[10]=b[10];k[11]=b[11];k[12]=b[12];k[13]=b[13];k[14]=b[14];k[15]=b[15];return k};mat4.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.transpose=function(b,k){if(!k||b===k){k=b[1];var v=b[2],A=b[3],J=b[6],K=b[7],n=b[11];b[1]=b[4];b[2]=b[8];b[3]=b[12];b[4]=k;b[6]=b[9];b[7]=b[13];b[8]=v;b[9]=J;b[11]=b[14];b[12]=A;b[13]=K;b[14]=n;return b}k[0]=b[0];k[1]=b[4];k[2]=b[8];k[3]=b[12];k[4]=b[1];k[5]=b[5];k[6]=b[9];k[7]=b[13];k[8]=b[2];k[9]=b[6];k[10]=b[10];k[11]=b[14];k[12]=b[3];k[13]=b[7];k[14]=b[11];k[15]=b[15];return k};
mat4.determinant=function(b){var k=b[0],v=b[1],A=b[2],J=b[3],K=b[4],n=b[5],a=b[6],c=b[7],g=b[8],p=b[9],m=b[10],t=b[11],D=b[12],z=b[13],G=b[14];b=b[15];return D*p*a*J-g*z*a*J-D*n*m*J+K*z*m*J+g*n*G*J-K*p*G*J-D*p*A*c+g*z*A*c+D*v*m*c-k*z*m*c-g*v*G*c+k*p*G*c+D*n*A*t-K*z*A*t-D*v*a*t+k*z*a*t+K*v*G*t-k*n*G*t-g*n*A*b+K*p*A*b+g*v*a*b-k*p*a*b-K*v*m*b+k*n*m*b};
mat4.inverse=function(b,k){k||(k=b);var v=b[0],A=b[1],J=b[2],K=b[3],n=b[4],a=b[5],c=b[6],g=b[7],p=b[8],m=b[9],t=b[10],D=b[11],z=b[12],G=b[13],M=b[14];b=b[15];var l=v*a-A*n,r=v*c-J*n,y=v*g-K*n,N=A*c-J*a,Q=A*g-K*a,E=J*g-K*c,d=p*G-m*z,h=p*M-t*z,B=p*b-D*z,e=m*M-t*G,u=m*b-D*G,F=t*b-D*M,H=1/(l*F-r*u+y*e+N*B-Q*h+E*d);k[0]=(a*F-c*u+g*e)*H;k[1]=(-A*F+J*u-K*e)*H;k[2]=(G*E-M*Q+b*N)*H;k[3]=(-m*E+t*Q-D*N)*H;k[4]=(-n*F+c*B-g*h)*H;k[5]=(v*F-J*B+K*h)*H;k[6]=(-z*E+M*y-b*r)*H;k[7]=(p*E-t*y+D*r)*H;k[8]=(n*u-a*B+g*d)*
H;k[9]=(-v*u+A*B-K*d)*H;k[10]=(z*Q-G*y+b*l)*H;k[11]=(-p*Q+m*y-D*l)*H;k[12]=(-n*e+a*h-c*d)*H;k[13]=(v*e-A*h+J*d)*H;k[14]=(-z*N+G*r-M*l)*H;k[15]=(p*N-m*r+t*l)*H;return k};mat4.toRotationMat=function(b,k){k||(k=mat4.create());k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];k[9]=b[9];k[10]=b[10];k[11]=b[11];k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k};
mat4.toMat3=function(b,k){k||(k=mat3.create());k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[4];k[4]=b[5];k[5]=b[6];k[6]=b[8];k[7]=b[9];k[8]=b[10];return k};mat4.toInverseMat3=function(b,k){var v=b[0],A=b[1],J=b[2],K=b[4],n=b[5],a=b[6],c=b[8],g=b[9];b=b[10];var p=b*n-a*g,m=-b*K+a*c,t=g*K-n*c,D=v*p+A*m+J*t;if(!D)return null;D=1/D;k||(k=mat3.create());k[0]=p*D;k[1]=(-b*A+J*g)*D;k[2]=(a*A-J*n)*D;k[3]=m*D;k[4]=(b*v-J*c)*D;k[5]=(-a*v+J*K)*D;k[6]=t*D;k[7]=(-g*v+A*c)*D;k[8]=(n*v-A*K)*D;return k};
mat4.multiply=function(b,k,v){v||(v=b);var A=b[0],J=b[1],K=b[2],n=b[3],a=b[4],c=b[5],g=b[6],p=b[7],m=b[8],t=b[9],D=b[10],z=b[11],G=b[12],M=b[13],l=b[14];b=b[15];var r=k[0],y=k[1],N=k[2],Q=k[3],E=k[4],d=k[5],h=k[6],B=k[7],e=k[8],u=k[9],F=k[10],H=k[11],R=k[12],S=k[13],V=k[14];k=k[15];v[0]=r*A+y*a+N*m+Q*G;v[1]=r*J+y*c+N*t+Q*M;v[2]=r*K+y*g+N*D+Q*l;v[3]=r*n+y*p+N*z+Q*b;v[4]=E*A+d*a+h*m+B*G;v[5]=E*J+d*c+h*t+B*M;v[6]=E*K+d*g+h*D+B*l;v[7]=E*n+d*p+h*z+B*b;v[8]=e*A+u*a+F*m+H*G;v[9]=e*J+u*c+F*t+H*M;v[10]=e*
K+u*g+F*D+H*l;v[11]=e*n+u*p+F*z+H*b;v[12]=R*A+S*a+V*m+k*G;v[13]=R*J+S*c+V*t+k*M;v[14]=R*K+S*g+V*D+k*l;v[15]=R*n+S*p+V*z+k*b;return v};mat4.multiplyVec3=function(b,k,v){v||(v=k);var A=k[0],J=k[1];k=k[2];v[0]=b[0]*A+b[4]*J+b[8]*k+b[12];v[1]=b[1]*A+b[5]*J+b[9]*k+b[13];v[2]=b[2]*A+b[6]*J+b[10]*k+b[14];return v};
mat4.multiplyVec4=function(b,k,v){v||(v=k);var A=k[0],J=k[1],K=k[2];k=k[3];v[0]=b[0]*A+b[4]*J+b[8]*K+b[12]*k;v[1]=b[1]*A+b[5]*J+b[9]*K+b[13]*k;v[2]=b[2]*A+b[6]*J+b[10]*K+b[14]*k;v[3]=b[3]*A+b[7]*J+b[11]*K+b[15]*k;return v};
mat4.translate=function(b,k,v){var A=k[0],J=k[1];k=k[2];if(!v||b===v)return b[12]=b[0]*A+b[4]*J+b[8]*k+b[12],b[13]=b[1]*A+b[5]*J+b[9]*k+b[13],b[14]=b[2]*A+b[6]*J+b[10]*k+b[14],b[15]=b[3]*A+b[7]*J+b[11]*k+b[15],b;var K=b[0];var n=b[1];var a=b[2];var c=b[3];var g=b[4];var p=b[5];var m=b[6];var t=b[7];var D=b[8];var z=b[9];var G=b[10];var M=b[11];v[0]=K;v[1]=n;v[2]=a;v[3]=c;v[4]=g;v[5]=p;v[6]=m;v[7]=t;v[8]=D;v[9]=z;v[10]=G;v[11]=M;v[12]=K*A+g*J+D*k+b[12];v[13]=n*A+p*J+z*k+b[13];v[14]=a*A+m*J+G*k+b[14];
v[15]=c*A+t*J+M*k+b[15];return v};mat4.scale=function(b,k,v){var A=k[0],J=k[1];k=k[2];if(!v||b===v)return b[0]*=A,b[1]*=A,b[2]*=A,b[3]*=A,b[4]*=J,b[5]*=J,b[6]*=J,b[7]*=J,b[8]*=k,b[9]*=k,b[10]*=k,b[11]*=k,b;v[0]=b[0]*A;v[1]=b[1]*A;v[2]=b[2]*A;v[3]=b[3]*A;v[4]=b[4]*J;v[5]=b[5]*J;v[6]=b[6]*J;v[7]=b[7]*J;v[8]=b[8]*k;v[9]=b[9]*k;v[10]=b[10]*k;v[11]=b[11]*k;v[12]=b[12];v[13]=b[13];v[14]=b[14];v[15]=b[15];return v};
mat4.rotate=function(b,k,v,A){var J=v[0],K=v[1];v=v[2];var n=Math.sqrt(J*J+K*K+v*v);if(!n)return null;1!==n&&(n=1/n,J*=n,K*=n,v*=n);var a=Math.sin(k);var c=Math.cos(k);var g=1-c;k=b[0];n=b[1];var p=b[2];var m=b[3];var t=b[4];var D=b[5];var z=b[6];var G=b[7];var M=b[8];var l=b[9];var r=b[10];var y=b[11];var N=J*J*g+c;var Q=K*J*g+v*a;var E=v*J*g-K*a;var d=J*K*g-v*a;var h=K*K*g+c;var B=v*K*g+J*a;var e=J*v*g+K*a;J=K*v*g-J*a;K=v*v*g+c;A?b!==A&&(A[12]=b[12],A[13]=b[13],A[14]=b[14],A[15]=b[15]):A=b;A[0]=
k*N+t*Q+M*E;A[1]=n*N+D*Q+l*E;A[2]=p*N+z*Q+r*E;A[3]=m*N+G*Q+y*E;A[4]=k*d+t*h+M*B;A[5]=n*d+D*h+l*B;A[6]=p*d+z*h+r*B;A[7]=m*d+G*h+y*B;A[8]=k*e+t*J+M*K;A[9]=n*e+D*J+l*K;A[10]=p*e+z*J+r*K;A[11]=m*e+G*J+y*K;return A};
mat4.rotateX=function(b,k,v){var A=Math.sin(k);k=Math.cos(k);var J=b[4],K=b[5],n=b[6],a=b[7],c=b[8],g=b[9],p=b[10],m=b[11];v?b!==v&&(v[0]=b[0],v[1]=b[1],v[2]=b[2],v[3]=b[3],v[12]=b[12],v[13]=b[13],v[14]=b[14],v[15]=b[15]):v=b;v[4]=J*k+c*A;v[5]=K*k+g*A;v[6]=n*k+p*A;v[7]=a*k+m*A;v[8]=J*-A+c*k;v[9]=K*-A+g*k;v[10]=n*-A+p*k;v[11]=a*-A+m*k;return v};
mat4.rotateY=function(b,k,v){var A=Math.sin(k);k=Math.cos(k);var J=b[0],K=b[1],n=b[2],a=b[3],c=b[8],g=b[9],p=b[10],m=b[11];v?b!==v&&(v[4]=b[4],v[5]=b[5],v[6]=b[6],v[7]=b[7],v[12]=b[12],v[13]=b[13],v[14]=b[14],v[15]=b[15]):v=b;v[0]=J*k+c*-A;v[1]=K*k+g*-A;v[2]=n*k+p*-A;v[3]=a*k+m*-A;v[8]=J*A+c*k;v[9]=K*A+g*k;v[10]=n*A+p*k;v[11]=a*A+m*k;return v};
mat4.rotateZ=function(b,k,v){var A=Math.sin(k);k=Math.cos(k);var J=b[0],K=b[1],n=b[2],a=b[3],c=b[4],g=b[5],p=b[6],m=b[7];v?b!==v&&(v[8]=b[8],v[9]=b[9],v[10]=b[10],v[11]=b[11],v[12]=b[12],v[13]=b[13],v[14]=b[14],v[15]=b[15]):v=b;v[0]=J*k+c*A;v[1]=K*k+g*A;v[2]=n*k+p*A;v[3]=a*k+m*A;v[4]=J*-A+c*k;v[5]=K*-A+g*k;v[6]=n*-A+p*k;v[7]=a*-A+m*k;return v};
mat4.frustum=function(b,k,v,A,J,K,n){n||(n=mat4.create());var a=k-b,c=A-v,g=K-J;n[0]=2*J/a;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*J/c;n[6]=0;n[7]=0;n[8]=(k+b)/a;n[9]=(A+v)/c;n[10]=-(K+J)/g;n[11]=-1;n[12]=0;n[13]=0;n[14]=-(K*J*2)/g;n[15]=0;return n};mat4.perspective=function(b,k,v,A,J){b=v*Math.tan(b*Math.PI/360);k*=b;return mat4.frustum(-k,k,-b,b,v,A,J)};
mat4.ortho=function(b,k,v,A,J,K,n){n||(n=mat4.create());var a=k-b,c=A-v,g=K-J;n[0]=2/a;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2/c;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=-2/g;n[11]=0;n[12]=-(b+k)/a;n[13]=-(A+v)/c;n[14]=-(K+J)/g;n[15]=1;return n};
mat4.lookAt=function(b,k,v,A){A||(A=mat4.create());var J=b[0],K=b[1];b=b[2];var n=v[0];var a=v[1];var c=v[2];v=k[1];var g=k[2];if(J===k[0]&&K===v&&b===g)return mat4.identity(A);v=J-k[0];g=K-k[1];var p=b-k[2];var m=1/Math.sqrt(v*v+g*g+p*p);v*=m;g*=m;p*=m;k=a*p-c*g;c=c*v-n*p;n=n*g-a*v;(m=Math.sqrt(k*k+c*c+n*n))?(m=1/m,k*=m,c*=m,n*=m):n=c=k=0;a=g*n-p*c;var t=p*k-v*n;var D=v*c-g*k;(m=Math.sqrt(a*a+t*t+D*D))?(m=1/m,a*=m,t*=m,D*=m):D=t=a=0;A[0]=k;A[1]=a;A[2]=v;A[3]=0;A[4]=c;A[5]=t;A[6]=g;A[7]=0;A[8]=n;
A[9]=D;A[10]=p;A[11]=0;A[12]=-(k*J+c*K+n*b);A[13]=-(a*J+t*K+D*b);A[14]=-(v*J+g*K+p*b);A[15]=1;return A};mat4.fromRotationTranslation=function(b,k,v){v||(v=mat4.create());var A=b[0],J=b[1],K=b[2],n=b[3],a=A+A,c=J+J,g=K+K;b=A*a;var p=A*c;A*=g;var m=J*c;J*=g;K*=g;a*=n;c*=n;n*=g;v[0]=1-(m+K);v[1]=p+n;v[2]=A-c;v[3]=0;v[4]=p-n;v[5]=1-(b+K);v[6]=J+a;v[7]=0;v[8]=A+c;v[9]=J-a;v[10]=1-(b+m);v[11]=0;v[12]=k[0];v[13]=k[1];v[14]=k[2];v[15]=1;return v};
mat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+"]"};quat4.create=function(b){var k=new MatrixArray(4);b&&(k[0]=b[0],k[1]=b[1],k[2]=b[2],k[3]=b[3]);return k};quat4.set=function(b,k){k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];return k};
quat4.calculateW=function(b,k){var v=b[0],A=b[1],J=b[2];if(!k||b===k)return b[3]=-Math.sqrt(Math.abs(1-v*v-A*A-J*J)),b;k[0]=v;k[1]=A;k[2]=J;k[3]=-Math.sqrt(Math.abs(1-v*v-A*A-J*J));return k};quat4.inverse=function(b,k){if(!k||b===k)return b[0]*=-1,b[1]*=-1,b[2]*=-1,b;k[0]=-b[0];k[1]=-b[1];k[2]=-b[2];k[3]=b[3];return k};quat4.length=function(b){var k=b[0],v=b[1],A=b[2];b=b[3];return Math.sqrt(k*k+v*v+A*A+b*b)};
quat4.normalize=function(b,k){k||(k=b);var v=b[0],A=b[1],J=b[2];b=b[3];var K=Math.sqrt(v*v+A*A+J*J+b*b);if(0===K)return k[0]=0,k[1]=0,k[2]=0,k[3]=0,k;K=1/K;k[0]=v*K;k[1]=A*K;k[2]=J*K;k[3]=b*K;return k};quat4.multiply=function(b,k,v){v||(v=b);var A=b[0],J=b[1],K=b[2];b=b[3];var n=k[0],a=k[1],c=k[2];k=k[3];v[0]=A*k+b*n+J*c-K*a;v[1]=J*k+b*a+K*n-A*c;v[2]=K*k+b*c+A*a-J*n;v[3]=b*k-A*n-J*a-K*c;return v};
quat4.multiplyVec3=function(b,k,v){v||(v=k);var A=k[0],J=k[1],K=k[2];k=b[0];var n=b[1],a=b[2];b=b[3];var c=b*A+n*K-a*J,g=b*J+a*A-k*K,p=b*K+k*J-n*A;A=-k*A-n*J-a*K;v[0]=c*b+A*-k+g*-a-p*-n;v[1]=g*b+A*-n+p*-k-c*-a;v[2]=p*b+A*-a+c*-n-g*-k;return v};quat4.toMat3=function(b,k){k||(k=mat3.create());var v=b[0],A=b[1],J=b[2];b=b[3];var K=v+v,n=A+A,a=J+J,c=v*K,g=v*n;v*=a;var p=A*n;A*=a;J*=a;K*=b;n*=b;b*=a;k[0]=1-(p+J);k[1]=g+b;k[2]=v-n;k[3]=g-b;k[4]=1-(c+J);k[5]=A+K;k[6]=v+n;k[7]=A-K;k[8]=1-(c+p);return k};
quat4.toMat4=function(b,k){k||(k=mat4.create());var v=b[0],A=b[1],J=b[2];b=b[3];var K=v+v,n=A+A,a=J+J,c=v*K,g=v*n;v*=a;var p=A*n;A*=a;J*=a;K*=b;n*=b;b*=a;k[0]=1-(p+J);k[1]=g+b;k[2]=v-n;k[3]=0;k[4]=g-b;k[5]=1-(c+J);k[6]=A+K;k[7]=0;k[8]=v+n;k[9]=A-K;k[10]=1-(c+p);k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k};
quat4.slerp=function(b,k,v,A){A||(A=b);var J=b[0]*k[0]+b[1]*k[1]+b[2]*k[2]+b[3]*k[3];if(1<=Math.abs(J))return A!==b&&(A[0]=b[0],A[1]=b[1],A[2]=b[2],A[3]=b[3]),A;var K=Math.acos(J);var n=Math.sqrt(1-J*J);if(.001>Math.abs(n))return A[0]=.5*b[0]+.5*k[0],A[1]=.5*b[1]+.5*k[1],A[2]=.5*b[2]+.5*k[2],A[3]=.5*b[3]+.5*k[3],A;J=Math.sin((1-v)*K)/n;v=Math.sin(v*K)/n;A[0]=b[0]*J+k[0]*v;A[1]=b[1]*J+k[1]*v;A[2]=b[2]*J+k[2]*v;A[3]=b[3]*J+k[3]*v;return A};
quat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+"]"};
(function(){function b(a,c,g){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.height=this.width=0;this.enableFrontToBack=!!g;this.isBatchInEarlyZPass=this.isEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1E3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=
vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1;this.timerExt=null;this.isTiming=!1;this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query");this.frameNumber=
0;this.timerResults=[];this.initState()}function k(a,c,g){this.gl=a;this.shaderProgram=c;this.name=g;this.locAPos=a.getAttribLocation(c,"aPos");this.locATex=a.getAttribLocation(c,"aTex");this.locMatP=a.getUniformLocation(c,"matP");this.locMatMV=a.getUniformLocation(c,"matMV");this.locOpacity=a.getUniformLocation(c,"opacity");this.locColorFill=a.getUniformLocation(c,"colorFill");this.locSamplerFront=a.getUniformLocation(c,"samplerFront");this.locSamplerBack=a.getUniformLocation(c,"samplerBack");this.locSrcStart=
a.getUniformLocation(c,"srcStart");this.locSrcEnd=a.getUniformLocation(c,"srcEnd");this.locSrcOriginStart=a.getUniformLocation(c,"srcOriginStart");this.locSrcOriginEnd=a.getUniformLocation(c,"srcOriginEnd");this.locLayoutStart=a.getUniformLocation(c,"layoutStart");this.locLayoutEnd=a.getUniformLocation(c,"layoutEnd");this.locDestStart=a.getUniformLocation(c,"destStart");this.locDestEnd=a.getUniformLocation(c,"destEnd");this.locSeconds=a.getUniformLocation(c,"seconds");this.locPixelSize=a.getUniformLocation(c,
"pixelSize");this.locLayerScale=a.getUniformLocation(c,"layerScale");this.locLayerAngle=a.getUniformLocation(c,"layerAngle");this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle);this.lpPixelHeight=this.lpPixelWidth=-999;this.lpOpacity=1;this.lpDestStartY=this.lpDestStartX=
this.lpLayoutEndY=this.lpLayoutEndX=this.lpLayoutStartY=this.lpLayoutStartX=this.lpSrcOriginEndY=this.lpSrcOriginEndX=this.lpSrcOriginStartY=this.lpSrcOriginStartX=this.lpSrcEndY=this.lpSrcEndX=this.lpSrcStartY=this.lpSrcStartX=0;this.lpLayerScale=this.lpDestEndY=this.lpDestEndX=1;this.lpSeconds=this.lpLayerAngle=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locColorFill&&a.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,
0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locSrcStart&&a.uniform2f(this.locSrcStart,0,0);this.locSrcEnd&&a.uniform2f(this.locSrcEnd,1,1);this.locSrcOriginStart&&a.uniform2f(this.locSrcOriginStart,0,0);this.locSrcOriginEnd&&a.uniform2f(this.locSrcOriginEnd,0,0);this.locLayoutStart&&a.uniform2f(this.locLayoutStart,0,0);this.locLayoutEnd&&a.uniform2f(this.locLayoutEnd,0,0);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&
a.uniform1f(this.locLayerScale,1);this.locLayerAngle&&a.uniform1f(this.locLayerAngle,0);this.locSeconds&&a.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function v(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]}function A(a,c){this.type=a;this.glwrap=c;this.gl=c.gl;this.indexCount=this.startIndex=this.opacityParam=
0;this.mat4param=this.texParam=null;this.layoutRect=quat4.create();this.srcOriginRect=quat4.create();this.shaderParams=[];cr.seal(this)}var J=mat4.create();b.prototype.initState=function(){var a=this.gl,c;this.lastOpacity=1;this.lastTexture1=this.lastTexture0=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this.enableFrontToBack?(a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL)):a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(8E3*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);a.bufferData(a.ARRAY_BUFFER,this.pointData.byteLength,a.DYNAMIC_DRAW);this.vertexBuffers=Array(4);this.texcoordBuffers=
Array(4);for(c=0;4>c;c++)this.vertexBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.vertexData.byteLength,a.DYNAMIC_DRAW),this.texcoordBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.texcoordData.byteLength,a.DYNAMIC_DRAW);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var g=new Uint16Array(12E3),p=c=0;12E3>
c;)g[c++]=p,g[c++]=p+1,g[c++]=p+2,g[c++]=p,g[c++]=p+2,g[c++]=p+3,p+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,g,a.STATIC_DRAW);this.pointPtr=this.texPtr=this.vertexPtr=0;this.shaderPrograms=[];c=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";
g=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},c,"<default>");this.shaderPrograms.push(g);g=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}",
"<point>");this.shaderPrograms.push(g);g=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}"},c,"<earlyz>");this.shaderPrograms.push(g);g=this.createShaderProgram({src:"uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}"},c,"<fill>");this.shaderPrograms.push(g);for(var m in cr.shaders)cr.shaders.hasOwnProperty(m)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[m],
c,m));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.depthBuffer=this.renderToTex=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=a.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];2048<
this.maxPointSize&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};k.prototype.updateMatMV=function(a){v(this.lpMatMV,a)||(mat4.set(a,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,a))};b.prototype.createShaderProgram=function(a,c,g){var p=this.gl,m=p.createShader(p.FRAGMENT_SHADER);p.shaderSource(m,a.src);p.compileShader(m);if(!p.getShaderParameter(m,p.COMPILE_STATUS))throw a=p.getShaderInfoLog(m),p.deleteShader(m),Error("error compiling fragment shader: "+a);var t=p.createShader(p.VERTEX_SHADER);
p.shaderSource(t,c);p.compileShader(t);if(!p.getShaderParameter(t,p.COMPILE_STATUS))throw a=p.getShaderInfoLog(t),p.deleteShader(m),p.deleteShader(t),Error("error compiling vertex shader: "+a);c=p.createProgram();p.attachShader(c,m);p.attachShader(c,t);p.linkProgram(c);if(!p.getProgramParameter(c,p.LINK_STATUS))throw a=p.getProgramInfoLog(c),p.deleteShader(m),p.deleteShader(t),p.deleteProgram(c),Error("error linking shader program: "+a);p.useProgram(c);p.deleteShader(m);p.deleteShader(t);m=new k(p,
c,g);m.extendBoxHorizontal=a.extendBoxHorizontal||0;m.extendBoxVertical=a.extendBoxVertical||0;m.crossSampling=!!a.crossSampling;m.preservesOpaqueness=!!a.preservesOpaqueness;m.animated=!!a.animated;m.parameters=a.parameters||[];a=0;for(t=m.parameters.length;a<t;a++)m.parameters[a][1]=p.getUniformLocation(c,m.parameters[a][0]),m.lastCustomParams.push(0);cr.seal(m);return m};b.prototype.getShaderIndex=function(a){var c;var g=0;for(c=this.shaderPrograms.length;g<c;g++)if(this.shaderPrograms[g].name===
a)return g;return-1};b.prototype.project=function(a,c,g){var p=this.matMV,m=this.matP,t=[0,0,0,0,0,0,0,0];t[0]=p[0]*a+p[4]*c+p[12];t[1]=p[1]*a+p[5]*c+p[13];t[2]=p[2]*a+p[6]*c+p[14];t[3]=p[3]*a+p[7]*c+p[15];t[4]=m[0]*t[0]+m[4]*t[1]+m[8]*t[2]+m[12]*t[3];t[5]=m[1]*t[0]+m[5]*t[1]+m[9]*t[2]+m[13]*t[3];t[6]=m[2]*t[0]+m[6]*t[1]+m[10]*t[2]+m[14]*t[3];t[7]=-t[2];0!==t[7]&&(t[7]=1/t[7],t[4]*=t[7],t[5]*=t[7],t[6]*=t[7],g[0]=(.5*t[4]+.5)*this.width,g[1]=(.5*t[5]+.5)*this.height)};b.prototype.setSize=function(a,
c,g){if(this.width!==a||this.height!==c||g){this.endBatch();g=this.gl;this.width=a;this.height=c;g.viewport(0,0,a,c);mat4.lookAt(this.cam,this.look,this.up,this.matMV);this.enableFrontToBack?(mat4.ortho(-a/2,a/2,c/2,-c/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,a/c,this.zNear,this.zFar,this.matP),a=[0,0],c=[0,0],this.project(0,0,a),this.project(1,1,c),this.worldScale[0]=1/(c[0]-a[0]),this.worldScale[1]=-1/(c[1]-a[1]));a=0;for(c=this.shaderPrograms.length;a<
c;a++){var p=this.shaderPrograms[a];p.hasCurrentMatMV=!1;p.locMatP&&(g.useProgram(p.shaderProgram),g.uniformMatrix4fv(p.locMatP,!1,this.matP))}g.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);g.bindTexture(g.TEXTURE_2D,null);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,null);g.activeTexture(g.TEXTURE0);this.lastTexture1=this.lastTexture0=null;this.depthBuffer&&(g.bindFramebuffer(g.FRAMEBUFFER,this.fbo),g.bindRenderbuffer(g.RENDERBUFFER,this.depthBuffer),g.renderbufferStorage(g.RENDERBUFFER,
g.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),g.bindRenderbuffer(g.RENDERBUFFER,null),g.bindFramebuffer(g.FRAMEBUFFER,null),this.renderToTex=null)}};b.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};b.prototype.translate=function(a,c){if(0!==a||0!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=
c,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};b.prototype.scale=function(a,c){if(1!==a||1!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};b.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};b.prototype.updateModelView=function(){if(!v(this.lastMV,this.matMV)){var a=this.pushBatch();a.type=5;a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasPointBatchTop=
this.hasQuadBatchTop=!1}};b.prototype.setEarlyZIndex=function(a){this.enableFrontToBack&&(32760<a&&(a=32760),this.currentZ=this.cam[2]-this.zNear-a*this.zIncrement)};A.prototype.doSetEarlyZPass=function(){var a=this.gl,c=this.glwrap;0!==this.startIndex?(a.depthMask(!0),a.colorMask(!1,!1,!1,!1),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.clear(a.DEPTH_BUFFER_BIT),a.bindFramebuffer(a.FRAMEBUFFER,null),c.isBatchInEarlyZPass=
!0):(a.depthMask(!1),a.colorMask(!0,!0,!0,!0),a.enable(a.BLEND),c.isBatchInEarlyZPass=!1)};A.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};A.prototype.doSetTexture1=function(){var a=this.gl;a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,this.texParam);a.activeTexture(a.TEXTURE0)};A.prototype.doSetOpacity=function(){var a=this.opacityParam,c=this.glwrap;c.currentOpacity=a;c=c.currentShader;c.locOpacity&&c.lpOpacity!==a&&(c.lpOpacity=a,this.gl.uniform1f(c.locOpacity,
a))};A.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};A.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};A.prototype.doUpdateModelView=function(){var a,c=this.glwrap.shaderPrograms,g=this.glwrap.currentProgram;var p=0;for(a=c.length;p<a;p++){var m=c[p];p===g&&m.locMatMV?(m.updateMatMV(this.mat4param),m.hasCurrentMatMV=!0):m.hasCurrentMatMV=!1}mat4.set(this.mat4param,this.glwrap.currentMV)};
A.prototype.doRenderToTexture=function(){var a=this.gl,c=this.glwrap;this.texParam?(c.lastTexture1===this.texParam&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),c.lastTexture1=null,a.activeTexture(a.TEXTURE0)),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),c.isBatchInEarlyZPass||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(c.enableFrontToBack||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,
null))};A.prototype.doClear=function(){var a=this.gl,c=this.startIndex;0===c?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):1===c?(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST)):a.clear(a.DEPTH_BUFFER_BIT)};A.prototype.doSetDepthTestEnabled=function(){var a=this.gl;0!==this.startIndex?a.enable(a.DEPTH_TEST):
a.disable(a.DEPTH_TEST)};A.prototype.doPoints=function(){var a=this.gl,c=this.glwrap;c.enableFrontToBack&&a.disable(a.DEPTH_TEST);var g=c.shaderPrograms[1];a.useProgram(g.shaderProgram);!g.hasCurrentMatMV&&g.locMatMV&&(g.updateMatMV(c.currentMV),g.hasCurrentMatMV=!0);a.enableVertexAttribArray(g.locAPos);a.bindBuffer(a.ARRAY_BUFFER,c.pointBuffer);a.vertexAttribPointer(g.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);g=c.currentShader;a.useProgram(g.shaderProgram);
0<=g.locAPos&&(a.enableVertexAttribArray(g.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(g.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=g.locATex&&(a.enableVertexAttribArray(g.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(g.locATex,2,a.FLOAT,!1,0,0));c.enableFrontToBack&&a.enable(a.DEPTH_TEST)};A.prototype.doSetProgram=function(){var a=this.gl,c=this.glwrap,g=c.shaderPrograms[this.startIndex];c.currentProgram=
this.startIndex;c.currentShader=g;a.useProgram(g.shaderProgram);!g.hasCurrentMatMV&&g.locMatMV&&(g.updateMatMV(c.currentMV),g.hasCurrentMatMV=!0);g.locOpacity&&g.lpOpacity!==c.currentOpacity&&(g.lpOpacity=c.currentOpacity,a.uniform1f(g.locOpacity,c.currentOpacity));0<=g.locAPos&&(a.enableVertexAttribArray(g.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(g.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=g.locATex&&(a.enableVertexAttribArray(g.locATex),
a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(g.locATex,2,a.FLOAT,!1,0,0))};A.prototype.doSetColor=function(){var a=this.mat4param;this.gl.uniform4f(this.glwrap.currentShader.locColorFill,a[0],a[1],a[2],a[3])};A.prototype.doSetProgramParameters=function(){var a=this.glwrap.currentShader,c=this.gl;var g=this.mat4param;var p=this.layoutRect;var m=this.srcOriginRect;a.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,
this.texParam),this.glwrap.lastTexture1=this.texParam,c.activeTexture(c.TEXTURE0));var t=g[0],D=g[1];!a.locPixelSize||t===a.lpPixelWidth&&D===a.lpPixelHeight||(a.lpPixelWidth=t,a.lpPixelHeight=D,c.uniform2f(a.locPixelSize,t,D));t=g[2];D=g[3];!a.locDestStart||t===a.lpDestStartX&&D===a.lpDestStartY||(a.lpDestStartX=t,a.lpDestStartY=D,c.uniform2f(a.locDestStart,t,D));t=g[4];D=g[5];!a.locDestEnd||t===a.lpDestEndX&&D===a.lpDestEndY||(a.lpDestEndX=t,a.lpDestEndY=D,c.uniform2f(a.locDestEnd,t,D));t=g[6];
a.locLayerScale&&t!==a.lpLayerScale&&(a.lpLayerScale=t,c.uniform1f(a.locLayerScale,t));t=g[7];a.locLayerAngle&&t!==a.lpLayerAngle&&(a.lpLayerAngle=t,c.uniform1f(a.locLayerAngle,t));t=g[12];D=g[13];!a.locSrcStart||t===a.lpSrcStartX&&D===a.lpSrcStartY||(a.lpSrcStartX=t,a.lpSrcStartY=D,c.uniform2f(a.locSrcStart,t,D));t=g[14];D=g[15];!a.locSrcEnd||t===a.lpSrcEndX&&D===a.lpSrcEndY||(a.lpSrcEndX=t,a.lpSrcEndY=D,c.uniform2f(a.locSrcEnd,t,D));t=m[0];D=m[1];!a.locSrcOriginStart||t===a.lpSrcOriginStartX&&D===
a.lpSrcOriginStartY||(a.lpSrcOriginStartX=t,a.lpSrcOriginStartY=D,c.uniform2f(a.locSrcOriginStart,t,D));t=m[2];D=m[3];!a.locSrcOriginEnd||t===a.lpSrcOriginEndX&&D===a.lpSrcOriginEndY||(a.lpSrcOriginEndX=t,a.lpSrcOriginEndY=D,c.uniform2f(a.locSrcOriginEnd,t,D));t=p[0];D=p[1];!a.locLayoutStart||t===a.lpLayoutStartX&&D===a.lpLayoutStartY||(a.lpLayoutStartX=t,a.lpLayoutStartY=D,c.uniform2f(a.locLayoutStart,t,D));t=p[2];D=p[3];!a.locLayoutEnd||t===a.lpLayoutEndX&&D===a.lpLayoutEndY||(a.lpLayoutEndX=t,
a.lpLayoutEndY=D,c.uniform2f(a.locLayoutEnd,t,D));t=this.startIndex;a.locSeconds&&t!==a.lpSeconds&&(a.lpSeconds=t,c.uniform1f(a.locSeconds,t));if(a.parameters.length)for(g=0,p=a.parameters.length;g<p;g++)t=this.shaderParams[g],Array.isArray(t)?c.uniform3fv(a.parameters[g][1],t):t!==a.lastCustomParams[g]&&(a.lastCustomParams[g]=t,c.uniform1f(a.parameters[g][1],t))};b.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new A(0,this));return this.batch[this.batchPtr++]};
b.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),c&&0<=c.locAPos&&"<point>"===c.name&&a.vertexAttribPointer(c.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var c=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexData.subarray(0,
this.vertexPtr));c&&0<=c.locAPos&&"<point>"!==c.name&&a.vertexAttribPointer(c.locAPos,this.enableFrontToBack?3:2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));c&&0<=c.locATex&&"<point>"!==c.name&&a.vertexAttribPointer(c.locATex,2,a.FLOAT,!1,0,0)}a=0;for(c=this.batchPtr;a<c;a++){var g=this.batch[a];switch(g.type){case 1:g.doQuad();break;case 2:g.doSetTexture();break;case 3:g.doSetOpacity();
break;case 4:g.doSetBlend();break;case 5:g.doUpdateModelView();break;case 6:g.doRenderToTexture();break;case 7:g.doClear();break;case 8:g.doPoints();break;case 9:g.doSetProgram();break;case 10:g.doSetProgramParameters();break;case 11:g.doSetTexture1();break;case 12:g.doSetColor();break;case 13:g.doSetDepthTestEnabled();break;case 14:g.doSetEarlyZPass()}}this.pointPtr=this.texPtr=this.vertexPtr=this.batchPtr=0;this.isBatchInEarlyZPass=this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;
4<=this.curBuffer&&(this.curBuffer=0)}};b.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var a={frameNumber:this.frameNumber,query:null,result:0};2===this.version?(a.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,a.query)):(a.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,a.query));this.timerResults.push(a);1E3<this.timerResults.length&&(a=this.timerResults.shift(),a.query&&(2===
this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query)))}};b.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)};b.prototype.checkForTimerResults=function(a){var c;var g=0;for(c=this.timerResults.length;g<c;++g){var p=this.timerResults[g];if(p.frameNumber>=a)break;if(p.query){var m=2===this.version?this.gl.getQueryParameter(p.query,
this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(p.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT);var t=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT);m&&!t&&(p.result=2===this.version?this.gl.getQueryParameter(p.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(p.query,this.timerExt.QUERY_RESULT_EXT),p.result/=1E9);if(m||t)2===this.version?this.gl.deleteQuery(p.query):this.timerExt.deleteQueryEXT(p.query),p.query=null}}};b.prototype.getFrameRangeTimerResults=function(a,
c){if(c<=a)return-1;var g,p=0,m=0;var t=0;for(g=this.timerResults.length;t<g;++t){var D=this.timerResults[t];if(D.frameNumber>=c)break;if(D.frameNumber>=a){if(D.query)return-1;p+=D.result;m++}}return m<c-a?-1:p};b.prototype.deleteTimerResultsToFrame=function(a){var c;var g=0;for(c=this.timerResults.length;g<c;++g){var p=this.timerResults[g];if(p.frameNumber>=a){0<g&&this.timerResults.splice(0,g);break}}};b.prototype.setOpacity=function(a){if(a!==this.lastOpacity&&!this.isEarlyZPass){var c=this.pushBatch();
c.type=3;this.lastOpacity=c.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setTexture=function(a){if(a!==this.lastTexture0){var c=this.pushBatch();c.type=2;this.lastTexture0=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setBlend=function(a,c){if((a!==this.lastSrcBlend||c!==this.lastDestBlend)&&!this.isEarlyZPass){var g=this.pushBatch();g.type=4;g.startIndex=a;g.indexCount=c;this.lastSrcBlend=a;this.lastDestBlend=c;this.hasPointBatchTop=this.hasQuadBatchTop=
!1}};b.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};b.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.quad=function(a,c,g,p,m,t,D,z){15992<=this.vertexPtr&&this.endBatch();var G=this.vertexPtr,M=this.texPtr,l=this.vertexData,r=this.texcoordData,
y=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var N=this.pushBatch();N.type=1;N.startIndex=this.enableFrontToBack?G:G/2*3;N.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(l[G++]=a,l[G++]=c,l[G++]=y,l[G++]=g,l[G++]=p,l[G++]=y,l[G++]=m,l[G++]=t,l[G++]=y,l[G++]=D,l[G++]=z,l[G++]=y):(l[G++]=a,l[G++]=c,l[G++]=g,l[G++]=p,l[G++]=m,l[G++]=t,l[G++]=D,l[G++]=z);r[M++]=0;r[M++]=0;r[M++]=1;r[M++]=0;r[M++]=1;r[M++]=1;r[M++]=0;r[M++]=
1;this.vertexPtr=G;this.texPtr=M};b.prototype.quadTex=function(a,c,g,p,m,t,D,z,G){15992<=this.vertexPtr&&this.endBatch();var M=this.vertexPtr,l=this.texPtr,r=this.vertexData,y=this.texcoordData,N=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var Q=this.pushBatch();Q.type=1;Q.startIndex=this.enableFrontToBack?M:M/2*3;Q.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}Q=G.left;var E=G.top,d=G.right;G=G.bottom;this.enableFrontToBack?(r[M++]=a,r[M++]=
c,r[M++]=N,r[M++]=g,r[M++]=p,r[M++]=N,r[M++]=m,r[M++]=t,r[M++]=N,r[M++]=D,r[M++]=z,r[M++]=N):(r[M++]=a,r[M++]=c,r[M++]=g,r[M++]=p,r[M++]=m,r[M++]=t,r[M++]=D,r[M++]=z);y[l++]=Q;y[l++]=E;y[l++]=d;y[l++]=E;y[l++]=d;y[l++]=G;y[l++]=Q;y[l++]=G;this.vertexPtr=M;this.texPtr=l};b.prototype.quadTexUV=function(a,c,g,p,m,t,D,z,G,M,l,r,y,N,Q,E){15992<=this.vertexPtr&&this.endBatch();var d=this.vertexPtr,h=this.texPtr,B=this.vertexData,e=this.texcoordData,u=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-
1].indexCount+=6;else{var F=this.pushBatch();F.type=1;F.startIndex=this.enableFrontToBack?d:d/2*3;F.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(B[d++]=a,B[d++]=c,B[d++]=u,B[d++]=g,B[d++]=p,B[d++]=u,B[d++]=m,B[d++]=t,B[d++]=u,B[d++]=D,B[d++]=z,B[d++]=u):(B[d++]=a,B[d++]=c,B[d++]=g,B[d++]=p,B[d++]=m,B[d++]=t,B[d++]=D,B[d++]=z);e[h++]=G;e[h++]=M;e[h++]=l;e[h++]=r;e[h++]=y;e[h++]=N;e[h++]=Q;e[h++]=E;this.vertexPtr=d;this.texPtr=h};b.prototype.convexPoly=function(a){var c=
a.length/2-2,g=c-1,p=a[0],m=a[1],t;for(t=0;t<c;t+=2){var D=2*t;var z=a[D+2];var G=a[D+3];var M=a[D+4];var l=a[D+5];if(t===g)this.quad(p,m,z,G,M,l,M,l);else{var r=a[D+6];D=a[D+7];this.quad(p,m,z,G,M,l,r,D)}}};b.prototype.point=function(a,c,g,p){7996<=this.pointPtr&&this.endBatch();var m=this.pointPtr,t=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var D=this.pushBatch();D.type=8;D.startIndex=m;D.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}t[m++]=
a;t[m++]=c;t[m++]=g;t[m++]=p;this.pointPtr=m};b.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var c=this.pushBatch();c.type=9;this.lastProgram=c.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};b.prototype.programUsesCrossSampling=function(a){a=this.shaderPrograms[a];return!!(a.locDestStart||a.locDestEnd||
a.crossSampling)};b.prototype.programPreservesOpaqueness=function(a){return this.shaderPrograms[a].preservesOpaqueness};b.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};b.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};b.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};b.prototype.getProgramParameterType=function(a,c){return this.shaderPrograms[a].parameters[c][2]};
b.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};b.prototype.setProgramParameters=function(a,c,g,p,m,t,D,z,G,M,l,r,y,N,Q,E,d,h,B,e,u,F,H){var R=this.shaderPrograms[this.lastProgram];if(R.hasAnyOptionalUniforms||H.length){var S=this.pushBatch();S.type=10;S.mat4param?mat4.set(this.matMV,S.mat4param):S.mat4param=mat4.create();var V=S.mat4param;V[0]=c;V[1]=g;V[2]=E;V[3]=d;V[4]=h;V[5]=B;V[6]=e;V[7]=u;V[12]=p;V[13]=m;V[14]=t;V[15]=D;c=S.srcOriginRect;c[0]=z;c[1]=G;c[2]=
M;c[3]=l;z=S.layoutRect;z[0]=r;z[1]=Q;z[2]=N;z[3]=y;S.startIndex=F;S.texParam=R.locSamplerBack?a:null;if(H.length)for(y=S.shaderParams,y.length=H.length,a=0,r=H.length;a<r;a++)y[a]=H[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clear=function(a,c,g,p){var m=this.pushBatch();m.type=7;m.startIndex=0;m.mat4param||(m.mat4param=mat4.create());m.mat4param[0]=a;m.mat4param[1]=c;m.mat4param[2]=g;m.mat4param[3]=p;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.clearRect=function(a,
c,g,p){if(!(0>g||0>p)){var m=this.pushBatch();m.type=7;m.startIndex=1;m.mat4param||(m.mat4param=mat4.create());m.mat4param[0]=a;m.mat4param[1]=c;m.mat4param[2]=g;m.mat4param[3]=p;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clearDepth=function(){var a=this.pushBatch();a.type=7;a.startIndex=2;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setEarlyZPass=function(a){if(this.enableFrontToBack&&(a=!!a,this.isEarlyZPass!==a)){var c=this.pushBatch();c.type=14;c.startIndex=a?1:
0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.isEarlyZPass=a;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};b.prototype.setDepthTestEnabled=function(a){if(this.enableFrontToBack){var c=this.pushBatch();c.type=13;c.startIndex=a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,J);this.resetModelView();this.updateModelView();var a=this.width/2,c=this.height/2;this.quad(-a,c,a,c,a,-c,-a,-c);mat4.set(J,
this.matMV);this.updateModelView()};b.prototype.setColorFillMode=function(a,c,g,p){this.switchProgram(3);var m=this.pushBatch();m.type=12;m.mat4param||(m.mat4param=mat4.create());m.mat4param[0]=a;m.mat4param[1]=c;m.mat4param[2]=g;m.mat4param[3]=p;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setTextureFillMode=function(){this.switchProgram(0)};b.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};b.prototype.getFrameNumber=function(){return this.frameNumber};b.prototype.present=
function(){this.endBatch();this.maybeFinishTiming();this.gl.flush();this.checkForTimerResults(this.frameNumber);this.frameNumber++};b.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var K=[],n={};b.prototype.contextLost=function(){cr.clearArray(K);n={}};b.prototype.loadTexture=function(a,c,g,p,m,t){c=!!c;g=!!g;var D=a.src+","+c+","+g+(c?","+m:"");if("undefined"!==typeof a.src&&n.hasOwnProperty(D)){var z=n[D];z.c2refcount++;return z}this.endBatch();var G=this.gl,M=cr.isPOT(a.width)&&
cr.isPOT(a.height);z=G.createTexture();G.bindTexture(G.TEXTURE_2D,z);G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l=G.RGBA,r=G.RGBA,y=G.UNSIGNED_BYTE;if(p&&!this.isIE)switch(p){case 1:r=l=G.RGB;break;case 2:y=G.UNSIGNED_SHORT_4_4_4_4;break;case 3:y=G.UNSIGNED_SHORT_5_5_5_1;break;case 4:r=l=G.RGB,y=G.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!M&&c){p=document.createElement("canvas");p.width=cr.nextHighestPowerOfTwo(a.width);p.height=cr.nextHighestPowerOfTwo(a.height);var N=p.getContext("2d");
N.imageSmoothingEnabled=g;N.drawImage(a,0,0,a.width,a.height,0,0,p.width,p.height);G.texImage2D(G.TEXTURE_2D,0,l,r,y,p)}else G.texImage2D(G.TEXTURE_2D,0,l,r,y,a);c?"repeat-x"===m?(G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.REPEAT),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE)):("repeat-y"===m?G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE):G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.REPEAT),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.REPEAT)):(G.texParameteri(G.TEXTURE_2D,
G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE));g?(G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),(M||2<=this.version)&&this.enable_mipmaps&&!t?(G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR_MIPMAP_LINEAR),G.generateMipmap(G.TEXTURE_2D)):G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR)):(G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.NEAREST));G.bindTexture(G.TEXTURE_2D,
null);this.lastTexture0=null;z.c2width=a.width;z.c2height=a.height;z.c2refcount=1;z.c2texkey=D;K.push(z);return n[D]=z};b.prototype.createEmptyTexture=function(a,c,g,p,m){this.endBatch();var t=this.gl;this.isIE&&(p=!1);var D=t.createTexture();t.bindTexture(t.TEXTURE_2D,D);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,a,c,0,t.RGBA,p?t.UNSIGNED_SHORT_4_4_4_4:t.UNSIGNED_BYTE,null);m?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,
t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,g?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,g?t.LINEAR:t.NEAREST);t.bindTexture(t.TEXTURE_2D,null);this.lastTexture0=null;D.c2width=a;D.c2height=c;K.push(D);return D};b.prototype.videoToTexture=function(a,c,g){this.endBatch();var p=this.gl;this.isIE&&(g=!1);p.bindTexture(p.TEXTURE_2D,c);p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!0);try{p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,g?p.UNSIGNED_SHORT_4_4_4_4:p.UNSIGNED_BYTE,a)}catch(m){console&&console.error&&console.error("Error updating WebGL texture: ",m)}p.bindTexture(p.TEXTURE_2D,null);this.lastTexture0=null};b.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),a===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),a===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(K,a),"undefined"!==typeof a.c2texkey&&delete n[a.c2texkey],this.gl.deleteTexture(a)))};b.prototype.estimateVRAM=function(){var a=this.width*this.height*8,c;var g=0;for(c=K.length;g<c;g++){var p=K[g];a+=p.c2width*p.c2height*4}return a};b.prototype.textureCount=function(){return K.length};b.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var c=this.pushBatch();
c.type=6;this.renderToTex=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=b})();
(function(){function b(f){var q=f.canvas,x=f.projectDataUrl;q||(q=document.createElement("canvas"),document.body.appendChild(q));if(q&&q.getContext){window.c3runtime=this;window.c3canvas=q;var C=this;this.exportType=f.exportType;this.isPreview="preview"===this.exportType;this.isRemotePreview=!!f.isRemotePreview;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!("undefined"===typeof window.c2isCrosswalk||!window.c2isCrosswalk);this.isPhoneGap=this.isCordova=
"cordova"===this.exportType;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;
this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit=
this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isArcade="scirra-arcade"===this.exportType;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isWindowsPhone81=!("undefined"===typeof window.c2isWindowsPhone81||!window.c2isWindowsPhone81);this.isWindows10="windows-uwp"===this.exportType;this.isWinJS=
this.isWindows8App||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));
this.isWKWebView=!(!this.isiOS||!this.isCordova);this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug");this.useFbInstant="undefined"!==typeof FBInstant&&!this.isPreview&&!this.isCordova;this.hasInitialized=!1;this.canvas=q;this.glwrap=this.gl=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=
0;this.ctx=null;this.firstInFullscreen=!1;this.oldHeight=this.oldWidth=0;this.canvas.oncontextmenu=function(w){w.preventDefault&&w.preventDefault();return!1};this.canvas.onselectstart=function(w){w.preventDefault&&w.preventDefault();return!1};this.canvas.ontouchstart=function(w){w.preventDefault&&w.preventDefault();return!1};this.isNWjs&&(window.ondragover=function(w){w.preventDefault();return!1},window.ondrop=function(w){w.preventDefault();return!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());
if(this.isCordova&&this.isiOS){function w(){var I=document.activeElement;if(!I)return!1;var L=I.tagName.toLowerCase(),O="email number password search tel text url".split(" ");if("textarea"===L)return!0;if("input"===L)return-1<O.indexOf(I.type.toLowerCase()||"text");a:{do{if(I.parentNode&&I.hasAttribute("contenteditable")){I=!0;break a}I=I.parentNode}while(I);I=!1}return I}window.addEventListener("focusout",function(){w()||(document.scrollingElement.scrollTop=0)})}this.projectDataUrl=x||"";this.width=
q.width;this.height=q.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_lowercase={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=
[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.shadowcasterBehavior=this.jumpthruBehavior=this.solidBehavior=null;this.deathRow={};this.isInClearDeathRow=this.hasPendingInstances=!1;this.isInOnDestroy=0;this.isEndingLayout=this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null;this.lastSaveJson="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.fireOnCreateAfterLoad=
[];this.dt1=this.dt=0;this.minimumFramerate=30;this.cpuutilisation=this.logictime=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.gpuTimeEndFrame=this.gpuTimeStartFrame=this.objectcount=this.framecount=this.execcount=this.tickcount_nosave=this.tickcount=this.last_fps_time=this.fps=this.last_tick_time=0;this.gpuCurUtilisation=-1;this.gpuLastUtilisation=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=
[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=-1;this.isloading=!0;this.stackLocalCount=this.loadingprogress=0;this.audioInstance=null;this.isInUserInputEvent=this.had_a_click=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;
this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_ctx=this.layout_canvas=this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid=
{};this.webFontNames=this.loaderlogos=null;this.enhancedAccelerationPrecision=!0;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.useFbInstant?(FBInstant.initializeAsync().then(function(){C.requestProjectData()}).catch(function(w){console.warn("[Instant Games] Unable to load: ",
w);C.requestProjectData()}),window.setTimeout(function(){C.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),C.useFbInstant=!1,C.requestProjectData())},4E3)):this.requestProjectData()}}function k(){var f=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;"object"!==typeof f&&Promise.reject("Permission API is not loaded");return Promise.resolve(f)}function v(f){return k().then(function(q){return new Promise(function(x,
C){q.requestPermission(q[f],function(w){x(w.hasPermission)},C)})})}function A(f){return k().then(function(q){return new Promise(function(x,C){q.checkPermission(q[f],function(w){x(w.hasPermission)},C)})})}function J(){try{return!!window.indexedDB}catch(f){return!1}}function K(f){f.target.result.createObjectStore("saves",{keyPath:"slot"})}function n(f,q,x,C){try{var w=indexedDB.open("_C2SaveStates");w.onupgradeneeded=K;w.onerror=C;w.onsuccess=function(I){I=I.target.result;I.onerror=C;I.transaction(["saves"],
"readwrite").objectStore("saves").put({slot:f,data:q}).onsuccess=x}}catch(I){C(I)}}function a(f,q,x){try{var C=indexedDB.open("_C2SaveStates");C.onupgradeneeded=K;C.onerror=x;C.onsuccess=function(w){w=w.target.result;w.onerror=x;var I=w.transaction(["saves"]).objectStore("saves").get(f);I.onsuccess=function(L){I.result?q(I.result.data):q(null)}}}catch(w){x(w)}}function c(){cr.logexport("Reloading for continuous preview");-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+=
"?continuous"}function g(f){var q,x={};for(q in f)!f.hasOwnProperty(q)||f[q]instanceof cr.ObjectSet||f[q]&&"undefined"!==typeof f[q].c2userdata||"spriteCreatedDestroyCallback"!==q&&(x[q]=f[q]);return x}var p=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,m=new Audio,t={"audio/webm; codecs=opus":!!m.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!m.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!m.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!m.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!m.canPlayType("audio/mp4"),"audio/mpeg":!!m.canPlayType("audio/mpeg")};m=null;b.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var f=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(w){f.loadProject(JSON.parse(w))},function(w){alert("Error fetching data.js")});else{var q=
this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var x=this.projectDataUrl||"data.js";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)x="data.json";q.open("GET",x,!0);var C=!1;if("response"in q&&"responseType"in q)try{q.responseType="json",C="json"===q.responseType}catch(w){C=!1}if(!C&&"responseType"in q)try{q.responseType="text"}catch(w){}if("overrideMimeType"in q)try{q.overrideMimeType("application/json; charset=utf-8")}catch(w){}this.isWindowsPhone8?
q.onreadystatechange=function(){4===q.readyState&&f.loadProject(JSON.parse(q.responseText))}:(q.onload=function(){C?f.loadProject(q.response):f.loadProject(JSON.parse(q.responseText))},q.onerror=function(w){cr.logerror("Error requesting "+x+":");cr.logerror(w)});q.send()}}};b.prototype.initRendererAndLoader=function(){var f=this,q,x;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser;0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var C=window.devicePixelRatio||window.webkitDevicePixelRatio||
window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?C:1;"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.ClearDeathRow();0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{if(this.enableWebGL){var w={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0};this.isAndroid||(this.gl=this.canvas.getContext("webgl2",w));this.gl||
(this.gl=this.canvas.getContext("webgl",w)||this.canvas.getContext("experimental-webgl",w))}}catch(W){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");if(C=this.gl.getExtension("WEBGL_debug_renderer_info"))w=this.gl.getParameter(C.UNMASKED_VENDOR_WEBGL),this.glUnmaskedRenderer=this.gl.getParameter(C.UNMASKED_RENDERER_WEBGL)+" ["+w+"]";this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");this.overlay_canvas=document.createElement("canvas");this.canvas.parentNode.appendChild(this.overlay_canvas);
this.overlay_canvas.oncontextmenu=function(W){return!1};this.overlay_canvas.onselectstart=function(W){return!1};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);this.overlay_canvas.style.width=this.cssWidth+"px";this.overlay_canvas.style.height=this.cssHeight+"px";this.overlay_canvas.style.position="absolute";this.overlay_ctx=this.overlay_canvas.getContext("2d");this.glwrap=new cr.GLWrap(this.gl,this.isMobile,
this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=0!==this.downscalingQuality;this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(W){W.preventDefault();f.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(W){f.glwrap.initState();f.glwrap.setSize(f.glwrap.width,f.glwrap.height,!0);f.layer_tex=null;f.layout_tex=null;
f.fx_tex[0]=null;f.fx_tex[1]=null;f.onContextRestored();f.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN);C=0;for(w=this.types_by_index.length;C<w;C++){var I=this.types_by_index[C];var L=0;for(q=I.effect_types.length;L<q;L++){var O=I.effect_types[L];O.shaderindex=this.glwrap.getShaderIndex(O.id);O.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(O.shaderindex);this.uses_background_blending=
this.uses_background_blending||this.glwrap.programUsesDest(O.shaderindex)}}C=0;for(w=this.layouts_by_index.length;C<w;C++){var P=this.layouts_by_index[C];L=0;for(q=P.effect_types.length;L<q;L++)O=P.effect_types[L],O.shaderindex=this.glwrap.getShaderIndex(O.id),O.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(O.shaderindex);P.updateActiveEffects();L=0;for(q=P.layers.length;L<q;L++){var X=P.layers[L];I=0;for(x=X.effect_types.length;I<x;I++)O=X.effect_types[I],O.shaderindex=this.glwrap.getShaderIndex(O.id),
O.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(O.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(O.shaderindex);X.updateActiveEffects()}}}else w={alpha:!0},this.ctx=this.canvas.getContext("2d",w),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_ctx=this.overlay_canvas=null,this.gpuLastUtilisation=NaN,this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=!0;this.tickFunc=function(W){f.tick(!1,W)};window==window.top||
this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){f.setSuspended(!1)}),window.addEventListener("blur",function(){var W=
window.parent;W&&W.document.hasFocus()||f.setSuspended(!0)})));window.addEventListener("blur",function(){f.onWindowBlur()});C=function(W){"mousedown"===W.type&&1===W.button&&W.preventDefault();if(cr.isCanvasInputEvent(W)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(U){}};"undefined"!==typeof PointerEvent?document.addEventListener("pointerdown",C):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",
C):document.addEventListener("touchstart",C);document.addEventListener("mousedown",C);0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};b.prototype.setSize=function(f,q,x){var C=0,w=0;if(this.lastWindowWidth!==f||this.lastWindowHeight!==q||x){if(this.isiPhone&&this.isCordova&&window.screen){var I=
document.documentElement.style;var L=document.body.style;var O=window.innerWidth<window.innerHeight;var P=O?window.screen.height:window.screen.width;O=O?window.screen.width:window.screen.height;P&&O&&(L.height=I.height=P+"px",L.width=I.width=O+"px")}this.lastWindowWidth=f;this.lastWindowHeight=q;I=this.fullscreen_mode;if((L=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||x)L&&(I=this.fullscreen_scaling),
x=this.devicePixelRatio,4<=I?(5===I&&1!==x&&(f+=1,q+=1),L=this.original_width/this.original_height,f/q>L?(L*=q,5===I?(C=L*x/this.original_width,1<C?C=Math.floor(C):1>C&&(C=1/Math.ceil(1/C)),L=this.original_width*C/x,P=this.original_height*C/x,C=(f-L)/2,w=(q-P)/2,f=L,q=P):(C=(f-L)/2,f=L)):(P=f/L,5===I?(C=P*x/this.original_height,1<C?C=Math.floor(C):1>C&&(C=1/Math.ceil(1/C)),L=this.original_width*C/x,P=this.original_height*C/x,C=(f-L)/2,w=(q-P)/2,f=L):w=(q-P)/2,q=P)):L&&0===I&&(C=Math.floor((f-this.original_width)/
2),w=Math.floor((q-this.original_height)/2),f=this.original_width,q=this.original_height),2>I&&(this.aspect_scale=x),this.cssWidth=Math.round(f),this.cssHeight=Math.round(q),this.width=Math.round(f*x),this.height=Math.round(q*x),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===I?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=
!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===I?(L=this.original_width/this.original_height,I=this.lastWindowWidth/this.lastWindowHeight,I<L?this.draw_width=this.draw_height*I:I>L&&(this.draw_height=this.draw_width/I)):3===I&&(L=this.original_width/this.original_height,I=this.lastWindowWidth/this.lastWindowHeight,I>L?this.draw_width=this.draw_height*I:I<L&&(this.draw_height=this.draw_width/I))),this.canvas&&(this.canvas.width=Math.round(f*
x),this.canvas.height=Math.round(q*x),this.isRetina&&(this.canvas.style.width=Math.round(f)+"px",this.canvas.style.height=Math.round(q)+"px"),this.canvas.style.marginLeft=Math.floor(C)+"px",this.canvas.style.marginTop=Math.floor(w)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(f*x),this.overlay_canvas.height=Math.round(q*x),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.left=Math.floor(C)+"px",this.overlay_canvas.style.top=
Math.floor(w)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(f*x),Math.round(q*x)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}};b.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var f="portrait";2===this.orientations&&(f="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(f).catch(function(){}):screen.lockOrientation?screen.lockOrientation(f):
screen.webkitLockOrientation?screen.webkitLockOrientation(f):screen.mozLockOrientation?screen.mozLockOrientation(f):screen.msLockOrientation&&screen.msLockOrientation(f)}catch(q){console&&console.warn&&console.warn("Failed to lock orientation: ",q)}}};b.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;var f;var q=0;for(f=this.types_by_index.length;q<f;q++){var x=this.types_by_index[q];if(x.onLostWebGLContext)x.onLostWebGLContext()}};b.prototype.onContextRestored=
function(){this.is_WebGL_context_lost=!1;var f;var q=0;for(f=this.types_by_index.length;q<f;q++){var x=this.types_by_index[q];if(x.onRestoreWebGLContext)x.onRestoreWebGLContext()}};var D=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;b.prototype.setSuspended=function(f){var q;if(f&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&D(this.raf_id),
-1!==this.timeout_id&&clearTimeout(this.timeout_id),f=0,q=this.suspend_events.length;f<q;f++)this.suspend_events[f](!0);else if(!f&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();f=this.logictime=this.framecount=0;for(q=this.suspend_events.length;f<q;f++)this.suspend_events[f](!1);this.tick(!1)}};b.prototype.addSuspendCallback=function(f){this.suspend_events.push(f)};b.prototype.GetObjectReference=
function(f){return this.objectRefTable[f]};b.prototype.loadProject=function(f){f&&f.project||cr.logerror("Project model unavailable");f=f.project;this.name=f[0];this.first_layout=f[1];this.fullscreen_mode=f[12];this.fullscreen_mode_set=f[12];this.original_width=f[10];this.original_height=f[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;this.uses_loader_layout=f[18];this.loaderstyle=f[19];this.iconsFolder=f[28];this.webFontNames=f[29].map(function(ca){return ca[0]});
if(0===this.loaderstyle){var q=new Image;q.crossOrigin="anonymous";var x=this.loaderlogos={logo:q};q.addEventListener("error",function(){x.logo=null});var C=f[39];C=this.isPreview?this.getProjectFileUrl(C):this.iconsFolder+C;this.setImageSrc(q,C)}else if(4===this.loaderstyle){q=new Image;q.src="splash-images/splash-logo.svg";C=new Image;C.src="splash-images/splash-poweredby-512.png";var w=new Image;w.src="splash-images/splash-poweredby-256.png";var I=new Image;I.src="splash-images/splash-poweredby-128.png";
var L=new Image;L.src="splash-images/splash-website-512.png";var O=new Image;O.src="splash-images/splash-website-256.png";var P=new Image;P.src="splash-images/splash-website-128.png";this.loaderlogos={logo:q,powered:[C,w,I],website:[L,O,P]}}this.next_uid=f[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);q=0;for(C=f[2].length;q<C;q++){P=f[2][q];w=this.GetObjectReference(P[0]);cr.add_common_aces(P,w.prototype);var X=new w(this);X.singleglobal=P[1];X.is_world=P[2];
X.is_rotatable=P[5];X.must_predraw=P[9];if(X.onCreate)X.onCreate();cr.seal(X);this.plugins.push(X)}this.objectRefTable=cr.getObjectRefTable();q=0;for(C=f[3].length;q<C;q++){P=f[3][q];L=this.GetObjectReference(P[1]);X=null;w=0;for(I=this.plugins.length;w<I;w++)if(this.plugins[w]instanceof L){X=this.plugins[w];break}var W=new X.Type(X);W.name=P[0];W.is_family=P[2];W.instvar_sids=P[3].slice(0);W.vars_count=P[3].length;W.behs_count=P[4];W.fx_count=P[5];W.sid=P[11];W.is_family?(W.members=[],W.family_index=
this.family_count++,W.families=null):(W.members=null,W.family_index=-1,W.families=[]);W.family_var_map=null;W.family_beh_map=null;W.family_fx_map=null;W.is_contained=!1;W.container=null;P[6]?(W.texture_file=P[6][0],W.texture_filesize=P[6][1],W.texture_pixelformat=P[6][2],W.texture_data=P[6]):(W.texture_file=null,W.texture_filesize=0,W.texture_pixelformat=0,W.texture_data=null);W.animations=P[7]?P[7]:null;W.index=q;W.instances=[];W.deadCache=[];W.solstack=[new cr.selection(W)];W.cur_sol=0;W.default_instance=
null;W.default_layerindex=0;W.stale_iids=!0;W.updateIIDs=cr.type_updateIIDs;W.getFirstPicked=cr.type_getFirstPicked;W.getPairedInstance=cr.type_getPairedInstance;W.getCurrentSol=cr.type_getCurrentSol;W.pushCleanSol=cr.type_pushCleanSol;W.pushCopySol=cr.type_pushCopySol;W.popSol=cr.type_popSol;W.getBehaviorByName=cr.type_getBehaviorByName;W.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;W.getEffectIndexByName=cr.type_getEffectIndexByName;W.applySolToContainer=cr.type_applySolToContainer;W.getInstanceByIID=
cr.type_getInstanceByIID;W.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);W.any_cell_changed=!0;W.any_instance_parallaxed=!1;W.extra={};W.toString=cr.type_toString;W.behaviors=[];w=0;for(I=P[8].length;w<I;w++){var U=P[8][w];var Y=this.GetObjectReference(U[1]),ba=null;L=0;for(O=this.behaviors.length;L<O;L++)if(this.behaviors[L]instanceof Y){ba=this.behaviors[L];break}if(!ba){ba=new Y(this);ba.my_types=[];ba.my_instances=new cr.ObjectSet;if(ba.onCreate)ba.onCreate();cr.seal(ba);
this.behaviors.push(ba);cr.behaviors.solid&&ba instanceof cr.behaviors.solid&&(this.solidBehavior=ba);cr.behaviors.jumpthru&&ba instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=ba);cr.behaviors.shadowcaster&&ba instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=ba)}-1===ba.my_types.indexOf(W)&&ba.my_types.push(W);L=new ba.Type(ba,W);L.name=U[0];L.sid=U[2];L.onCreate();cr.seal(L);W.behaviors.push(L)}W.global=P[9];W.isOnLoaderLayout=P[10];W.effect_types=[];w=0;for(I=P[12].length;w<
I;w++)W.effect_types.push({id:P[12][w][0],name:P[12][w][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:w});W.tile_poly_data=P[13];if(!this.uses_loader_layout||W.is_family||W.isOnLoaderLayout||!X.is_world)W.onCreate(),cr.seal(W);W.name&&(this.types[W.name]=W,this.types_lowercase[W.name.toLowerCase()]=W);this.types_by_index.push(W);X.singleglobal&&(w=new X.Instance(W),w.uid=this.next_uid++,w.puid=this.next_puid++,w.iid=0,w.get_iid=cr.inst_get_iid,w.toString=cr.inst_toString,w.properties=P[16],
w.onCreate(),cr.seal(w),W.instances.push(w),this.objectsByUid[w.uid.toString()]=w)}q=0;for(C=f[4].length;q<C;q++)for(L=f[4][q],O=this.types_by_index[L[0]],w=1,I=L.length;w<I;w++)P=this.types_by_index[L[w]],P.families.push(O),O.members.push(P);q=0;for(C=f[27].length;q<C;q++){L=f[27][q];O=[];w=0;for(I=L.length;w<I;w++)O.push(this.types_by_index[L[w]]);w=0;for(I=O.length;w<I;w++)O[w].is_contained=!0,O[w].container=O}if(0<this.family_count)for(q=0,C=this.types_by_index.length;q<C;q++)if(P=this.types_by_index[q],
!P.is_family&&P.families.length){P.family_var_map=Array(this.family_count);P.family_beh_map=Array(this.family_count);P.family_fx_map=Array(this.family_count);W=[];w=ba=Y=U=0;for(I=P.families.length;w<I;w++)for(X=P.families[w],P.family_var_map[X.family_index]=U,U+=X.vars_count,P.family_beh_map[X.family_index]=Y,Y+=X.behs_count,P.family_fx_map[X.family_index]=ba,ba+=X.fx_count,L=0,O=X.effect_types.length;L<O;L++)W.push(cr.shallowCopy({},X.effect_types[L]));P.effect_types=W.concat(P.effect_types);w=
0;for(I=P.effect_types.length;w<I;w++)P.effect_types[w].index=w}q=0;for(C=f[5].length;q<C;q++)P=f[5][q],w=new cr.layout(this,P),cr.seal(w),this.layouts[w.name]=w,this.layouts_by_index.push(w);q=0;for(C=f[6].length;q<C;q++)P=f[6][q],w=new cr.eventsheet(this,P),cr.seal(w),this.eventsheets[w.name]=w,this.eventsheets_by_index.push(w);q=0;for(C=this.eventsheets_by_index.length;q<C;q++)this.eventsheets_by_index[q].postInit();q=0;for(C=this.eventsheets_by_index.length;q<C;q++)this.eventsheets_by_index[q].updateDeepIncludes();
q=0;for(C=this.triggers_to_postinit.length;q<C;q++)this.triggers_to_postinit[q].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_files_info=f[7];this.audio_files_map={};q=0;for(C=this.audio_files_info.length;q<C;++q)w=this.audio_files_info[q],this.audio_files_map[w[0]]=w[1];this.files_subfolder=f[8];this.pixel_rounding=f[9];this.aspect_scale=1;this.enableWebGL=f[13];this.linearSampling=f[14];this.clearBackground=f[15];this.versionstr=f[16];this.useHighDpi=f[17];this.orientations=f[20];
this.autoLockOrientation=0<this.orientations;this.pauseOnBlur=f[22];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=f[23];this.downscalingQuality=f[24];this.preloadSounds=f[25];this.enableFrontToBack=f[26]&&!this.isIE;this.enhancedAccelerationPrecision=f[30];this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.preloadSounds||t["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise();this.initRendererAndLoader()};var z=!1;b.prototype.waitForImageLoad=
function(f,q){window.cr_remotePreviewImageFiles&&q&&"blob:"!==q.substr(0,5)&&(q=window.cr_remotePreviewImageFiles[q]);f.onerror=function(x){z=f.c2error=!0;console&&console.error&&console.error("Error loading image '"+f.src+"': ",x)};f.src||("undefined"!==typeof XAPKReader?XAPKReader.get(q,function(x){f.src=x},function(x){z=f.c2error=!0;console&&console.error&&console.error("Error extracting image '"+q+"' from expansion file: ",x)}):(f.crossOrigin="anonymous",this.setImageSrc(f,q)));this.wait_for_textures.push(f)};
b.prototype.findWaitingTexture=function(f){var q;var x=0;for(q=this.wait_for_textures.length;x<q;x++)if(this.wait_for_textures[x].cr_src===f)return this.wait_for_textures[x];return null};var G=0,M=!1;b.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var f=[],q;var x=0;for(q=this.audio_files_info.length;x<q;++x){var C=this.audio_files_info[x];var w=C[0];var I=C[2];(C=this.getPreferredAudioFile(w))&&!I&&f.push({filename:w+C[1],size:C[2],type:C[0]})}G=this.audioInstance.setPreloadList(f)}};
b.prototype.areAllTexturesAndSoundsLoaded=function(){var f=G,q=0,x=!0,C;var w=0;for(C=this.wait_for_textures.length;w<C;w++){var I=this.wait_for_textures[w];var L=I.cr_filesize;if(!L||0>=L)L=5E4;f+=L;I.src&&I.complete&&!I.c2error?q+=L:x=!1}x&&this.preloadSounds&&this.audioInstance&&(M||(this.audioInstance.startPreloads(),M=!0),w=this.audioInstance.getPreloadedSize(),q+=w,w<G&&(x=!1));this.progress=0==f?1:q/f;return x};var l=!1;b.prototype.go=function(){if(this.ctx||this.glwrap){var f=this.ctx||this.overlay_ctx;
if(0<this.fullscreen_mode){var q=window.innerWidth,x=window.innerHeight;this.lastWindowWidth===q&&this.lastWindowHeight===x||this.setSize(q,x)}this.progress=0;this.last_progress=-1;var C=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||l))this.useFbInstant?FBInstant.startGameAsync().then(function(){C.go_loading_finished()}):this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);x=Date.now()-this.start_time;if(f){var w=this.width,I=this.height;
q=this.devicePixelRatio;if(3>this.loaderstyle&&500<=x&&this.last_progress!=this.progress){f.clearRect(0,0,w,I);x=w/2;I/=2;w=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete;var L=40*q,O=0,P=80*q;if(w){var X=this.loaderlogos.logo;P=X.width*q;var W=X.height*q;L=P/2;O=W/2;f.drawImage(X,cr.floor(x-L),cr.floor(I-O),P,W)}1>=this.loaderstyle?(I+=O+(w?12*q:0),x=cr.floor(x-L)+.5,I=cr.floor(I)+.5,f.fillStyle=z?"red":"DodgerBlue",f.fillRect(x,I,Math.floor(P*this.progress),6*q),f.strokeStyle=
"black",f.strokeRect(x,I,P,6*q),f.strokeStyle="white",f.strokeRect(x-1*q,I-1*q,P+2*q,8*q)):2===this.loaderstyle&&(f.font="12pt Arial",f.fillStyle=z?"#f00":"#999",f.textBaseLine="middle",q=Math.round(100*this.progress)+"%",w=f.measureText?f.measureText(q):null,f.fillText(q,x-(w?w.width:0)/2,I));this.last_progress=this.progress}else if(4===this.loaderstyle){this.draw_c3_splash_loader(f);p?p(function(){C.go()}):setTimeout(function(){C.go()},16);return}}setTimeout(function(){C.go()},100)}}};var r=-1,
y=!0,N=!1,Q=0,E=0,d=null,h=null,B=0;b.prototype.draw_c3_splash_loader=function(f){if(!l){var q=this.isPreview||this.useFbInstant,x=q?0:200,C=q?0:3E3,w=Math.ceil(this.width),I=Math.ceil(this.height),L=this.loaderlogos.logo,O=this.loaderlogos.powered,P=this.loaderlogos.website;if(L.complete){for(var X=0;3>X;++X)if(!O[X].complete||!P[X].complete)return;0===B&&(r=Date.now());X=Date.now();var W=!1,U=f;y||N?(f.clearRect(0,0,w,I),d&&d.width===w&&d.height===I||(d=document.createElement("canvas"),d.width=
w,d.height=I,h=d.getContext("2d")),U=h,W=!0,y&&1===B&&(r=Date.now())):f.globalAlpha=1;U.fillStyle="#3B4045";U.fillRect(0,0,w,I);try{if(256<this.cssHeight){var Y=1.5*cr.clamp(.22*I,105,.6*w);var ba=Y/8;U.drawImage(128>=Y?O[2]:256>=Y?O[1]:O[0],.5*w-Y/2,.2*I-ba/2,Y,ba);ba=Y=Math.min(.395*I,.95*w);U.drawImage(L,.5*w-Y/2,.485*I-ba/2,Y,ba);Y=1.5*cr.clamp(.22*I,105,.6*w);ba=Y/8;U.drawImage(128>=Y?P[2]:256>=Y?P[1]:P[0],.5*w-Y/2,.868*I-ba/2,Y,ba);U.fillStyle="#4D565D";Y=w;ba=Math.max(.005*I,2);U.fillRect(0,
.8*I-ba/2,Y,ba);U.fillStyle=z?"red":"#29F3D0";Y=w*this.progress;U.fillRect(.5*w-Y/2,.8*I-ba/2,Y,ba)}else ba=Y=.55*I,U.drawImage(L,.5*w-Y/2,.45*I-ba/2,Y,ba),U.fillStyle="#4D565D",Y=w,ba=Math.max(.005*I,2),U.fillRect(0,.85*I-ba/2,Y,ba),U.fillStyle=z?"red":"#29F3D0",Y=w*this.progress,U.fillRect(.5*w-Y/2,.85*I-ba/2,Y,ba);W&&(y?f.globalAlpha=0===B?0:Math.min((X-r)/300,1):N&&(f.globalAlpha=Math.max(1-(X-E)/300,0)),f.drawImage(d,0,0,w,I))}catch(ca){}y&&300<=X-r&&2<=B&&(y=!1,Q=X);!y&&X-Q>=C&&!N&&1<=this.progress&&
(N=!0,E=X);if(N&&X-E>=300+x||q&&1<=this.progress&&500>Date.now()-r)l=!0,N=y=!1,this.loaderlogos=h=d=null;++B}}};b.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var f=this;Promise.all(this.webFontNames.map(function(q){return document.fonts.load("1em '"+q+"'")})).then(function(){f.start_first_layout()})}else this.start_first_layout()};b.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),
this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var f;if(this.uses_loader_layout){var q=0;for(f=this.types_by_index.length;q<f;q++){var x=this.types_by_index[q];x.is_family||x.isOnLoaderLayout||!x.plugin.is_world||(x.onCreate(),cr.seal(x))}}else this.isloading=!1;q=0;for(f=this.layouts_by_index.length;q<f;q++)this.layouts_by_index[q].createGlobalNonWorlds();2<=this.fullscreen_mode&&(q=this.original_width/this.original_height,f=this.width/
this.height,this.aspect_scale=2!==this.fullscreen_mode&&f>q||2===this.fullscreen_mode&&f<q?this.height/this.original_height:this.width/this.original_width);q=0;for(f=this.types_by_index.length;q<f;q++)if(x=this.types_by_index[q],x.onBeforeAppBegin)x.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&
window.C3_RegisterSW());navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide();q=0;for(f=this.types_by_index.length;q<f;q++)if(x=this.types_by_index[q],x.onAppBegin)x.onAppBegin();q=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",q,!1);document.addEventListener("mozvisibilitychange",q,!1);document.addEventListener("webkitvisibilitychange",
q,!1);document.addEventListener("msvisibilitychange",q,!1);this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)}));document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1)};b.prototype.tick=function(f,q,x){if(this.running_layout){var C=cr.performance_now();if(x||!this.isSuspended||f){f||(p?this.raf_id=p(this.tickFunc):this.timeout_id=
setTimeout(this.tickFunc,this.isMobile?1:16));q=q||C;var w=this.fullscreen_mode;(x=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(w=this.fullscreen_scaling);if(0<w){w=window.innerWidth;var I=window.innerHeight;this.lastWindowWidth===w&&this.lastWindowHeight===I||this.setSize(w,I)}x?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&
this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height);this.isloading&&(x=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,x&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW()));this.logic(q);!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||f||(this.redraw=
!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-C}}};b.prototype.logic=
function(f){var q;1E3<=f-this.last_fps_time&&(this.last_fps_time+=1E3,1E3<=f-this.last_fps_time&&(this.last_fps_time=f),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1E3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1));this.glwrap&&-1===this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,
this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0));if(0!==this.last_tick_time){var x=f-this.last_tick_time;0>x&&(x=0);this.dt1=x/1E3;.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=f;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);
f=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||f&&0<this.fullscreen_scaling){x=this.original_width/this.original_height;var C=this.width/this.height;var w=this.fullscreen_mode;f&&0<this.fullscreen_scaling&&(w=this.fullscreen_scaling);this.aspect_scale=2!==w&&C>x||2===w&&C<x?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),
this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;C=this.objects_to_pretick.valuesRef();f=0;for(x=C.length;f<x;f++)C[f].pretick();f=0;for(x=this.types_by_index.length;f<x;f++){var I=this.types_by_index[f];if(!I.is_family&&(I.behaviors.length||I.families.length))for(C=0,w=I.instances.length;C<w;C++){var L=
I.instances[C];var O=0;for(q=L.behavior_insts.length;O<q;O++)L.behavior_insts[O].tick()}}f=0;for(x=this.types_by_index.length;f<x;f++)if(I=this.types_by_index[f],!I.is_family&&(I.behaviors.length||I.families.length))for(C=0,w=I.instances.length;C<w;C++)for(L=I.instances[C],O=0,q=L.behavior_insts.length;O<q;O++){var P=L.behavior_insts[O];P.posttick&&P.posttick()}C=this.objects_to_tick.valuesRef();f=0;for(x=C.length;f<x;f++)C[f].tick();this.isInOnDestroy--;this.handleSaveLoad();for(f=0;this.changelayout&&
10>f++;)this.doChangeLayout(this.changelayout);f=0;for(x=this.eventsheets_by_index.length;f<x;f++)this.eventsheets_by_index[f].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();cr.clearArray(this.registered_collisions);this.layout_first_tick=!1;this.isInOnDestroy++;f=0;for(x=this.types_by_index.length;f<x;f++)if(I=this.types_by_index[f],!I.is_family&&(I.behaviors.length||I.families.length))for(C=0,w=I.instances.length;C<w;C++)for(L=I.instances[C],O=0,q=L.behavior_insts.length;O<
q;O++)P=L.behavior_insts[O],P.tick2&&P.tick2();C=this.objects_to_tick2.valuesRef();f=0;for(x=C.length;f<x;f++)C[f].tick2();this.isInOnDestroy--};b.prototype.onWindowBlur=function(){var f,q,x;var C=0;for(f=this.types_by_index.length;C<f;C++){var w=this.types_by_index[C];if(!w.is_family){var I=0;for(q=w.instances.length;I<q;I++){var L=w.instances[I];if(L.onWindowBlur)L.onWindowBlur();if(L.behavior_insts){var O=0;for(x=L.behavior_insts.length;O<x;O++){var P=L.behavior_insts[O];if(P.onWindowBlur)P.onWindowBlur()}}}}}};
b.prototype.doChangeLayout=function(f){var q=this.running_layout;this.running_layout.stopRunning();var x;if(this.glwrap){var C=0;for(x=this.types_by_index.length;C<x;C++){var w=this.types_by_index[C];w.is_family||!w.unloadTextures||w.global&&0!==w.instances.length||-1!==f.initial_types.indexOf(w)||w.unloadTextures()}}q==f&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);f.startRunning();this.runLayoutChangeMethods(!1);this.layout_first_tick=
this.redraw=!0;this.ClearDeathRow()};b.prototype.runLayoutChangeMethods=function(f){var q,x,C;var w=0;for(q=this.behaviors.length;w<q;w++){var I=this.behaviors[w];if(f){if(I.onBeforeLayoutChange)I.onBeforeLayoutChange()}else if(I.onLayoutChange)I.onLayoutChange()}w=0;for(q=this.types_by_index.length;w<q;w++)if(I=this.types_by_index[w],I.global||I.plugin.singleglobal){var L=0;for(x=I.instances.length;L<x;L++){var O=I.instances[L];if(f){if(O.onBeforeLayoutChange)O.onBeforeLayoutChange()}else if(O.onLayoutChange)O.onLayoutChange();
if(O.behavior_insts){var P=0;for(C=O.behavior_insts.length;P<C;P++){var X=O.behavior_insts[P];if(f){if(X.onBeforeLayoutChange)X.onBeforeLayoutChange()}else if(X.onLayoutChange)X.onLayoutChange()}}}}};b.prototype.pretickMe=function(f){this.objects_to_pretick.add(f)};b.prototype.unpretickMe=function(f){this.objects_to_pretick.remove(f)};b.prototype.tickMe=function(f){this.objects_to_tick.add(f)};b.prototype.untickMe=function(f){this.objects_to_tick.remove(f)};b.prototype.tick2Me=function(f){this.objects_to_tick2.add(f)};
b.prototype.untick2Me=function(f){this.objects_to_tick2.remove(f)};b.prototype.getDt=function(f){return f&&-1!==f.my_timescale?this.dt1*f.my_timescale:this.dt};b.prototype.draw=function(){this.running_layout.draw(this.ctx)};b.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));this.running_layout.drawGL(this.glwrap);this.glwrap.present()};b.prototype.addDestroyCallback=function(f){f&&this.destroycallbacks.push(f)};b.prototype.removeDestroyCallback=
function(f){cr.arrayFindRemove(this.destroycallbacks,f)};b.prototype.getObjectByUID=function(f){f=f.toString();return this.objectsByUid.hasOwnProperty(f)?this.objectsByUid[f]:null};var e=[];b.prototype.DestroyInstance=function(f){var q;var x=f.type.name;if(this.deathRow.hasOwnProperty(x)){var C=this.deathRow[x];if(C.contains(f))return}else C=e.length?e.pop():new cr.ObjectSet,this.deathRow[x]=C;f.isDestroyed=!0;C.add(f);this.hasPendingInstances=!0;if(f.is_contained)for(x=0,q=f.siblings.length;x<q;x++)this.DestroyInstance(f.siblings[x]);
this.isInClearDeathRow&&C.values_cache.push(f);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(f.type.plugin).cnds.OnDestroyed,f),this.isInOnDestroy--)};b.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var f,q;this.isInClearDeathRow=!0;var x=0;for(f=this.createRow.length;x<f;++x){var C=this.createRow[x];var w=C.type;w.instances.push(C);var I=0;for(q=w.families.length;I<q;++I)w.families[I].instances.push(C),w.families[I].stale_iids=!0}cr.clearArray(this.createRow);
this.IterateDeathRow();cr.wipe(this.deathRow);this.hasPendingInstances=this.isInClearDeathRow=!1}};b.prototype.IterateDeathRow=function(){for(var f in this.deathRow)this.deathRow.hasOwnProperty(f)&&this.ClearDeathRowForType(this.deathRow[f])};b.prototype.ClearDeathRowForType=function(f){var q=f.valuesRef(),x=q[0].type,C,w;cr.arrayRemoveAllFromObjectSet(x.instances,f);x.stale_iids=!0;0===x.instances.length&&(x.any_instance_parallaxed=!1);var I=0;for(C=x.families.length;I<C;++I){var L=x.families[I];
cr.arrayRemoveAllFromObjectSet(L.instances,f);L.stale_iids=!0}I=0;for(C=this.system.waits.length;I<C;++I){var O=this.system.waits[I];O.sols.hasOwnProperty(x.index)&&cr.arrayRemoveAllFromObjectSet(O.sols[x.index].insts,f);if(!x.is_family){var P=0;for(w=x.families.length;P<w;++P)L=x.families[P],O.sols.hasOwnProperty(L.index)&&cr.arrayRemoveAllFromObjectSet(O.sols[L.index].insts,f)}}if(O=q[0].layer){if(O.useRenderCells)for(P=O.instances,I=0,C=P.length;I<C;++I)w=P[I],f.contains(w)&&(w.update_bbox(),O.render_grid.update(w,
w.rendercells,null),w.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(O.instances,f);O.setZIndicesStaleFrom(0)}for(I=0;I<q.length;++I)this.ClearDeathRowForSingleInstance(q[I],x);f.clear();e.push(f);this.redraw=!0};b.prototype.ClearDeathRowForSingleInstance=function(f,q){var x;var C=0;for(x=this.destroycallbacks.length;C<x;++C)this.destroycallbacks[C](f);f.collcells&&q.collision_grid.update(f,f.collcells,null);(C=f.layer)&&C.removeFromInstanceList(f,!0);if(f.behavior_insts)for(C=0,x=f.behavior_insts.length;C<
x;++C){var w=f.behavior_insts[C];if(w.onDestroy)w.onDestroy();w.behavior.my_instances.remove(f)}this.objects_to_pretick.remove(f);this.objects_to_tick.remove(f);this.objects_to_tick2.remove(f);if(f.onDestroy)f.onDestroy();this.objectsByUid.hasOwnProperty(f.uid.toString())&&delete this.objectsByUid[f.uid.toString()];this.objectcount--;100>q.deadCache.length&&q.deadCache.push(f)};b.prototype.createInstance=function(f,q,x,C){if(f.is_family){var w=cr.floor(Math.random()*f.members.length);return this.createInstance(f.members[w],
q,x,C)}return f.default_instance?this.createInstanceFromInit(f.default_instance,q,!1,x,C,!1):null};var u=[];b.prototype.createInstanceFromInit=function(f,q,x,C,w,I){var L,O;if(!f)return null;var P=this.types_by_index[f[1]],X=P.plugin.is_world;if(this.isloading&&X&&!P.isOnLoaderLayout||X&&!this.glwrap&&11===f[0][11])return null;var W=q;X||(q=null);if(P.deadCache.length){var U=P.deadCache.pop();U.recycled=!0;P.plugin.Instance.call(U,P)}else U=new P.plugin.Instance(P),U.recycled=!1;!x||I||this.objectsByUid.hasOwnProperty(f[2].toString())?
U.uid=this.next_uid++:U.uid=f[2];this.objectsByUid[U.uid.toString()]=U;U.puid=this.next_puid++;U.iid=P.instances.length;var Y=0;for(L=this.createRow.length;Y<L;++Y)this.createRow[Y].type===P&&U.iid++;U.get_iid=cr.inst_get_iid;U.toString=cr.inst_toString;U.isDestroyed=!1;var ba=f[3];if(U.recycled)cr.wipe(U.extra);else{U.extra={};if(this.isPreview)for(U.instance_var_names=[],U.instance_var_names.length=ba.length,Y=0,L=ba.length;Y<L;Y++)U.instance_var_names[Y]=ba[Y][1];U.instance_vars=[];U.instance_vars.length=
ba.length}Y=0;for(L=ba.length;Y<L;Y++)U.instance_vars[Y]=ba[Y][0];if(X){var ca=f[0];U.x=cr.is_undefined(C)?ca[0]:C;U.y=cr.is_undefined(w)?ca[1]:w;U.z=ca[2];U.width=ca[3];U.height=ca[4];U.depth=ca[5];U.angle=ca[6];U.opacity=ca[7];U.hotspotX=ca[8];U.hotspotY=ca[9];U.blend_mode=ca[10];Y=ca[11];!this.glwrap&&P.effect_types.length&&(U.blend_mode=Y);U.compositeOp=cr.effectToCompositeOp(U.blend_mode);this.gl&&cr.setGLBlend(U,U.blend_mode,this.gl);if(U.recycled){Y=0;for(L=ca[12].length;Y<L;Y++)for(ba=0,O=
ca[12][Y].length;ba<O;ba++)U.effect_params[Y][ba]=ca[12][Y][ba],Array.isArray(U.effect_params[Y][ba])&&(U.effect_params[Y][ba]=U.effect_params[Y][ba].slice(0));U.bbox.set(0,0,0,0);U.collcells.set(0,0,-1,-1);U.rendercells.set(0,0,-1,-1);U.bquad.set_from_rect(U.bbox);cr.clearArray(U.bbox_changed_callbacks)}else{U.effect_params=ca[12].slice(0);Y=0;for(L=U.effect_params.length;Y<L;Y++)for(U.effect_params[Y]=ca[12][Y].slice(0),ba=0,O=U.effect_params[Y].length;ba<O;++ba)Array.isArray(U.effect_params[Y][ba])&&
(U.effect_params[Y][ba]=U.effect_params[Y][ba].slice(0));U.active_effect_types=[];U.active_effect_flags=[];U.active_effect_flags.length=P.effect_types.length;U.bbox=new cr.rect(0,0,0,0);U.collcells=new cr.rect(0,0,-1,-1);U.rendercells=new cr.rect(0,0,-1,-1);U.bquad=new cr.quad;U.bbox_changed_callbacks=[];U.set_bbox_changed=cr.set_bbox_changed;U.add_bbox_changed_callback=cr.add_bbox_changed_callback;U.contains_pt=cr.inst_contains_pt;U.update_bbox=cr.update_bbox;U.update_render_cell=cr.update_render_cell;
U.update_collision_cell=cr.update_collision_cell;U.get_zindex=cr.inst_get_zindex}U.tilemap_exists=!1;U.tilemap_width=0;U.tilemap_height=0;U.tilemap_data=null;14===ca.length&&(U.tilemap_exists=!0,U.tilemap_width=ca[13][0],U.tilemap_height=ca[13][1],U.tilemap_data=ca[13][2]);Y=0;for(L=P.effect_types.length;Y<L;Y++)U.active_effect_flags[Y]=!0;U.shaders_preserve_opaqueness=!0;U.updateActiveEffects=cr.inst_updateActiveEffects;U.updateActiveEffects();U.uses_shaders=!!U.active_effect_types.length;U.bbox_changed=
!0;U.cell_changed=!0;P.any_cell_changed=!0;U.visible=!0;U.my_timescale=-1;U.layer=q;U.zindex=q.instances.length;U.earlyz_index=0;"undefined"===typeof U.collision_poly&&(U.collision_poly=null);this.redraw=U.collisionsEnabled=!0}cr.clearArray(u);Y=0;for(L=P.families.length;Y<L;Y++)u.push.apply(u,P.families[Y].behaviors);u.push.apply(u,P.behaviors);if(U.recycled)for(Y=0,L=u.length;Y<L;Y++){var ea=u[Y];var da=U.behavior_insts[Y];da.recycled=!0;ea.behavior.Instance.call(da,ea,U);ca=f[4][Y];ba=0;for(O=
ca.length;ba<O;ba++)da.properties[ba]=ca[ba];da.onCreate();ea.behavior.my_instances.add(U)}else for(U.behavior_insts=[],Y=0,L=u.length;Y<L;Y++)ea=u[Y],da=new ea.behavior.Instance(ea,U),da.recycled=!1,da.properties=f[4][Y].slice(0),da.onCreate(),cr.seal(da),U.behavior_insts.push(da),ea.behavior.my_instances.add(U);ca=f[5];if(U.recycled)for(Y=0,L=ca.length;Y<L;Y++)U.properties[Y]=ca[Y];else U.properties=ca.slice(0);this.createRow.push(U);this.hasPendingInstances=!0;q&&(q.appendToInstanceList(U,!0),
1!==q.parallaxX||1!==q.parallaxY)&&(P.any_instance_parallaxed=!0);this.objectcount++;if(P.is_contained){if(U.is_contained=!0,U.recycled?cr.clearArray(U.siblings):U.siblings=[],!x&&!I){Y=0;for(L=P.container.length;Y<L;Y++)if(P.container[Y]!==P){if(!P.container[Y].default_instance)return null;U.siblings.push(this.createInstanceFromInit(P.container[Y].default_instance,W,!1,X?U.x:C,X?U.y:w,!0))}Y=0;for(L=U.siblings.length;Y<L;Y++)for(U.siblings[Y].siblings.push(U),ba=0;ba<L;ba++)Y!==ba&&U.siblings[Y].siblings.push(U.siblings[ba])}}else U.is_contained=
!1,U.siblings=null;U.onCreate();U.recycled||cr.seal(U);Y=0;for(L=U.behavior_insts.length;Y<L;Y++)U.behavior_insts[Y].postCreate&&U.behavior_insts[Y].postCreate();return U};b.prototype.getLayerByName=function(f){var q;var x=0;for(q=this.running_layout.layers.length;x<q;x++){var C=this.running_layout.layers[x];if(cr.equals_nocase(C.name,f))return C}return null};b.prototype.getLayerByNumber=function(f){f=cr.floor(f);0>f&&(f=0);f>=this.running_layout.layers.length&&(f=this.running_layout.layers.length-
1);return this.running_layout.layers[f]};b.prototype.getLayer=function(f){return cr.is_number(f)?this.getLayerByNumber(f):this.getLayerByName(f.toString())};b.prototype.clearSol=function(f){var q;var x=0;for(q=f.length;x<q;x++)f[x].getCurrentSol().select_all=!0};b.prototype.pushCleanSol=function(f){var q;var x=0;for(q=f.length;x<q;x++)f[x].pushCleanSol()};b.prototype.pushCopySol=function(f){var q;var x=0;for(q=f.length;x<q;x++)f[x].pushCopySol()};b.prototype.popSol=function(f){var q;var x=0;for(q=
f.length;x<q;x++)f[x].popSol()};b.prototype.updateAllCells=function(f){if(f.any_cell_changed){var q,x=f.instances;var C=0;for(q=x.length;C<q;++C)x[C].update_collision_cell();x=this.createRow;C=0;for(q=x.length;C<q;++C)x[C].type===f&&x[C].update_collision_cell();f.any_cell_changed=!1}};b.prototype.getCollisionCandidates=function(f,q,x,C){var w,I=f?1!==f.parallaxX||1!==f.parallaxY:!1;if(q.is_family)for(f=0,w=q.members.length;f<w;++f){var L=q.members[f];I||L.any_instance_parallaxed?cr.appendArray(C,
L.instances):(this.updateAllCells(L),L.collision_grid.queryRange(x,C))}else I||q.any_instance_parallaxed?cr.appendArray(C,q.instances):(this.updateAllCells(q),q.collision_grid.queryRange(x,C))};b.prototype.getTypesCollisionCandidates=function(f,q,x,C){var w;var I=0;for(w=q.length;I<w;++I)this.getCollisionCandidates(f,q[I],x,C)};b.prototype.getSolidCollisionCandidates=function(f,q,x){var C=this.getSolidBehavior();if(!C)return null;this.getTypesCollisionCandidates(f,C.my_types,q,x)};b.prototype.getJumpthruCollisionCandidates=
function(f,q,x){var C=this.getJumpthruBehavior();if(!C)return null;this.getTypesCollisionCandidates(f,C.my_types,q,x)};b.prototype.testAndSelectCanvasPointOverlap=function(f,q,x,C){var w=f.getCurrentSol(),I,L=this.getCurrentEventStack().current_event.orblock;if(w.select_all){C||(w.select_all=!1,cr.clearArray(w.instances));var O=0;for(I=f.instances.length;O<I;O++){var P=f.instances[O];P.update_bbox();var X=P.layer.canvasToLayer(q,x,!0);var W=P.layer.canvasToLayer(q,x,!1);if(P.contains_pt(X,W)){if(C)return!1;
w.instances.push(P)}else L&&w.else_instances.push(P)}}else{var U=0;var Y=L?w.else_instances:w.instances;O=0;for(I=Y.length;O<I;O++)if(P=Y[O],P.update_bbox(),X=P.layer.canvasToLayer(q,x,!0),W=P.layer.canvasToLayer(q,x,!1),P.contains_pt(X,W)){if(C)return!1;L?w.instances.push(P):(w.instances[U]=w.instances[O],U++)}C||(Y.length=U)}f.applySolToContainer();return C?!0:w.hasObjects()};b.prototype.testOverlap=function(f,q){if(!(f&&q&&f!==q&&f.collisionsEnabled&&q.collisionsEnabled))return!1;f.update_bbox();
q.update_bbox();var x=f.layer,C=q.layer,w;if(x===C||x.parallaxX===C.parallaxX&&C.parallaxY===C.parallaxY&&x.scale===C.scale&&x.angle===C.angle&&x.zoomRate===C.zoomRate){if(!f.bbox.intersects_rect(q.bbox)||!f.bquad.intersects_quad(q.bquad)||f.tilemap_exists&&q.tilemap_exists)return!1;if(f.tilemap_exists)return this.testTilemapOverlap(f,q);if(q.tilemap_exists)return this.testTilemapOverlap(q,f);var I=f.collision_poly&&!f.collision_poly.is_empty();var L=q.collision_poly&&!q.collision_poly.is_empty();
if(!I&&!L)return!0;I?(f.collision_poly.cache_poly(f.width,f.height,f.angle),I=f.collision_poly):(this.temp_poly.set_from_quad(f.bquad,f.x,f.y,f.width,f.height),I=this.temp_poly);if(L){q.collision_poly.cache_poly(q.width,q.height,q.angle);var O=q.collision_poly}else this.temp_poly.set_from_quad(q.bquad,q.x,q.y,q.width,q.height),O=this.temp_poly;return I.intersects_poly(O,q.x-f.x,q.y-f.y)}I=f.collision_poly&&!f.collision_poly.is_empty();L=q.collision_poly&&!q.collision_poly.is_empty();I?(f.collision_poly.cache_poly(f.width,
f.height,f.angle),this.temp_poly.set_from_poly(f.collision_poly)):this.temp_poly.set_from_quad(f.bquad,f.x,f.y,f.width,f.height);I=this.temp_poly;L?(q.collision_poly.cache_poly(q.width,q.height,q.angle),this.temp_poly2.set_from_poly(q.collision_poly)):this.temp_poly2.set_from_quad(q.bquad,q.x,q.y,q.width,q.height);O=this.temp_poly2;L=0;for(w=I.pts_count;L<w;L++){var P=2*L;var X=P+1;var W=I.pts_cache[P];var U=I.pts_cache[X];I.pts_cache[P]=x.layerToCanvas(W+f.x,U+f.y,!0);I.pts_cache[X]=x.layerToCanvas(W+
f.x,U+f.y,!1)}I.update_bbox();L=0;for(w=O.pts_count;L<w;L++)P=2*L,X=P+1,W=O.pts_cache[P],U=O.pts_cache[X],O.pts_cache[P]=C.layerToCanvas(W+q.x,U+q.y,!0),O.pts_cache[X]=C.layerToCanvas(W+q.x,U+q.y,!1);O.update_bbox();return I.intersects_poly(O,0,0)};var F=new cr.quad,H=new cr.rect(0,0,0,0),R=[];b.prototype.testTilemapOverlap=function(f,q){var x,C=q.bbox,w=f.x,I=f.y;f.getCollisionRectCandidates(C,R);var L=q.collision_poly&&!q.collision_poly.is_empty();f=0;for(x=R.length;f<x;++f){var O=R[f];var P=O.rc;
if(C.intersects_rect_off(P,w,I)&&(F.set_from_rect(P),F.offset(w,I),F.intersects_quad(q.bquad)))if(L)if(q.collision_poly.cache_poly(q.width,q.height,q.angle),O.poly){if(O.poly.intersects_poly(q.collision_poly,q.x-(w+P.left),q.y-(I+P.top)))return cr.clearArray(R),!0}else{if(this.temp_poly.set_from_quad(F,0,0,P.right-P.left,P.bottom-P.top),this.temp_poly.intersects_poly(q.collision_poly,q.x,q.y))return cr.clearArray(R),!0}else if(O.poly){if(this.temp_poly.set_from_quad(q.bquad,0,0,q.width,q.height),
O.poly.intersects_poly(this.temp_poly,-(w+P.left),-(I+P.top)))return cr.clearArray(R),!0}else return cr.clearArray(R),!0}cr.clearArray(R);return!1};b.prototype.testRectOverlap=function(f,q){if(!q||!q.collisionsEnabled)return!1;q.update_bbox();if(!q.bbox.intersects_rect(f))return!1;if(q.tilemap_exists){q.getCollisionRectCandidates(f,R);var x,C=q.x,w=q.y;q=0;for(x=R.length;q<x;++q){var I=R[q];var L=I.rc;if(f.intersects_rect_off(L,C,w))if(I.poly){if(this.temp_poly.set_from_rect(f,0,0),I.poly.intersects_poly(this.temp_poly,
-(C+L.left),-(w+L.top)))return cr.clearArray(R),!0}else return cr.clearArray(R),!0}cr.clearArray(R);return!1}F.set_from_rect(f);if(!q.bquad.intersects_quad(F))return!1;if(!q.collision_poly||q.collision_poly.is_empty())return!0;q.collision_poly.cache_poly(q.width,q.height,q.angle);F.offset(-f.left,-f.top);this.temp_poly.set_from_quad(F,0,0,1,1);return q.collision_poly.intersects_poly(this.temp_poly,f.left-q.x,f.top-q.y)};b.prototype.testSegmentOverlap=function(f,q,x,C,w){if(!w||!w.collisionsEnabled)return!1;
w.update_bbox();H.set(cr.min(f,x),cr.min(q,C),cr.max(f,x),cr.max(q,C));if(!w.bbox.intersects_rect(H))return!1;if(w.tilemap_exists){w.getCollisionRectCandidates(H,R);var I,L=w.x,O=w.y;w=0;for(I=R.length;w<I;++w){var P=R[w];var X=P.rc;if(H.intersects_rect_off(X,L,O)&&(F.set_from_rect(X),F.offset(L,O),F.intersects_segment(f,q,x,C)))if(P.poly){if(P.poly.intersects_segment(L+X.left,O+X.top,f,q,x,C))return cr.clearArray(R),!0}else return cr.clearArray(R),!0}cr.clearArray(R);return!1}if(!w.bquad.intersects_segment(f,
q,x,C))return!1;if(!w.collision_poly||w.collision_poly.is_empty())return!0;w.collision_poly.cache_poly(w.width,w.height,w.angle);return w.collision_poly.intersects_segment(w.x,w.y,f,q,x,C)};b.prototype.typeHasBehavior=function(f,q){if(!q)return!1;var x,C;var w=0;for(x=f.behaviors.length;w<x;w++)if(f.behaviors[w].behavior instanceof q)return!0;if(!f.is_family)for(w=0,x=f.families.length;w<x;w++){var I=f.families[w];var L=0;for(C=I.behaviors.length;L<C;L++)if(I.behaviors[L].behavior instanceof q)return!0}return!1};
b.prototype.typeHasNoSaveBehavior=function(f){return this.typeHasBehavior(f,cr.behaviors.NoSave)};b.prototype.typeHasPersistBehavior=function(f){return this.typeHasBehavior(f,cr.behaviors.Persist)};b.prototype.getSolidBehavior=function(){return this.solidBehavior};b.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var S=[];b.prototype.testOverlapSolid=function(f){var q;f.update_bbox();this.getSolidCollisionCandidates(f.layer,f.bbox,S);var x=0;for(q=S.length;x<q;++x){var C=S[x];
if(C.extra.solidEnabled&&this.testOverlap(f,C))return cr.clearArray(S),C}cr.clearArray(S);return null};b.prototype.testRectOverlapSolid=function(f){var q;this.getSolidCollisionCandidates(null,f,S);var x=0;for(q=S.length;x<q;++x){var C=S[x];if(C.extra.solidEnabled&&this.testRectOverlap(f,C))return cr.clearArray(S),C}cr.clearArray(S);return null};var V=[];b.prototype.testOverlapJumpThru=function(f,q){var x=null;q&&(x=V,cr.clearArray(x));f.update_bbox();this.getJumpthruCollisionCandidates(f.layer,f.bbox,
S);var C;var w=0;for(C=S.length;w<C;++w){var I=S[w];if(I.extra.jumpthruEnabled&&this.testOverlap(f,I))if(q)x.push(I);else return cr.clearArray(S),I}cr.clearArray(S);return x};b.prototype.pushOutSolid=function(f,q,x,C,w,I){C=C||50;var L=f.x,O=f.y,P,X=null,W=null;for(P=0;P<C;P++)if(f.x=L+q*P,f.y=O+x*P,f.set_bbox_changed(),!this.testOverlap(f,X)&&((X=this.testOverlapSolid(f))&&(W=X),!X&&(w&&(X=I?this.testOverlap(f,I)?I:null:this.testOverlapJumpThru(f))&&(W=X),!X)))return W&&this.pushInFractional(f,q,
x,W,16),!0;f.x=L;f.y=O;f.set_bbox_changed();return!1};b.prototype.pushOutSolidAxis=function(f,q,x,C){C=C||50;var w=f.x,I=f.y,L=null,O=null,P,X;for(P=0;P<C;++P)for(X=0;2>X;++X){var W=2*X-1;f.x=w+q*P*W;f.y=I+x*P*W;f.set_bbox_changed();if(!this.testOverlap(f,L))if(L=this.testOverlapSolid(f))O=L;else return O&&this.pushInFractional(f,q*W,x*W,O,16),!0}f.x=w;f.y=I;f.set_bbox_changed();return!1};b.prototype.pushOut=function(f,q,x,C,w){C=C||50;var I=f.x,L=f.y,O;for(O=0;O<C;O++)if(f.x=I+q*O,f.y=L+x*O,f.set_bbox_changed(),
!this.testOverlap(f,w))return!0;f.x=I;f.y=L;f.set_bbox_changed();return!1};b.prototype.pushInFractional=function(f,q,x,C,w){var I=2,L=!1;var O=!1;for(var P=f.x,X=f.y;I<=w;)O=1/I,I*=2,f.x+=q*O*(L?1:-1),f.y+=x*O*(L?1:-1),f.set_bbox_changed(),this.testOverlap(f,C)?O=L=!0:(O=L=!1,P=f.x,X=f.y);O&&(f.x=P,f.y=X,f.set_bbox_changed())};b.prototype.pushOutSolidNearest=function(f,q){q=cr.is_undefined(q)?100:q;var x=0,C=f.x,w=f.y,I=0,L=0,O=0,P=this.testOverlapSolid(f);if(!P)return!0;for(;x<=q;){switch(I){case 0:L=
0;O=-1;x++;break;case 1:L=1;O=-1;break;case 2:L=1;O=0;break;case 3:O=L=1;break;case 4:L=0;O=1;break;case 5:L=-1;O=1;break;case 6:L=-1;O=0;break;case 7:O=L=-1}I=(I+1)%8;f.x=cr.floor(C+L*x);f.y=cr.floor(w+O*x);f.set_bbox_changed();if(!this.testOverlap(f,P)&&(P=this.testOverlapSolid(f),!P))return!0}f.x=C;f.y=w;f.set_bbox_changed();return!1};b.prototype.registerCollision=function(f,q){f.collisionsEnabled&&q.collisionsEnabled&&this.registered_collisions.push([f,q])};b.prototype.addRegisteredCollisionCandidates=
function(f,q,x){var C;var w=0;for(C=this.registered_collisions.length;w<C;++w){var I=this.registered_collisions[w];if(I[0]===f)I=I[1];else if(I[1]===f)I=I[0];else continue;if(q.is_family){if(-1===q.members.indexOf(q))continue}else if(I.type!==q)continue;-1===x.indexOf(I)&&x.push(I)}};b.prototype.checkRegisteredCollision=function(f,q){var x;var C=0;for(x=this.registered_collisions.length;C<x;C++){var w=this.registered_collisions[C];if(w[0]===f&&w[1]===q||w[0]===q&&w[1]===f)return!0}return!1};b.prototype.calculateSolidBounceAngle=
function(f,q,x,C){var w=f.x,I=f.y,L=cr.max(10,cr.distanceTo(q,x,w,I)),O=cr.angleTo(q,x,w,I),P=C||this.testOverlapSolid(f);if(!P)return cr.clamp_angle(O+cr.PI);var X=P,W,U=cr.to_radians(5);for(W=1;36>W;W++){var Y=O-W*U;f.x=q+Math.cos(Y)*L;f.y=x+Math.sin(Y)*L;f.set_bbox_changed();if(!this.testOverlap(f,X)&&(X=C?null:this.testOverlapSolid(f),!X)){var ba=Y;break}}36===W&&(ba=cr.clamp_angle(O+cr.PI));X=P;for(W=1;36>W;W++)if(Y=O+W*U,f.x=q+Math.cos(Y)*L,f.y=x+Math.sin(Y)*L,f.set_bbox_changed(),!this.testOverlap(f,
X)&&(X=C?null:this.testOverlapSolid(f),!X)){var ca=Y;break}36===W&&(ca=cr.clamp_angle(O+cr.PI));f.x=w;f.y=I;f.set_bbox_changed();if(ca===ba)return ca;f=cr.angleDiff(ca,ba)/2;f=cr.angleClockwise(ca,ba)?cr.clamp_angle(ba+f+cr.PI):cr.clamp_angle(ca+f);ba=Math.cos(O);O=Math.sin(O);ca=Math.cos(f);f=Math.sin(f);q=ba*ca+O*f;return cr.angleTo(0,0,ba-2*q*ca,O-2*q*f)};var T=-1;b.prototype.trigger=function(f,q,x){if(!this.running_layout)return!1;var C=this.running_layout.event_sheet;if(!C)return!1;var w=!1,
I;T++;var L=C.deep_includes;var O=0;for(I=L.length;O<I;++O){var P=this.triggerOnSheet(f,q,L[O],x);w=w||P}P=this.triggerOnSheet(f,q,C,x);T--;return w||P};b.prototype.triggerOnSheet=function(f,q,x,C){var w=!1,I;if(q){var L=this.triggerOnSheetForTypeName(f,q,q.type.name,x,C);w=w||L;var O=q.type.families;var P=0;for(I=O.length;P<I;++P)L=this.triggerOnSheetForTypeName(f,q,O[P].name,x,C),w=w||L}else L=this.triggerOnSheetForTypeName(f,q,"system",x,C),w=w||L;return w};b.prototype.triggerOnSheetForTypeName=
function(f,q,x,C,w){var I,L=!1;var O="undefined"!==typeof w;var P=(O?C.fasttriggers:C.triggers)[x];if(!P)return L;var X=null;C=0;for(I=P.length;C<I;++C)if(P[C].method==f){X=P[C].evs;break}if(!X)return L;f=O?X[w]:X;if(!f)return null;C=0;for(I=f.length;C<I;C++)w=f[C][0],O=f[C][1],w=this.executeSingleTrigger(q,x,w,O),L=L||w;return L};b.prototype.executeSingleTrigger=function(f,q,x,C){var w,I=!1;this.trigger_depth++;var L=this.getCurrentEventStack().current_event;L&&this.pushCleanSol(L.solModifiersIncludingParents);
var O=1<this.trigger_depth;this.pushCleanSol(x.solModifiersIncludingParents);O&&this.pushLocalVarStack();var P=this.pushEventStack(x);P.current_event=x;if(f){var X=this.types[q].getCurrentSol();X.select_all=!1;cr.clearArray(X.instances);X.instances[0]=f;this.types[q].applySolToContainer()}f=!0;if(x.parent){q=P.temp_parents_arr;for(X=x.parent;X;)q.push(X),X=X.parent;q.reverse();X=0;for(w=q.length;X<w;X++)if(!q[X].run_pretrigger()){f=!1;break}}f&&(this.execcount++,x.orblock?x.run_orblocktrigger(C):
x.run(),I=I||P.last_event_true);this.popEventStack();O&&this.popLocalVarStack();this.popSol(x.solModifiersIncludingParents);L&&this.popSol(L.solModifiersIncludingParents);this.hasPendingInstances&&0===this.isInOnDestroy&&0===T&&!this.isRunningEvents&&this.ClearDeathRow();this.trigger_depth--;return I};b.prototype.getCurrentCondition=function(){var f=this.getCurrentEventStack();return f.current_event.conditions[f.cndindex]};b.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type};
b.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex};b.prototype.getCurrentAction=function(){var f=this.getCurrentEventStack();return f.current_event.actions[f.actindex]};b.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};b.prototype.popLocalVarStack=function(){this.localvar_stack_index--};b.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};
b.prototype.pushEventStack=function(f){this.event_stack_index++;this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var q=this.getCurrentEventStack();q.reset(f);return q};b.prototype.popEventStack=function(){this.event_stack_index--};b.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};b.prototype.pushLoopStack=function(f){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:f,
index:0,stopped:!1}));var q=this.getCurrentLoop();q.name=f;q.index=0;q.stopped=!1;return q};b.prototype.popLoopStack=function(){this.loop_stack_index--};b.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};b.prototype.getEventVariableByName=function(f,q){for(var x,C,w,I,L;q;){x=0;for(C=q.subevents.length;x<C;x++)if(L=q.subevents[x],L instanceof cr.eventvariable&&cr.equals_nocase(f,L.name))return L;q=q.parent}x=0;for(C=this.eventsheets_by_index.length;x<C;x++)for(I=
this.eventsheets_by_index[x],q=0,w=I.events.length;q<w;q++)if(L=I.events[q],L instanceof cr.eventvariable&&cr.equals_nocase(f,L.name))return L;return null};b.prototype.getLayoutBySid=function(f){var q;var x=0;for(q=this.layouts_by_index.length;x<q;x++)if(this.layouts_by_index[x].sid===f)return this.layouts_by_index[x];return null};b.prototype.getObjectTypeBySid=function(f){var q;var x=0;for(q=this.types_by_index.length;x<q;x++)if(this.types_by_index[x].sid===f)return this.types_by_index[x];return null};
b.prototype.getGroupBySid=function(f){var q;var x=0;for(q=this.allGroups.length;x<q;x++)if(this.allGroups[x].sid===f)return this.allGroups[x];return null};b.prototype.requirePermissions=function(f){return this.getPermissions(f).then(function(q){if(!1===q)return Promise.reject("Permission not granted")})};b.prototype.getPermissions=function(f){return this.isCordova&&this.isAndroid?f.reduce(function(q,x){return q.then(function(C){return!1===C?!1:A(x).then(function(w){return w?!0:v(x)})})},Promise.resolve(!0)):
Promise.resolve(!0)};b.prototype.doCanvasSnapshot=function(f,q){this.snapshotCanvas=[f,q];this.redraw=!0};b.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};b.prototype.handleSaveLoad=function(){var f=this,q=this.saveToSlot,x=this.lastSaveJson,C=this.loadFromSlot,w=!1;this.signalledContinuousPreview&&(w=!0,q="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(q.length){this.ClearDeathRow();x=this.saveToJSONString();if(J())n(q,x,function(){cr.logexport("Saved state to IndexedDB storage ("+
x.length+" bytes)");f.lastSaveJson=x;f.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);x=f.lastSaveJson="";w&&c()},function(I){try{localStorage.setItem("__c2save_"+q,x),cr.logexport("Saved state to WebStorage ("+x.length+" bytes)"),f.lastSaveJson=x,f.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),x=f.lastSaveJson="",w&&c()}catch(L){cr.logexport("Failed to save game state: "+I+"; "+L),f.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+
q,x),cr.logexport("Saved state to WebStorage ("+x.length+" bytes)"),f.lastSaveJson=x,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),x=f.lastSaveJson="",w&&c()}catch(I){cr.logexport("Error saving to WebStorage: "+I),f.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null}if(C.length){if(J())a(C,function(I){I?(f.loadFromJson=I,cr.logexport("Loaded state from IndexedDB storage ("+f.loadFromJson.length+" bytes)")):(f.loadFromJson=
localStorage.getItem("__c2save_"+C)||"",cr.logexport("Loaded state from WebStorage ("+f.loadFromJson.length+" bytes)"));f.suspendDrawing=!1;f.loadFromJson||(f.loadFromJson=null,f.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(I){f.loadFromJson=localStorage.getItem("__c2save_"+C)||"";cr.logexport("Loaded state from WebStorage ("+f.loadFromJson.length+" bytes)");f.suspendDrawing=!1;f.loadFromJson||(f.loadFromJson=null,f.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});
else{try{this.loadFromJson=localStorage.getItem("__c2save_"+C)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(I){this.loadFromJson=null}this.suspendDrawing=!1;f.loadFromJson||(f.loadFromJson=null,f.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.saveToSlot=this.loadFromSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,
null),this.lastSaveJson=""):f.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};b.prototype.saveToJSONString=function(){var f,q,x,C={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};var w=0;for(f=
this.types_by_index.length;w<f;w++){var I=this.types_by_index[w];if(!I.is_family&&!this.typeHasNoSaveBehavior(I)){var L={instances:[]};cr.hasAnyOwnProperty(I.extra)&&(L.ex=g(I.extra));var O=0;for(q=I.instances.length;O<q;O++)L.instances.push(this.saveInstanceToJSON(I.instances[O]));C.types[I.sid.toString()]=L}}w=0;for(f=this.layouts_by_index.length;w<f;w++)O=this.layouts_by_index[w],C.layouts[O.sid.toString()]=O.saveToJSON();q=C.events.groups;w=0;for(f=this.allGroups.length;w<f;w++)O=this.allGroups[w],
q[O.sid.toString()]=this.groups_by_name[O.group_name].group_active;f=C.events.cnds;for(x in this.cndsBySid)this.cndsBySid.hasOwnProperty(x)&&(w=this.cndsBySid[x],cr.hasAnyOwnProperty(w.extra)&&(f[x]={ex:g(w.extra)}));f=C.events.acts;for(x in this.actsBySid)this.actsBySid.hasOwnProperty(x)&&(w=this.actsBySid[x],cr.hasAnyOwnProperty(w.extra)&&(f[x]={ex:g(w.extra)}));f=C.events.vars;for(x in this.varsBySid)this.varsBySid.hasOwnProperty(x)&&(w=this.varsBySid[x],w.is_constant||w.parent&&!w.is_static||
(f[x]=w.data));C.system=this.system.saveToJSON();return JSON.stringify(C)};b.prototype.refreshUidMap=function(){var f,q;this.objectsByUid={};var x=0;for(f=this.types_by_index.length;x<f;x++){var C=this.types_by_index[x];if(!C.is_family){var w=0;for(q=C.instances.length;w<q;w++){var I=C.instances[w];this.objectsByUid[I.uid.toString()]=I}}}};b.prototype.loadFromJSONString=function(f){try{var q=JSON.parse(f)}catch(W){return!1}if(!q.c2save||1<q.version)return!1;this.isLoadingState=!0;f=q.rt;this.kahanTime.reset();
this.kahanTime.sum=f.time;this.wallTime.reset();this.wallTime.sum=f.walltime||0;this.timescale=f.timescale;this.tickcount=f.tickcount;this.execcount=f.execcount;this.start_time=Date.now()-f.start_time_offset;var x=f.running_layout;if(x!==this.running_layout.sid)if(x=this.getLayoutBySid(x))this.doChangeLayout(x);else return;var C,w,I;var L=q.types;for(w in L)if(L.hasOwnProperty(w)&&(I=this.getObjectTypeBySid(parseInt(w,10)))&&!I.is_family&&!this.typeHasNoSaveBehavior(I)){L[w].ex?I.extra=L[w].ex:cr.wipe(I.extra);
var O=I.instances;var P=L[w].instances;x=0;for(C=cr.min(O.length,P.length);x<C;x++)this.loadInstanceFromJSON(O[x],P[x]);x=P.length;for(C=O.length;x<C;x++)this.DestroyInstance(O[x]);x=O.length;for(C=P.length;x<C;x++){O=null;if(I.plugin.is_world&&(O=this.running_layout.getLayerBySid(P[x].w.l),!O))continue;O=this.createInstanceFromInit(I.default_instance,O,!1,0,0,!0);this.loadInstanceFromJSON(O,P[x])}I.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();C=q.layouts;for(w in C)C.hasOwnProperty(w)&&
(x=this.getLayoutBySid(parseInt(w,10)))&&x.loadFromJSON(C[w]);C=q.events.groups;for(w in C)C.hasOwnProperty(w)&&(x=this.getGroupBySid(parseInt(w,10)))&&this.groups_by_name[x.group_name]&&this.groups_by_name[x.group_name].setGroupActive(C[w]);x=q.events.cnds;for(w in this.cndsBySid)this.cndsBySid.hasOwnProperty(w)&&(x.hasOwnProperty(w)?this.cndsBySid[w].extra=x[w].ex:this.cndsBySid[w].extra={});x=q.events.acts;for(w in this.actsBySid)this.actsBySid.hasOwnProperty(w)&&(x.hasOwnProperty(w)?this.actsBySid[w].extra=
x[w].ex:this.actsBySid[w].extra={});x=q.events.vars;for(w in x)x.hasOwnProperty(w)&&this.varsBySid.hasOwnProperty(w)&&(this.varsBySid[w].data=x[w]);this.next_uid=f.next_uid;this.isLoadingState=!1;x=0;for(C=this.fireOnCreateAfterLoad.length;x<C;++x)O=this.fireOnCreateAfterLoad[x],this.trigger(Object.getPrototypeOf(O.type.plugin).cnds.OnCreated,O);cr.clearArray(this.fireOnCreateAfterLoad);this.system.loadFromJSON(q.system);x=0;for(C=this.types_by_index.length;x<C;x++)if(I=this.types_by_index[x],!I.is_family&&
!this.typeHasNoSaveBehavior(I))for(q=0,w=I.instances.length;q<w;q++){O=I.instances[q];if(I.is_contained)for(L=O.get_iid(),cr.clearArray(O.siblings),f=0,P=I.container.length;f<P;f++){var X=I.container[f];I!==X&&O.siblings.push(X.instances[L])}O.afterLoad&&O.afterLoad();if(O.behavior_insts)for(f=0,P=O.behavior_insts.length;f<P;f++)L=O.behavior_insts[f],L.afterLoad&&L.afterLoad()}return this.redraw=!0};b.prototype.saveInstanceToJSON=function(f,q){var x;var C=f.type;var w=C.plugin;var I={};q?I.c2=!0:
I.uid=f.uid;cr.hasAnyOwnProperty(f.extra)&&(I.ex=g(f.extra));if(f.instance_vars&&f.instance_vars.length)for(I.ivs={},q=0,x=f.instance_vars.length;q<x;q++)I.ivs[f.type.instvar_sids[q].toString()]=f.instance_vars[q];if(w.is_world){w={x:f.x,y:f.y,w:f.width,h:f.height,l:f.layer.sid,zi:f.get_zindex()};0!==f.angle&&(w.a=f.angle);1!==f.opacity&&(w.o=f.opacity);.5!==f.hotspotX&&(w.hX=f.hotspotX);.5!==f.hotspotY&&(w.hY=f.hotspotY);0!==f.blend_mode&&(w.bm=f.blend_mode);f.visible||(w.v=f.visible);f.collisionsEnabled||
(w.ce=f.collisionsEnabled);-1!==f.my_timescale&&(w.mts=f.my_timescale);if(C.effect_types.length)for(w.fx=[],q=0,x=C.effect_types.length;q<x;q++){var L=C.effect_types[q];w.fx.push({name:L.name,active:f.active_effect_flags[L.index],params:f.effect_params[L.index]})}I.w=w}if(f.behavior_insts&&f.behavior_insts.length)for(I.behs={},q=0,x=f.behavior_insts.length;q<x;q++)C=f.behavior_insts[q],C.saveToJSON&&(I.behs[C.type.sid.toString()]=C.saveToJSON());f.saveToJSON&&(I.data=f.saveToJSON());return I};b.prototype.getInstanceVarIndexBySid=
function(f,q){var x;var C=0;for(x=f.instvar_sids.length;C<x;C++)if(f.instvar_sids[C]===q)return C;return-1};b.prototype.getBehaviorIndexBySid=function(f,q){var x;var C=0;for(x=f.behavior_insts.length;C<x;C++)if(f.behavior_insts[C].type.sid===q)return C;return-1};b.prototype.loadInstanceFromJSON=function(f,q,x){var C,w;var I=f.type;var L=I.plugin;if(x){if(!q.c2)return}else f.uid=q.uid;q.ex?f.extra=q.ex:cr.wipe(f.extra);if(w=q.ivs)for(C in w)if(w.hasOwnProperty(C)){var O=this.getInstanceVarIndexBySid(I,
parseInt(C,10));if(!(0>O||O>=f.instance_vars.length)){var P=w[C];null===P&&(P=NaN);f.instance_vars[O]=P}}if(L.is_world){O=q.w;f.layer.sid!==O.l&&(w=f.layer,f.layer=this.running_layout.getLayerBySid(O.l),f.layer?(w.removeFromInstanceList(f,!0),f.layer.appendToInstanceList(f,!0),f.set_bbox_changed(),f.layer.setZIndicesStaleFrom(0)):(f.layer=w,x||this.DestroyInstance(f)));f.x=O.x;f.y=O.y;f.width=O.w;f.height=O.h;f.zindex=O.zi;f.angle=O.hasOwnProperty("a")?O.a:0;f.opacity=O.hasOwnProperty("o")?O.o:1;
f.hotspotX=O.hasOwnProperty("hX")?O.hX:.5;f.hotspotY=O.hasOwnProperty("hY")?O.hY:.5;f.visible=O.hasOwnProperty("v")?O.v:!0;f.collisionsEnabled=O.hasOwnProperty("ce")?O.ce:!0;f.my_timescale=O.hasOwnProperty("mts")?O.mts:-1;f.blend_mode=O.hasOwnProperty("bm")?O.bm:0;f.compositeOp=cr.effectToCompositeOp(f.blend_mode);this.gl&&cr.setGLBlend(f,f.blend_mode,this.gl);f.set_bbox_changed();if(O.hasOwnProperty("fx"))for(x=0,w=O.fx.length;x<w;x++)P=I.getEffectIndexByName(O.fx[x].name),0>P||(f.active_effect_flags[P]=
O.fx[x].active,f.effect_params[P]=O.fx[x].params);f.updateActiveEffects()}if(I=q.behs)for(C in I)I.hasOwnProperty(C)&&(x=this.getBehaviorIndexBySid(f,parseInt(C,10)),0>x||f.behavior_insts[x].loadFromJSON(I[C]));q.data&&f.loadFromJSON(q.data)};b.prototype.getProjectFileUrl=function(f){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(f.toLowerCase())?window.cr_previewProjectFiles[f.toLowerCase()]:f:this.files_subfolder+f};b.prototype.getProjectFileBlob=function(f){return this.isPreview?
window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(f.toLowerCase())?window.cr_previewProjectFileBlobs[f.toLowerCase()]:null:null};b.prototype.getLocalFileUrl=function(f){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(f.toLowerCase())?window.cr_previewProjectFiles[f.toLowerCase()]:f:f};b.prototype.fetchLocalFileViaCordova=function(f,q,x){window.resolveLocalFileSystemURL(window.cordova.file.applicationDirectory+"www/"+f,function(C){C.file(q,x)},x)};b.prototype.fetchLocalFileViaCordovaAsText=
function(f,q,x){this.fetchLocalFileViaCordova(f,function(C){var w=new FileReader;w.onload=function(I){q(I.target.result)};w.onerror=x;w.readAsText(C)},x)};var Z=[],aa=0;b.prototype.maybeStartNextArrayBufferRead=function(){if(Z.length&&!(8<=aa)){aa++;var f=Z.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(f.filename,f.successCallback,f.errorCallback)}};b.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(f,q,x){var C=this;Z.push({filename:f,successCallback:function(w){aa--;C.maybeStartNextArrayBufferRead();
q(w)},errorCallback:function(w){aa--;C.maybeStartNextArrayBufferRead();x(w)}});this.maybeStartNextArrayBufferRead()};b.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(f,q,x){this.fetchLocalFileViaCordova(f,function(C){var w=new FileReader;w.onload=function(I){q(I.target.result)};w.readAsArrayBuffer(C)},x)};b.prototype.fetchLocalFileViaCordovaAsURL=function(f,q,x){var C="",w=f.toLowerCase(),I=w.substr(w.length-4);w=w.substr(w.length-5);".mp4"===I?C="video/mp4":".webm"===w?C="video/webm":
".m4a"===I?C="audio/mp4":".mp3"===I&&(C="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(f,function(L){L=new Blob([L],{type:C});L=URL.createObjectURL(L);q(L)},x)};b.prototype.isAbsoluteUrl=function(f){return/^(?:[a-z]+:)?\/\//.test(f)||"data:"===f.substr(0,5)||"blob:"===f.substr(0,5)};b.prototype.setImageSrc=function(f,q){this.isWKWebView&&!this.isAbsoluteUrl(q)?this.fetchLocalFileViaCordovaAsURL(q,function(x){f.src=x},function(x){alert("Failed to load image: "+x)}):this.isPreview&&!this.isAbsoluteUrl(q)?
f.src=this.getLocalFileUrl(q):(this.isAbsoluteUrl(q)||(q=q.toLowerCase()),f.src=q)};b.prototype.getPreferredAudioFile=function(f){f=f.toLowerCase();if(!this.audio_files_map.hasOwnProperty(f))return null;f=this.audio_files_map[f];var q=null,x;var C=0;for(x=f.length;C<x;++C){var w=f[C];var I=w[0];q||"audio/webm; codecs=opus"!==I||(q=w);if(t[I])return w}return q};b.prototype.getProjectAudioFileUrl=function(f){var q=f.toLowerCase();return(f=this.getPreferredAudioFile(f))?{url:this.getProjectFileUrl(q+
f[1]),type:f[0]}:null};b.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1E3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}};b.prototype.accelerate=function(f,q,x,C,w){return this.enhancedAccelerationPrecision?cr.clamp(f*w+.5*C*w*w,q*w,x*w):f*w};cr.runtime=b;cr.createRuntime=function(f){return new b(f)};window.cr_createRuntime=cr.createRuntime})();
window.cr_getSnapshot=function(b,k){var v=window.c3runtime;v&&v.doCanvasSnapshot(b,k)};window.cr_sizeCanvas=function(b,k){if(0!==b&&0!==k){var v=window.c3runtime;v&&v.setSize(b,k)}};window.cr_setSuspended=function(b){var k=window.c3runtime;k&&k.setSuspended(b)};
(function(){function b(a,c){return a.zindex-c.zindex}function k(a,c){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=c[0];this.index=c[1];this.sid=c[2];this.visible=c[3];this.background_color=c[4];this.transparent=c[5];this.parallaxX=c[6];this.parallaxY=
c[7];this.opacity=c[8];this.forceOwnTexture=c[9];this.useRenderCells=c[10];this.zoomRate=c[11];this.blend_mode=c[12];this.effect_fallback=c[13];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_grid=null;this.last_render_list=v();this.render_list_stale=!0;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height));this.render_offscreen=
!1;a=c[14];var g;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];var p=0;for(g=a.length;p<g;p++){var m=a[p],t=this.runtime.types_by_index[m[1]];t.default_instance||(t.default_instance=m,t.default_layerindex=this.index);this.initial_instances.push(m);-1===this.layout.initial_types.indexOf(t)&&this.layout.initial_types.push(t)}cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=
!0;this.effect_params=[];p=0;for(g=c[15].length;p<g;p++)this.effect_types.push({id:c[15][p][0],name:c[15][p][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:p}),this.effect_params.push(c[15][p][2].slice(0));this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1)}function v(){return J.length?J.pop():[]}function A(a){cr.clearArray(a);J.push(a)}k.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
this.shaders_preserve_opaqueness=!0;var a;var c=0;for(a=this.effect_types.length;c<a;c++){var g=this.effect_types[c];g.active&&(this.active_effect_types.push(g),g.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};k.prototype.getEffectByName=function(a){var c;var g=0;for(c=this.effect_types.length;g<c;g++){var p=this.effect_types[g];if(p.name===a)return p}return null};k.prototype.createInitialInstances=function(a){var c,g;var p=c=0;for(g=this.initial_instances.length;c<g;c++){var m=this.initial_instances[c];
var t=this.runtime.types_by_index[m[1]];var D=this.runtime.typeHasPersistBehavior(t);t=!0;if(!D||this.layout.first_visit){m=this.runtime.createInstanceFromInit(m,this,!0);if(!m)continue;a.push(m);m.type.global&&(t=!1,this.created_globals.push(m.uid))}t&&(this.initial_instances[p]=this.initial_instances[c],p++)}this.initial_instances.length=p;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);
this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};k.prototype.recreateInitialObjects=function(a,c){var g,p=this.runtime.types_by_index,m=a.is_family,t=a.members;var D=0;for(g=this.initial_instances.length;D<g;++D){var z=this.initial_instances[D];var G=z[0];var M=G[0];G=G[1];if(c.contains_pt(M,G)){M=p[z[1]];if(M!==a)if(m){if(0>t.indexOf(M))continue}else continue;z=this.runtime.createInstanceFromInit(z,this,!1);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(M.plugin).cnds.OnCreated,
z);if(z.is_contained)for(M=0,G=z.siblings.length;M<G;M++){var l=z.siblings[D];this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l)}this.runtime.isInOnDestroy--}}};k.prototype.removeFromInstanceList=function(a,c){var g=cr.fastIndexOf(this.instances,a);0>g||(c&&this.useRenderCells&&a.rendercells&&a.rendercells.right>=a.rendercells.left&&(a.update_bbox(),this.render_grid.update(a,a.rendercells,null),a.rendercells.set(0,0,-1,-1)),g===this.instances.length-1?this.instances.pop():
(cr.arrayRemove(this.instances,g),this.setZIndicesStaleFrom(g)),this.render_list_stale=!0)};k.prototype.appendToInstanceList=function(a,c){a.zindex=this.instances.length;this.instances.push(a);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed();this.render_list_stale=!0};k.prototype.prependToInstanceList=function(a,c){this.instances.unshift(a);this.setZIndicesStaleFrom(0);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed()};k.prototype.moveInstanceAdjacent=function(a,c,g){var p=a.get_zindex();
c=c.get_zindex();cr.arrayRemove(this.instances,p);p<c&&c--;g&&c++;c===this.instances.length?this.instances.push(a):this.instances.splice(c,0,a);this.setZIndicesStaleFrom(p<c?p:c)};k.prototype.setZIndicesStaleFrom=function(a){-1===this.zindices_stale_from?this.zindices_stale_from=a:a<this.zindices_stale_from&&(this.zindices_stale_from=a);this.render_list_stale=this.zindices_stale=!0};k.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=
0);var a;if(this.useRenderCells){var c=this.zindices_stale_from;for(a=this.instances.length;c<a;++c){var g=this.instances[c];g.zindex=c;this.render_grid.markRangeChanged(g.rendercells)}}else for(c=this.zindices_stale_from,a=this.instances.length;c<a;++c)this.instances[c].zindex=c;this.zindices_stale=!1;this.zindices_stale_from=-1}};k.prototype.getScale=function(a){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||a?this.runtime.aspect_scale:1)};k.prototype.getNormalScale=function(){return(this.scale*
this.layout.scale-1)*this.zoomRate+1};k.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var J=[],K=[],n=[];k.prototype.getRenderCellInstancesToDraw=function(){this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,n);if(!n.length)return v();if(1===n.length){var a=v();cr.shallowAssignArray(a,n[0]);cr.clearArray(n);return a}for(var c=!0;1<n.length;){var g;a=n;var p=c;var m=0;for(g=a.length;m<
g-1;m+=2){var t=a[m];var D=a[m+1];c=v();var z=t,G=D,M=c,l=0,r=0,y=0,N=z.length,Q=G.length;for(M.length=N+Q;l<N&&r<Q;++y){var E=z[l];var d=G[r];E.zindex<d.zindex?(M[y]=E,++l):(M[y]=d,++r)}for(;l<N;++l,++y)M[y]=z[l];for(;r<Q;++r,++y)M[y]=G[r];p||(A(t),A(D));K.push(c)}1===g%2&&(p?(t=v(),cr.shallowAssignArray(t,a[g-1]),K.push(t)):K.push(a[g-1]));cr.shallowAssignArray(a,K);cr.clearArray(K);c=!1}a=n[0];cr.clearArray(n);return a};k.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==
this.opacity||0!==this.blend_mode;var c=this.runtime.canvas,g=a,p=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),c=this.runtime.layer_canvas,c.width=this.runtime.draw_width,c.height=this.runtime.draw_height,this.runtime.layer_ctx=c.getContext("2d"),p=!0),c=this.runtime.layer_canvas,g=this.runtime.layer_ctx,c.width!==this.runtime.draw_width&&(c.width=this.runtime.draw_width,p=!0),c.height!==this.runtime.draw_height&&(c.height=this.runtime.draw_height,
p=!0),p&&(g.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&g.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));g.globalAlpha=1;g.globalCompositeOperation="source-over";this.transparent||(g.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",g.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height));g.save();this.disableAngle=!0;p=this.canvasToLayer(0,0,!0,!0);var m=this.canvasToLayer(0,0,!1,!0);this.disableAngle=
!1;this.runtime.pixel_rounding&&(p=Math.round(p),m=Math.round(m));this.rotateViewport(p,m,g);var t=this.getScale();g.scale(t,t);g.translate(-p,-m);this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?
(A(this.last_render_list),p=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):p=this.last_render_list):p=this.instances;var D=null;m=0;for(t=p.length;m<t;++m){var z=p[m];z!==D&&(this.drawInstance(z,g),D=z)}this.useRenderCells&&(this.last_render_list=p);g.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(c,0,0))};k.prototype.drawInstance=function(a,c){if(a.visible&&0!==
a.width&&0!==a.height){a.update_bbox();var g=a.bbox;g.right<this.viewLeft||g.bottom<this.viewTop||g.left>this.viewRight||g.top>this.viewBottom||(c.globalCompositeOperation=a.compositeOp,a.draw(c))}};k.prototype.updateViewport=function(a){this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),g=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),g=Math.round(g));this.rotateViewport(c,g,a)};k.prototype.rotateViewport=function(a,c,g){var p=this.getScale();
this.viewLeft=a;this.viewTop=c;this.viewRight=a+1/p*this.runtime.draw_width;this.viewBottom=c+1/p*this.runtime.draw_height;a=this.getAngle();0!==a&&(g&&(g.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),g.rotate(-a),g.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,
a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};k.prototype.drawGL_earlyZPass=function(a){if(this.render_offscreen=this.forceOwnTexture){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));
if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex)}this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),g=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),g=Math.round(g));
this.rotateViewport(c,g,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),
this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(A(this.last_render_list),c=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):c=this.last_render_list):c=this.instances;var p=null;for(g=c.length-1;0<=g;--g){var m=c[g];m!==p&&(this.drawInstanceGL_earlyZPass(c[g],a),p=m)}this.useRenderCells&&(this.last_render_list=c);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,a.setEarlyZIndex(this.clear_earlyz_index),
a.setColorFillMode(1,1,1,1),a.fullscreenQuad(),a.restoreEarlyZMode())};k.prototype.drawGL=function(a){if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),
this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||(this.runtime.enableFrontToBack?(a.setEarlyZIndex(this.clear_earlyz_index),a.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),a.fullscreenQuad(),a.setTextureFillMode()):a.clear(this.background_color[0]/255,this.background_color[1]/
255,this.background_color[2]/255,1));this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0);var g=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),g=Math.round(g));this.rotateViewport(c,g,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),
this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(A(this.last_render_list),g=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):g=this.last_render_list):g=this.instances;var p,m=null;if(2.220446049250313e-16<
this.getNormalScale()){var t=0;for(p=g.length;t<p;++t){var D=g[t];D!==m&&(this.drawInstanceGL(g[t],a),m=D)}}this.useRenderCells&&(this.last_render_list=g);this.render_offscreen&&(g=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,t=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(g)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(g),
a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,c,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[t]),a.programIsAnimated(g)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),
a.updateModelView(),c=this.runtime.draw_width/2,g=this.runtime.draw_height/2,a.quad(-c,g,c,g,c,-g,-c,-g),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};k.prototype.drawInstanceGL=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var g=a.bbox;g.right<this.viewLeft||g.bottom<this.viewTop||g.left>this.viewRight||g.top>this.viewBottom||(c.setEarlyZIndex(a.earlyz_index),a.uses_shaders?this.drawInstanceWithShadersGL(a,c):(c.switchProgram(0),
c.setBlend(a.srcBlend,a.destBlend),a.drawGL(c)))}};k.prototype.drawInstanceGL_earlyZPass=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var g=a.bbox;g.right<this.viewLeft||g.bottom<this.viewTop||g.left>this.viewRight||g.top>this.viewBottom||(a.earlyz_index=this.runtime.earlyz_index++,0===a.blend_mode&&1===a.opacity&&a.shaders_preserve_opaqueness&&a.drawGL_earlyZPass&&(c.setEarlyZIndex(a.earlyz_index),a.drawGL_earlyZPass(c)))}};k.prototype.drawInstanceWithShadersGL=function(a,
c){var g=a.active_effect_types[0].shaderindex,p=a.active_effect_types[0].index,m=this.getScale(),t=this.runtime.draw_width,D=this.runtime.draw_height;if(1!==a.active_effect_types.length||c.programUsesCrossSampling(g)||c.programExtendsBox(g)||(a.angle||a.layer.getAngle())&&c.programUsesDest(g)||1!==a.opacity||a.type.plugin.must_predraw)this.layout.renderEffectChain(c,this,a,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),c.resetModelView(),c.scale(m,m),c.rotateZ(-this.getAngle()),
c.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),c.updateModelView();else{c.switchProgram(g);c.setBlend(a.srcBlend,a.destBlend);c.programIsAnimated(g)&&(this.runtime.redraw=!0);var z=0,G=0,M=0,l=0;c.programUsesDest(g)&&(l=a.bbox,z=this.layerToCanvas(l.left,l.top,!0,!0),G=this.layerToCanvas(l.left,l.top,!1,!0),M=this.layerToCanvas(l.right,l.bottom,!0,!0),l=this.layerToCanvas(l.right,l.bottom,!1,!0),z/=t,G=1-G/D,M/=t,l=1-l/D);D=t=0;var r=g=1,y=1/a.width,N=1/a.height;
a.curFrame&&a.curFrame.sheetTex&&(t=a.curFrame.sheetTex.left,D=a.curFrame.sheetTex.top,g=a.curFrame.sheetTex.right,r=a.curFrame.sheetTex.bottom,a.curFrame.texture_img&&(y=1/a.curFrame.texture_img.width,N=1/a.curFrame.texture_img.height));c.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),y,N,t,D,g,r,t,D,g,r,a.bbox.left,a.bbox.top,a.bbox.right,a.bbox.bottom,z,G,M,l,m,this.getAngle(),this.runtime.kahanTime.sum,a.effect_params[p]);a.drawGL(c)}};k.prototype.canvasToLayer=
function(a,c,g,p){var m=this.runtime.devicePixelRatio;this.runtime.isRetina&&(a*=m,c*=m);m=this.runtime.parallax_x_origin;var t=this.runtime.parallax_y_origin;m=(this.layout.scrollX-m)*this.parallaxX+m;t=(this.layout.scrollY-t)*this.parallaxY+t;var D=m,z=t,G=1/this.getScale(!p);p?(D-=this.runtime.draw_width*G/2,z-=this.runtime.draw_height*G/2):(D-=this.runtime.width*G/2,z-=this.runtime.height*G/2);D+=a*G;z+=c*G;c=this.getAngle();0!==c&&(D-=m,z-=t,a=Math.cos(c),c=Math.sin(c),p=D*a-z*c,z=z*a+D*c,D=
p+m,z+=t);return g?D:z};k.prototype.layerToCanvas=function(a,c,g,p){var m=this.runtime.parallax_x_origin,t=this.runtime.parallax_y_origin,D=(this.layout.scrollX-m)*this.parallaxX+m,z=(this.layout.scrollY-t)*this.parallaxY+t;t=D;m=z;var G=this.getAngle();if(0!==G){a-=D;c-=z;var M=Math.cos(-G);G=Math.sin(-G);var l=a*M-c*G;c=c*M+a*G;a=l+D;c+=z}D=1/this.getScale(!p);p?(t-=this.runtime.draw_width*D/2,m-=this.runtime.draw_height*D/2):(t-=this.runtime.width*D/2,m-=this.runtime.height*D/2);t=(a-t)/D;m=(c-
m)/D;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&!p&&(t/=a,m/=a);return g?t:m};k.prototype.rotatePt=function(a,c,g){if(0===this.getAngle())return g?a:c;var p=this.layerToCanvas(a,c,!0);c=this.layerToCanvas(a,c,!1);this.disableAngle=!0;a=this.canvasToLayer(p,c,!0);p=this.canvasToLayer(p,c,!0);this.disableAngle=!1;return g?a:p};k.prototype.saveToJSON=function(){var a,c={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,
t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};var g=0;for(a=this.effect_types.length;g<a;g++){var p=this.effect_types[g];c.fx.push({name:p.name,active:p.active,params:this.effect_params[p.index]})}return c};k.prototype.loadFromJSON=function(a){var c;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=
a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;this.created_globals=a.cg||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var g=new cr.ObjectSet;var p=0;for(c=this.created_globals.length;p<c;++p)g.add(this.created_globals[p]);var m=p=0;for(c=this.initial_instances.length;p<c;++p)g.contains(this.initial_instances[p][2])||(this.initial_instances[m]=this.initial_instances[p],++m);cr.truncateArray(this.initial_instances,m);m=a.fx;p=0;for(c=
m.length;p<c;p++)if(a=this.getEffectByName(m[p].name))a.active=m[p].active,this.effect_params[a.index]=m[p].params;this.updateActiveEffects();this.instances.sort(b);this.zindices_stale=!0};cr.layer=k})();
(function(){function b(n,a){this.runtime=n;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=a[0];this.originalWidth=a[1];this.originalHeight=a[2];this.width=a[1];this.height=a[2];this.unbounded_scrolling=a[3];this.sheetname=a[4];this.sid=a[5];var c=a[6],g;this.layers=[];this.initial_types=[];n=0;for(g=c.length;n<g;n++){var p=new cr.layer(this,c[n]);p.number=n;cr.seal(p);this.layers.push(p)}c=
a[7];this.initial_nonworld=[];n=0;for(g=c.length;n<g;n++){p=c[n];var m=this.runtime.types_by_index[p[1]];m.default_instance||(m.default_instance=p);this.initial_nonworld.push(p);-1===this.initial_types.indexOf(m)&&this.initial_types.push(m)}this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=!0;this.effect_params=[];n=0;for(g=a[8].length;n<g;n++)this.effect_types.push({id:a[8][n][0],name:a[8][n][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:n}),this.effect_params.push(a[8][n][2].slice(0));
this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1);this.viewRect=new cr.rect(0,0,0,0);this.persist_data={}}function k(n,a){return n.zindex-a.zindex}function v(n){return n.some(function(a){return a.plugin.is_world})}b.prototype.saveObjectToPersist=function(n){var a=n.type.sid.toString();this.persist_data.hasOwnProperty(a)||(this.persist_data[a]=[]);this.persist_data[a].push(this.runtime.saveInstanceToJSON(n))};
b.prototype.hasOpaqueBottomLayer=function(){var n=this.layers[0];return!n.transparent&&1===n.opacity&&!n.forceOwnTexture&&n.visible};b.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;var n;var a=0;for(n=this.effect_types.length;a<n;a++){var c=this.effect_types[a];c.active&&(this.active_effect_types.push(c),c.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};b.prototype.getEffectByName=function(n){var a;var c=0;for(a=
this.effect_types.length;c<a;c++){var g=this.effect_types[c];if(g.name===n)return g}return null};var A=[],J=!0;b.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes());this.runtime.running_layout=this;this.width=this.originalWidth;this.height=this.originalHeight;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var n,a;var c=0;for(n=this.runtime.types_by_index.length;c<
n;c++){var g=this.runtime.types_by_index[c];if(!g.is_family){var p=g.instances;g=0;for(a=p.length;g<a;g++){var m=p[g];if(m.layer){var t=m.layer.number;t>=this.layers.length&&(t=this.layers.length-1);m.layer=this.layers[t];-1===m.layer.instances.indexOf(m)&&m.layer.instances.push(m);m.layer.zindices_stale=!0}}}}if(!J)for(c=0,n=this.layers.length;c<n;++c)this.layers[c].instances.sort(k);cr.clearArray(A);this.boundScrolling();c=0;for(n=this.layers.length;c<n;c++)m=this.layers[c],m.createInitialInstances(A),
m.updateViewport(null);p=!1;if(!this.first_visit){for(D in this.persist_data)if(this.persist_data.hasOwnProperty(D)&&(g=this.runtime.getObjectTypeBySid(parseInt(D,10)))&&!g.is_family&&this.runtime.typeHasPersistBehavior(g)){a=this.persist_data[D];c=0;for(n=a.length;c<n;c++){m=null;if(g.plugin.is_world&&(m=this.getLayerBySid(a[c].w.l),!m))continue;m=this.runtime.createInstanceFromInit(g.default_instance,m,!1,0,0,!0);this.runtime.loadInstanceFromJSON(m,a[c]);p=!0;A.push(m)}cr.clearArray(a)}c=0;for(n=
this.layers.length;c<n;c++)this.layers[c].instances.sort(k),this.layers[c].zindices_stale=!0}p&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());this.createAndLinkContainerInstances(A);c=0;for(n=this.initial_nonworld.length;c<n;c++){var D=this.initial_nonworld[c];g=this.runtime.types_by_index[D[1]];g.is_contained||this.runtime.createInstanceFromInit(this.initial_nonworld[c],null,!0)}this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx)for(c=0,n=this.runtime.types_by_index.length;c<
n;c++)D=this.runtime.types_by_index[c],!D.is_family&&D.instances.length&&D.preloadCanvas2D&&D.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,A);else for(c=0,n=A.length;c<n;c++)m=A[c],this.runtime.trigger(Object.getPrototypeOf(m.type.plugin).cnds.OnCreated,m);cr.clearArray(A);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};b.prototype.createAndLinkContainerInstances=
function(n){var a,c;for(a=0;a<n.length;a++){var g=n[a];if(g.type.is_contained){var p=g.get_iid();var m=0;for(c=g.type.container.length;m<c;m++){var t=g.type.container[m];if(g.type!==t)if(t.instances.length>p)g.siblings.push(t.instances[p]);else if(t.default_instance){var D=this.runtime.createInstanceFromInit(t.default_instance,g.layer,!0,g.x,g.y,!0);this.runtime.ClearDeathRow();t.updateIIDs();g.siblings.push(D);n.push(D)}}}}};b.prototype.createGlobalNonWorlds=function(){var n,a,c=[];var g=n=0;for(a=
this.initial_nonworld.length;n<a;n++){var p=this.initial_nonworld[n];var m=this.runtime.types_by_index[p[1]];m.global?m.is_contained&&v(m.container)||c.push(this.runtime.createInstanceFromInit(p,null,!0)):(this.initial_nonworld[g]=p,g++)}cr.truncateArray(this.initial_nonworld,g);this.runtime.ClearDeathRow();this.createAndLinkContainerInstances(c)};b.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=
!0;cr.clearArray(this.runtime.system.waits);var n,a;if(!this.first_visit){var c=0;for(n=this.layers.length;c<n;c++){this.layers[c].updateZIndices();var g=this.layers[c].instances;var p=0;for(a=g.length;p<a;p++){var m=g[p];m.type.global||this.runtime.typeHasPersistBehavior(m.type)&&this.saveObjectToPersist(m)}}}c=0;for(n=this.layers.length;c<n;c++){g=this.layers[c].instances;p=0;for(a=g.length;p<a;p++)m=g[p],m.type.global||this.runtime.DestroyInstance(m);this.runtime.ClearDeathRow();cr.clearArray(g);
this.layers[c].zindices_stale=!0}c=0;for(n=this.runtime.types_by_index.length;c<n;c++)if(g=this.runtime.types_by_index[c],!(g.global||g.plugin.is_world||g.plugin.singleglobal||g.is_family)){p=0;for(a=g.instances.length;p<a;p++)this.runtime.DestroyInstance(g.instances[p]);this.runtime.ClearDeathRow()}J=!1;this.runtime.isEndingLayout=!1};var K=new cr.rect(0,0,0,0);b.prototype.recreateInitialObjects=function(n,a,c,g,p){K.set(a,c,g,p);a=0;for(c=this.layers.length;a<c;a++)this.layers[a].recreateInitialObjects(n,
K)};b.prototype.draw=function(n){var a=n,c=!1,g=!this.runtime.fullscreenScalingQuality;if(g){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("canvas");var p=this.runtime.layout_canvas;p.width=this.runtime.draw_width;p.height=this.runtime.draw_height;this.runtime.layout_ctx=p.getContext("2d");c=!0}p=this.runtime.layout_canvas;a=this.runtime.layout_ctx;p.width!==this.runtime.draw_width&&(p.width=this.runtime.draw_width,c=!0);p.height!==this.runtime.draw_height&&(p.height=
this.runtime.draw_height,c=!0);c&&(a.imageSmoothingEnabled=this.runtime.linearSampling)}a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var m;c=0;for(m=this.layers.length;c<m;c++){var t=this.layers[c];t.visible&&0<t.opacity&&11!==t.blend_mode&&(t.instances.length||!t.transparent)?t.draw(a):t.updateViewport(null)}g&&n.drawImage(p,0,0,this.runtime.width,this.runtime.height)};
b.prototype.drawGL_earlyZPass=function(n){n.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);n.setRenderingToTexture(this.runtime.layout_tex);
this.runtime.fullscreenScalingQuality||n.setSize(this.runtime.draw_width,this.runtime.draw_height);var a;for(a=this.layers.length-1;0<=a;--a){var c=this.layers[a];c.visible&&1===c.opacity&&c.shaders_preserve_opaqueness&&0===c.blend_mode&&(c.instances.length||!c.transparent)?c.drawGL_earlyZPass(n):c.updateViewport(null)}n.setEarlyZPass(!1)};b.prototype.drawGL=function(n){var a=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;
if(a){this.runtime.layout_tex||(this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);n.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||
n.setSize(this.runtime.draw_width,this.runtime.draw_height)}else this.runtime.layout_tex&&(n.setRenderingToTexture(null),n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null);this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&n.clear(0,0,0,0);var c;var g=0;for(c=this.layers.length;g<c;g++){var p=this.layers[g];p.visible&&0<p.opacity&&(p.instances.length||!p.transparent)?p.drawGL(n):p.updateViewport(null)}a&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&
this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(a=this.active_effect_types[0].index,g=this.calculateViewRect(),n.switchProgram(this.active_effect_types[0].shaderindex),n.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,g.left,g.top,g.right,g.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[a]),n.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):n.switchProgram(0),
this.runtime.fullscreenScalingQuality||n.setSize(this.runtime.width,this.runtime.height),n.setRenderingToTexture(null),n.setDepthTestEnabled(!1),n.setOpacity(1),n.setTexture(this.runtime.layout_tex),n.setAlphaBlend(),n.resetModelView(),n.updateModelView(),a=this.runtime.width/2,g=this.runtime.height/2,n.quad(-a,g,a,g,a,-g,-a,-g),n.setTexture(null),n.setDepthTestEnabled(!0)):this.renderEffectChain(n,null,null,null))};b.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||
this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};b.prototype.getMinLayerScale=function(){var n=this.layers[0].getScale(),a;var c=1;for(a=this.layers.length;c<a;c++){var g=this.layers[c];(0!==g.parallaxX||0!==g.parallaxY)&&g.getScale()<n&&(n=g.getScale())}return n};b.prototype.scrollToX=function(n){if(!this.unbounded_scrolling){var a=this.runtime.draw_width*(1/this.getMinLayerScale())/2;n>this.width-a&&(n=this.width-
a);n<a&&(n=a)}this.scrollX!==n&&(this.scrollX=n,this.runtime.redraw=!0)};b.prototype.scrollToY=function(n){if(!this.unbounded_scrolling){var a=this.runtime.draw_height*(1/this.getMinLayerScale())/2;n>this.height-a&&(n=this.height-a);n<a&&(n=a)}this.scrollY!==n&&(this.scrollY=n,this.runtime.redraw=!0)};b.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};b.prototype.calculateViewRect=function(){var n=this.scrollX,a=this.scrollY,c=1/(this.scale*this.runtime.aspect_scale);
n-=this.runtime.width*c/2;a-=this.runtime.height*c/2;this.viewRect.set(n,a,n+this.runtime.draw_width*c,a+this.runtime.draw_height*c);return this.viewRect};b.prototype.renderEffectChain=function(n,a,c,g){var p=c?c.active_effect_types:a?a.active_effect_types:this.active_effect_types;if(c){var m=c.layer.getScale();var t=c.layer.getAngle();var D=c.layer.viewLeft;var z=c.layer.viewTop;var G=c.layer.viewRight;var M=c.layer.viewBottom}else a?(m=a.getScale(),t=a.getAngle(),D=a.viewLeft,z=a.viewTop,G=a.viewRight,
M=a.viewBottom):(m=this.scale,t=this.angle,M=this.calculateViewRect(),D=M.left,z=M.top,G=M.right,M=M.bottom);var l=this.runtime.fx_tex,r,y,N=0,Q=1,E=this.runtime.draw_width,d=this.runtime.draw_height,h=E/2,B=d/2,e=a?a.rcTexBounce:this.rcTexBounce,u=a?a.rcTexDest:this.rcTexDest,F=a?a.rcTexOrigin:this.rcTexOrigin,H=0,R=0,S=0,V=0,T=E,Z=E,aa=d,f=d,q=y=0,x=c?c.layer.getAngle():0;if(c){var C=0;for(r=p.length;C<r;C++)y+=n.getProgramBoxExtendHorizontal(p[C].shaderindex),q+=n.getProgramBoxExtendVertical(p[C].shaderindex);
V=c.bbox;H=a.layerToCanvas(V.left,V.top,!0,!0);S=a.layerToCanvas(V.left,V.top,!1,!0);T=a.layerToCanvas(V.right,V.bottom,!0,!0);aa=a.layerToCanvas(V.right,V.bottom,!1,!0);if(0!==x){C=a.layerToCanvas(V.right,V.top,!0,!0);r=a.layerToCanvas(V.right,V.top,!1,!0);R=a.layerToCanvas(V.left,V.bottom,!0,!0);V=a.layerToCanvas(V.left,V.bottom,!1,!0);var w=Math.min(H,T,C,R);T=Math.max(H,T,C,R);H=w;w=Math.min(S,aa,r,V);aa=Math.max(S,aa,r,V);S=w}F.left=H/E;F.top=1-S/d;F.right=T/E;F.bottom=1-aa/d;H-=y;S-=q;T+=y;
aa+=q;u.left=H/E;u.top=1-S/d;u.right=T/E;u.bottom=1-aa/d;R=H=cr.floor(H);V=S=cr.floor(S);Z=T=cr.ceil(T);f=aa=cr.ceil(aa);R-=y;V-=q;Z+=y;f+=q;0>H&&(H=0);0>S&&(S=0);T>E&&(T=E);aa>d&&(aa=d);0>R&&(R=0);0>V&&(V=0);Z>E&&(Z=E);f>d&&(f=d);e.left=H/E;e.top=1-S/d;e.right=T/E;e.bottom=1-aa/d}else e.left=u.left=F.left=0,e.top=u.top=F.top=0,e.right=u.right=F.right=1,e.bottom=u.bottom=1;q=c&&(n.programUsesDest(p[0].shaderindex)||0!==y||0!==q||1!==c.opacity||c.type.plugin.must_predraw)||a&&!c&&1!==a.opacity;n.setAlphaBlend();
if(q){l[N]||(l[N]=n.createEmptyTexture(E,d,this.runtime.linearSampling));if(l[N].c2width!==E||l[N].c2height!==d)n.deleteTexture(l[N]),l[N]=n.createEmptyTexture(E,d,this.runtime.linearSampling);n.switchProgram(0);n.setRenderingToTexture(l[N]);var I=f-V;n.clearRect(R,d-V-I,Z-R,I);c?c.drawGL(n):(n.setTexture(this.runtime.layer_tex),n.setOpacity(a.opacity),n.resetModelView(),n.translate(-h,-B),n.updateModelView(),n.quadTex(H,aa,T,aa,T,S,H,S,e));u.left=u.top=0;u.right=u.bottom=1;c&&(w=e.top,e.top=e.bottom,
e.bottom=w);N=1;Q=0}n.setOpacity(1);y=p.length-1;x=n.programUsesCrossSampling(p[y].shaderindex)||!a&&!c&&!this.runtime.fullscreenScalingQuality;C=0;for(r=p.length;C<r;C++){l[N]||(l[N]=n.createEmptyTexture(E,d,this.runtime.linearSampling));if(l[N].c2width!==E||l[N].c2height!==d)n.deleteTexture(l[N]),l[N]=n.createEmptyTexture(E,d,this.runtime.linearSampling);n.switchProgram(p[C].shaderindex);w=p[C].index;n.programIsAnimated(p[C].shaderindex)&&(this.runtime.redraw=!0);if(0!=C||q){n.setProgramParameters(g,
1/E,1/d,0,0,1,1,F.left,F.top,F.right,F.bottom,D,z,G,M,u.left,u.top,u.right,u.bottom,m,t,this.runtime.kahanTime.sum,c?c.effect_params[w]:a?a.effect_params[w]:this.effect_params[w]);n.setTexture(null);if(C!==y||x){n.setRenderingToTexture(l[N]);I=f-V;var L=d-V-I;n.clearRect(R,L,Z-R,I)}else c?n.setBlend(c.srcBlend,c.destBlend):a&&n.setBlend(a.srcBlend,a.destBlend),n.setRenderingToTexture(g);n.setTexture(l[Q]);n.resetModelView();n.translate(-h,-B);n.updateModelView();n.quadTex(H,aa,T,aa,T,S,H,S,e);C!==
y||x||n.setTexture(null)}else{n.setRenderingToTexture(l[N]);I=f-V;L=d-V-I;n.clearRect(R,L,Z-R,I);if(c){L=Q=0;var O=I=1,P=1/c.width,X=1/c.height;c.curFrame&&c.curFrame.sheetTex&&(Q=c.curFrame.sheetTex.left,L=c.curFrame.sheetTex.top,I=c.curFrame.sheetTex.right,O=c.curFrame.sheetTex.bottom,c.curFrame.texture_img&&(P=1/c.curFrame.texture_img.width,X=1/c.curFrame.texture_img.height));n.setProgramParameters(g,P,X,Q,L,I,O,Q,L,I,O,c.bbox.left,c.bbox.top,c.bbox.right,c.bbox.bottom,u.left,u.top,u.right,u.bottom,
m,t,this.runtime.kahanTime.sum,c.effect_params[w]);c.drawGL(n)}else n.setProgramParameters(g,1/E,1/d,0,0,1,1,0,0,1,1,D,z,G,M,0,0,1,1,m,t,this.runtime.kahanTime.sum,a?a.effect_params[w]:this.effect_params[w]),n.setTexture(a?this.runtime.layer_tex:this.runtime.layout_tex),n.resetModelView(),n.translate(-h,-B),n.updateModelView(),n.quadTex(H,aa,T,aa,T,S,H,S,e);u.left=u.top=0;u.right=u.bottom=1;c&&!x&&(w=aa,aa=S,S=w)}N=0===N?1:0;Q=0===N?1:0}x&&(n.switchProgram(0),c?n.setBlend(c.srcBlend,c.destBlend):
a?n.setBlend(a.srcBlend,a.destBlend):this.runtime.fullscreenScalingQuality||(n.setSize(this.runtime.width,this.runtime.height),h=this.runtime.width/2,B=this.runtime.height/2,S=H=0,T=this.runtime.width,aa=this.runtime.height),n.setRenderingToTexture(g),n.setTexture(l[Q]),n.resetModelView(),n.translate(-h,-B),n.updateModelView(),c&&1===p.length&&!q?n.quadTex(H,S,T,S,T,aa,H,aa,e):n.quadTex(H,aa,T,aa,T,S,H,S,e),n.setTexture(null))};b.prototype.getLayerBySid=function(n){var a;var c=0;for(a=this.layers.length;c<
a;c++)if(this.layers[c].sid===n)return this.layers[c];return null};b.prototype.saveToJSON=function(){var n,a={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};var c=0;for(n=this.effect_types.length;c<n;c++){var g=this.effect_types[c];a.fx.push({name:g.name,active:g.active,params:this.effect_params[g.index]})}c=0;for(n=this.layers.length;c<n;c++)g=this.layers[c],a.layers[g.sid.toString()]=g.saveToJSON();
return a};b.prototype.loadFromJSON=function(n){var a,c,g;this.scrollX=n.sx;this.scrollY=n.sy;this.scale=n.s;this.angle=n.a;this.width=n.w;this.height=n.h;this.persist_data=n.persist;"undefined"!==typeof n.fv&&(this.first_visit=n.fv);var p=n.fx;var m=0;for(a=p.length;m<a;m++)if(c=this.getEffectByName(p[m].name))c.active=p[m].active,this.effect_params[c.index]=p[m].params;this.updateActiveEffects();m=n.layers;for(g in m)m.hasOwnProperty(g)&&(n=this.getLayerBySid(parseInt(g,10)))&&n.loadFromJSON(m[g])};
cr.layout=b})();
(function(){function b(l,r){var y,N=l.length;switch(N){case 0:return!0;case 1:return l[0]===r[0];case 2:return l[0]===r[0]&&l[1]===r[1];default:for(y=0;y<N;y++)if(l[y]!==r[y])return!1;return!0}}function k(l,r){return l.index-r.index}function v(l){var r;if(2===l.length){if(l[0].index>l[1].index){var y=l[0];l[0]=l[1];l[1]=y}}else 2<l.length&&l.sort(k);l.length>=z.length&&(z.length=l.length+1);z[l.length]||(z[l.length]=[]);var N=z[l.length];y=0;for(r=N.length;y<r;y++){var Q=N[y];if(b(l,Q))return Q}N.push(l);
return l}function A(l,r){this.runtime=l;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.deep_includes=[];this.already_included_sheets=[];this.name=r[0];l=r[1];this.events=[];var y;r=0;for(y=l.length;r<y;r++)this.init_event(l[r],null,this.events)}function J(l){this.type=l;this.instances=[];this.else_instances=[];this.select_all=!0}function K(l,r,y){this.sheet=l;this.parent=r;this.runtime=l.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=
this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group_active=this.initially_activated=this.group=!1;this.contained_includes=null;3===y[0]&&(this.group_name=y[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!y[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=
this);this.orblock=y[2];this.sid=y[4];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var N=y[6];l=0;for(r=N.length;l<r;l++){var Q=new cr.condition(this,N[l]);Q.index=l;cr.seal(Q);this.conditions.push(Q);this.addSolModifier(Q.type)}N=y[7];l=0;for(r=N.length;l<r;l++)Q=new cr.action(this,N[l]),Q.index=l,cr.seal(Q),this.actions.push(Q);if(9===y.length)for(y=y[8],l=0,r=y.length;l<r;l++)this.sheet.init_event(y[l],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=
null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function n(l,r){var y;if(l&&(-1===r.indexOf(l)&&r.push(l),l.is_contained)){var N=0;for(y=l.container.length;N<y;N++){var Q=l.container[N];l!==Q&&-1===r.indexOf(Q)&&r.push(Q)}}}function a(l,r){this.block=l;this.sheet=l.sheet;this.runtime=l.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(r[1]);this.trigger=0<
r[3];this.fasttrigger=2===r[3];this.looping=r[4];this.inverted=r[5];this.isstatic=r[6];this.sid=r[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===r[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[r[0]],this.run=this.isstatic?this.run_static:this.run_object,r[2]?(this.behaviortype=this.type.getBehaviorByName(r[2]),this.beh_index=this.type.getBehaviorIndexByName(r[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&
this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(10===r.length){var y=r[9];l=0;for(r=y.length;l<r;l++){var N=new cr.parameter(this,y[l]);cr.seal(N);this.parameters.push(N)}this.results.length=y.length}}function c(l,r){this.block=l;this.sheet=l.sheet;this.runtime=l.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(r[1]);-1===r[0]?(this.type=null,this.run=this.run_system,
this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[r[0]],this.run=this.run_object,r[2]?(this.behaviortype=this.type.getBehaviorByName(r[2]),this.beh_index=this.type.getBehaviorIndexByName(r[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=r[3];this.runtime.actsBySid[this.sid.toString()]=this;if(7===r.length){var y=r[6];l=0;for(r=y.length;l<r;l++){var N=new cr.parameter(this,y[l]);cr.seal(N);this.parameters.push(N)}this.results.length=y.length}}function g(){M++;
G.length===M&&G.push(new cr.expvalue);return G[M]}function p(l,r){this.owner=l;this.block=l.block;this.sheet=l.sheet;this.runtime=l.runtime;this.type=r[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;this.variesPerInstance=!1;var y;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,r[1]);this.solindex=0;this.get=this.get_exp;
break;case 1:case 14:this.expression=new cr.expNode(this,r[1]);this.solindex=0;this.get=this.get_exp_str;14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,r[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=r[1];this.get=this.get_combosel;break;case 16:this.combosel=r[1]?1:0;this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[r[1]];this.get=
this.get_layout;break;case 9:this.key=r[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[r[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=r[1];l.type&&l.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=r[1];this.eventvar=null;
this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=r[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],l=1,y=r.length;l<y;l++){var N=new cr.parameter(this.owner,r[l]);cr.seal(N);this.subparams.push(N);this.variadicret.push(0)}}}function m(l,r,y){this.sheet=l;this.parent=r;this.runtime=l.runtime;this.solModifiers=[];this.name=y[1];this.vartype=y[2];this.initial=y[3];this.is_static=!!y[4];this.is_constant=!!y[5];this.sid=y[6];
this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function t(l,r,y){this.sheet=l;this.parent=r;this.runtime=l.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=y[1];this.active=!0}function D(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var z=
[];A.prototype.toString=function(){return this.name};A.prototype.init_event=function(l,r,y){switch(l[0]){case 0:case 3:l=new cr.eventblock(this,r,l);cr.seal(l);if(l.orblock)for(y.push(l),y=0,r=l.conditions.length;y<r;y++)l.conditions[y].trigger&&this.init_trigger(l,y);else l.is_trigger()?this.init_trigger(l,0):y.push(l);break;case 1:l=new cr.eventvariable(this,r,l);cr.seal(l);y.push(l);break;case 2:l=new cr.eventinclude(this,r,l),cr.seal(l),y.push(l)}};A.prototype.postInit=function(){var l;var r=
0;for(l=this.events.length;r<l;r++)this.events[r].postInit(r<l-1&&this.events[r+1].is_else_block)};A.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};A.prototype.addDeepIncludes=function(l){var r,y=l.deep_includes,N=l.already_included_sheets,Q=this.includes.valuesRef();var E=0;for(r=Q.length;E<r;++E){var d=Q[E];var h=d.include_sheet;!d.isActive()||l===h||-1<
N.indexOf(h)||(N.push(h),h.addDeepIncludes(l),y.push(h))}};A.prototype.run=function(l){this.runtime.resuming_breakpoint||(this.hasRun=!0,l||(this.runtime.isRunningEvents=!0));var r;var y=0;for(r=this.events.length;y<r;y++){var N=this.events[y];N.run();this.runtime.clearSol(N.solModifiers);this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}l||(this.runtime.isRunningEvents=!1)};A.prototype.init_trigger=function(l,r){l.orblock||this.runtime.triggers_to_postinit.push(l);var y,N,Q=l.conditions[r];
var E=Q.type?Q.type.name:"system";var d=(y=Q.fasttrigger)?this.fasttriggers:this.triggers;d[E]||(d[E]=[]);E=d[E];d=Q.func;if(y){if(Q.parameters.length&&(Q=Q.parameters[0],1===Q.type&&2===Q.expression.type)){Q=Q.expression.value.toLowerCase();y=0;for(N=E.length;y<N;y++)if(E[y].method==d){y=E[y].evs;y[Q]?y[Q].push([l,r]):y[Q]=[[l,r]];return}y={};y[Q]=[[l,r]];E.push({method:d,evs:y})}}else{y=0;for(N=E.length;y<N;y++)if(E[y].method==d){E[y].evs.push([l,r]);return}Q=cr.plugins_.Sprite&&d===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?
!0:!1;Q?E.unshift({method:d,evs:[[l,r]]}):E.push({method:d,evs:[[l,r]]})}};cr.eventsheet=A;J.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};J.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};J.prototype.pick_one=function(l){l&&(l.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,l.type.instances),this.select_all=
!1),l=this.else_instances.indexOf(l),-1!==l&&(this.instances.push(this.else_instances[l]),this.else_instances.splice(l,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=l))};cr.selection=J;K.prototype.postInit=function(l){var r,y=this.parent;if(this.group)for(this.toplevelgroup=!0;y;){if(!y.group){this.toplevelgroup=!1;break}y=y.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!l;y=this.runtime.types_by_index;
if(this.solModifiers===y)this.solModifiersIncludingParents=y;else{this.solModifiersIncludingParents=this.solModifiers.slice(0);for(y=this.parent;y;){l=0;for(r=y.solModifiers.length;l<r;l++)this.addParentSolModifier(y.solModifiers[l]);y=y.parent}this.solModifiers=v(this.solModifiers);this.solModifiersIncludingParents=v(this.solModifiersIncludingParents)}l=0;for(r=this.conditions.length;l<r;l++)this.conditions[l].postInit();l=0;for(r=this.actions.length;l<r;l++)this.actions[l].postInit();l=0;for(r=
this.subevents.length;l<r;l++)this.subevents[l].postInit(l<r-1&&this.subevents[l+1].is_else_block)};K.prototype.setGroupActive=function(l){if(this.group_active!==!!l){this.group_active=!!l;var r;l=0;for(r=this.contained_includes.length;l<r;++l)this.contained_includes[l].updateActive();0<r&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};K.prototype.addSolModifier=function(l){n(l,this.solModifiers)};K.prototype.addParentSolModifier=function(l){n(l,
this.solModifiersIncludingParents)};K.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index};K.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};K.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};K.prototype.run=function(){var l,r=!1,y=this.runtime,N=this.runtime.getCurrentEventStack();N.current_event=this;var Q=this.conditions;this.is_else_block||(N.else_branch_ran=
!1);if(this.orblock){0===Q.length&&(r=!0);N.cndindex=0;for(l=Q.length;N.cndindex<l;N.cndindex++){var E=Q[N.cndindex];E.trigger||(E=E.run())&&(r=!0)}(N.last_event_true=r)&&this.run_actions_and_subevents()}else{N.cndindex=0;for(l=Q.length;N.cndindex<l;N.cndindex++)if(E=Q[N.cndindex].run(),!E){N.last_event_true=!1;this.toplevelevent&&y.hasPendingInstances&&y.ClearDeathRow();return}N.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(N)};K.prototype.end_run=function(l){l.last_event_true&&
this.has_else_block&&(l.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};K.prototype.run_orblocktrigger=function(l){this.runtime.getCurrentEventStack().current_event=this;this.conditions[l].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};K.prototype.run_actions_and_subevents=function(){var l=this.runtime.getCurrentEventStack(),r;l.actindex=0;for(r=this.actions.length;l.actindex<r;l.actindex++)if(this.actions[l.actindex].run())return;
this.run_subevents()};K.prototype.resume_actions_and_subevents=function(){var l=this.runtime.getCurrentEventStack(),r;for(r=this.actions.length;l.actindex<r;l.actindex++)if(this.actions[l.actindex].run())return;this.run_subevents()};K.prototype.run_subevents=function(){if(this.subevents.length){var l,r,y=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){var N=0;for(l=this.subevents.length;N<l;N++){var Q=this.subevents[N];(r=!this.toplevelgroup||!this.group&&N<y)&&
this.runtime.pushCopySol(Q.solModifiers);Q.run();r?this.runtime.popSol(Q.solModifiers):this.runtime.clearSol(Q.solModifiers)}}else for(N=0,l=this.subevents.length;N<l;N++)this.subevents[N].run();this.runtime.popEventStack()}};K.prototype.run_pretrigger=function(){var l=this.runtime.getCurrentEventStack();l.current_event=this;var r=!1,y;l.cndindex=0;for(y=this.conditions.length;l.cndindex<y;l.cndindex++)if(this.conditions[l.cndindex].run())r=!0;else if(!this.orblock)return!1;return this.orblock?r:
!0};K.prototype.retrigger=function(){this.runtime.execcount++;var l=this.runtime.getCurrentEventStack().cndindex,r=this.runtime.pushEventStack(this);if(!this.orblock)for(r.cndindex=l+1,l=this.conditions.length;r.cndindex<l;r.cndindex++)if(!this.conditions[r.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};K.prototype.isFirstConditionOfType=function(l){var r=l.index;if(0===r)return!0;for(--r;0<=r;--r)if(this.conditions[r].type===
l.type)return!1;return!0};cr.eventblock=K;a.prototype.postInit=function(){var l;var r=0;for(l=this.parameters.length;r<l;r++){var y=this.parameters[r];y.postInit();y.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};a.prototype.run_true=function(){return!0};a.prototype.run_system=function(){var l;var r=0;for(l=this.parameters.length;r<l;r++)this.results[r]=this.parameters[r].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};a.prototype.run_static=function(){var l;
var r=0;for(l=this.parameters.length;r<l;r++)this.results[r]=this.parameters[r].get();r=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return r};a.prototype.run_object=function(){var l,r,y,N=this.type,Q=N.getCurrentSol(),E=this.block.orblock&&!this.trigger,d=N.is_contained,h=N.is_family,B=N.family_index,e=this.beh_index,u=-1<e,F=this.anyParamVariesPerInstance,H=this.parameters,R=this.results,S=this.inverted,V=this.func;if(F){var T=0;for(r=
H.length;T<r;++T){var Z=H[T];Z.variesPerInstance||(R[T]=Z.get(0))}}else for(T=0,r=H.length;T<r;++T)R[T]=H[T].get(0);if(Q.select_all){cr.clearArray(Q.instances);cr.clearArray(Q.else_instances);var aa=N.instances;var f=0;for(l=aa.length;f<l;++f){var q=aa[f];if(F)for(T=0,r=H.length;T<r;++T)Z=H[T],Z.variesPerInstance&&(R[T]=Z.get(f));u?(T=0,h&&(T=q.type.family_beh_map[B]),T=V.apply(q.behavior_insts[e+T],R)):T=V.apply(q,R);(y=cr.xor(T,S))?Q.instances.push(q):E&&Q.else_instances.push(q)}N.finish&&N.finish(!0);
Q.select_all=!1;N.applySolToContainer();return Q.hasObjects()}var x=0;aa=(y=E&&!this.block.isFirstConditionOfType(this))?Q.else_instances:Q.instances;var C=!1;f=0;for(l=aa.length;f<l;++f){q=aa[f];if(F)for(T=0,r=H.length;T<r;++T)Z=H[T],Z.variesPerInstance&&(R[T]=Z.get(f));u?(T=0,h&&(T=q.type.family_beh_map[B]),T=V.apply(q.behavior_insts[e+T],R)):T=V.apply(q,R);if(cr.xor(T,S))if(C=!0,y){if(Q.instances.push(q),d)for(T=0,r=q.siblings.length;T<r;T++)Z=q.siblings[T],Z.type.getCurrentSol().instances.push(Z)}else{aa[x]=
q;if(d)for(T=0,r=q.siblings.length;T<r;T++)Z=q.siblings[T],Z.type.getCurrentSol().instances[x]=Z;x++}else if(y){aa[x]=q;if(d)for(T=0,r=q.siblings.length;T<r;T++)Z=q.siblings[T],Z.type.getCurrentSol().else_instances[x]=Z;x++}else if(E&&(Q.else_instances.push(q),d))for(T=0,r=q.siblings.length;T<r;T++)Z=q.siblings[T],Z.type.getCurrentSol().else_instances.push(Z)}cr.truncateArray(aa,x);if(d)for(h=N.container,f=0,l=h.length;f<l;f++)q=h[f].getCurrentSol(),y?cr.truncateArray(q.else_instances,x):cr.truncateArray(q.instances,
x);x=C;if(y&&!C)for(f=0,l=Q.instances.length;f<l;f++){q=Q.instances[f];if(F)for(T=0,r=H.length;T<r;T++)Z=H[T],Z.variesPerInstance&&(R[T]=Z.get(f));T=u?V.apply(q.behavior_insts[e],R):V.apply(q,R);if(cr.xor(T,S)){C=!0;break}}N.finish&&N.finish(x||E);return E?C:Q.hasObjects()};cr.condition=a;c.prototype.postInit=function(){var l;var r=0;for(l=this.parameters.length;r<l;r++){var y=this.parameters[r];y.postInit();y.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};c.prototype.run_system=function(){var l=
this.runtime,r,y=this.parameters,N=this.results;var Q=0;for(r=y.length;Q<r;++Q)N[Q]=y[Q].get();return this.func.apply(l.system,N)};c.prototype.run_object=function(){var l=this.type,r=this.beh_index,y=l.family_index,N=this.anyParamVariesPerInstance,Q=this.parameters,E=this.results,d=this.func,h=l.getCurrentSol().getObjects();l=l.is_family;var B=-1<r,e,u;if(N){var F=0;for(u=Q.length;F<u;++F){var H=Q[F];H.variesPerInstance||(E[F]=H.get(0))}}else for(F=0,u=Q.length;F<u;++F)E[F]=Q[F].get(0);var R=0;for(e=
h.length;R<e;++R){var S=h[R];if(N)for(F=0,u=Q.length;F<u;++F)H=Q[F],H.variesPerInstance&&(E[F]=H.get(R));B?(F=0,l&&(F=S.type.family_beh_map[y]),d.apply(S.behavior_insts[r+F],E)):d.apply(S,E)}return!1};cr.action=c;var G=[],M=-1;p.prototype.postInit=function(){var l;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type){var r=0;for(l=this.subparams.length;r<l;r++)this.subparams[r].postInit()}this.expression&&this.expression.postInit()};
p.prototype.maybeVaryForType=function(l){this.variesPerInstance||!l||l.plugin.singleglobal||(this.variesPerInstance=!0)};p.prototype.setVaries=function(){this.variesPerInstance=!0};p.prototype.get_exp=function(l){this.solindex=l||0;l=g();this.expression.get(l);M--;return l.data};p.prototype.get_exp_str=function(l){this.solindex=l||0;l=g();this.expression.get(l);M--;return cr.is_string(l.data)?l.data:""};p.prototype.get_object=function(){return this.object};p.prototype.get_combosel=function(){return this.combosel};
p.prototype.get_boolean=function(){return!!this.combosel};p.prototype.get_layer=function(l){this.solindex=l||0;l=g();this.expression.get(l);M--;return l.is_number()?this.runtime.getLayerByNumber(l.data):this.runtime.getLayerByName(l.data)};p.prototype.get_layout=function(){return this.layout};p.prototype.get_key=function(){return this.key};p.prototype.get_instvar=function(){return this.index};p.prototype.get_familyvar=function(l){var r=l||0;l=this.owner.type;var y=l.getCurrentSol(),N=y.getObjects();
if(N.length)r=N[r%N.length].type;else if(y.else_instances.length)r=y.else_instances[r%y.else_instances.length].type;else if(l.instances.length)r=l.instances[r%l.instances.length].type;else return 0;return this.index+r.family_var_map[l.family_index]};p.prototype.get_eventvar=function(){return this.eventvar};p.prototype.get_audiofile=function(){return this.fileinfo};p.prototype.get_variadic=function(){var l;var r=0;for(l=this.subparams.length;r<l;r++)this.variadicret[r]=this.subparams[r].get();return this.variadicret};
cr.parameter=p;m.prototype.postInit=function(){this.solModifiers=v(this.solModifiers)};m.prototype.setValue=function(l){var r=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&r?(this.localIndex>=r.length&&(r.length=this.localIndex+1),r[this.localIndex]=l):this.data=l};m.prototype.getValue=function(){var l=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!l||this.is_constant?this.data:this.localIndex>=l.length||"undefined"===typeof l[this.localIndex]?this.initial:
l[this.localIndex]};m.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=m;t.prototype.toString=function(){return"include:"+this.include_sheet.toString()};t.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=v(this.solModifiers);for(var l=this.parent;l;)l.group&&l.contained_includes.push(this),l=l.parent;this.updateActive()};t.prototype.run=
function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};t.prototype.updateActive=function(){for(var l=this.parent;l;){if(l.group&&!l.group_active){this.active=!1;return}l=l.parent}this.active=!0};t.prototype.isActive=function(){return this.active};cr.eventinclude=t;D.prototype.reset=function(l){this.current_event=l;this.actindex=this.cndindex=0;cr.clearArray(this.temp_parents_arr);
this.any_true_state=this.else_branch_ran=this.last_event_true=!1};D.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=D})();
(function(){function b(n,a){this.owner=n;this.runtime=n.runtime;this.type=a[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,
this.eval_eventvar_exp][this.type];var c=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=a[1];break;case 3:this.first=new cr.expNode(n,a[1]);break;case 18:this.first=new cr.expNode(n,a[1]);this.second=new cr.expNode(n,a[2]);this.third=new cr.expNode(n,a[3]);
break;case 19:this.func=this.runtime.GetObjectReference(a[1]);this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries();this.results=[];this.parameters=[];3===a.length?(c=a[2],this.results.length=c.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[a[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(a[2]);this.return_string=a[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&
this.owner.setVaries();this.instance_expr=a[4]?new cr.expNode(n,a[4]):null;this.results=[];this.parameters=[];6===a.length?(c=a[5],this.results.length=c.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[a[1]];this.return_string=a[2];this.instance_expr=a[3]?new cr.expNode(n,a[3]):null;this.varindex=a[4];break;case 22:this.object_type=this.runtime.types_by_index[a[1]];this.behavior_type=this.object_type.getBehaviorByName(a[2]);this.beh_index=this.object_type.getBehaviorIndexByName(a[2]);
this.func=this.runtime.GetObjectReference(a[3]);this.return_string=a[4];this.instance_expr=a[5]?new cr.expNode(n,a[5]):null;this.results=[];this.parameters=[];7===a.length?(c=a[6],this.results.length=c.length+1):this.results.length=1;break;case 23:this.varname=a[1],this.eventvar=null}this.owner.maybeVaryForType(this.object_type);4<=this.type&&17>=this.type&&(this.first=new cr.expNode(n,a[1]),this.second=new cr.expNode(n,a[2]));if(c){var g;a=0;for(g=c.length;a<g;a++)this.parameters.push(new cr.expNode(n,
c[a]))}cr.seal(this)}function k(){++K;J.length===K&&J.push(new cr.expvalue);return J[K]}function v(n,a,c){var g;var p=0;for(g=n.length;p<g;++p)n[p].get(c),a[p+1]=c.data}function A(n,a){this.type=n||cr.exptype.Integer;this.data=a||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}b.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();
this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var n;var a=0;for(n=this.parameters.length;a<n;a++)this.parameters[a].postInit()}};var J=[],K=-1;b.prototype.eval_system_exp=function(n){var a=this.parameters,c=this.results;c[0]=n;n=k();v(a,c,n);--K;this.func.apply(this.runtime.system,c)};b.prototype.eval_object_exp=function(n){var a=this.object_type,c=this.results,g=this.parameters,p=this.instance_expr,m=this.func,
t=this.owner.solindex,D=a.getCurrentSol(),z=D.getObjects();if(!z.length)if(D.else_instances.length)z=D.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}c[0]=n;n.object_class=a;n=k();v(g,c,n);p&&(p.get(n),n.is_number()&&(t=n.data,z=a.instances));--K;a=z.length;if(t>=a||t<=-a)t%=a;0>t&&(t+=a);m.apply(z[t],c)};b.prototype.eval_behavior_exp=function(n){var a=this.object_type,c=this.results,g=this.parameters,p=this.instance_expr,m=this.beh_index,t=this.func,D=this.owner.solindex,
z=a.getCurrentSol(),G=z.getObjects();if(!G.length)if(z.else_instances.length)G=z.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}c[0]=n;n.object_class=a;n=k();v(g,c,n);p&&(p.get(n),n.is_number()&&(D=n.data,G=a.instances));--K;g=G.length;if(D>=g||D<=-g)D%=g;0>D&&(D+=g);D=G[D];G=0;a.is_family&&(G=D.type.family_beh_map[a.family_index]);t.apply(D.behavior_insts[m+G],c)};b.prototype.eval_instvar_exp=function(n){var a=this.instance_expr,c=this.object_type,g=this.varindex,p=this.owner.solindex,
m=c.getCurrentSol(),t=m.getObjects();if(!t.length)if(m.else_instances.length)t=m.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}if(a){m=k();a.get(m);if(m.is_number()){p=m.data;t=c.instances;0!==t.length&&(p%=t.length,0>p&&(p+=t.length));p=c.getInstanceByIID(p);c=p.instance_vars[g];cr.is_string(c)?n.set_string(c):n.set_float(c);--K;return}--K}a=t.length;if(p>=a||p<=-a)p%=a;0>p&&(p+=a);p=t[p];t=0;c.is_family&&(t=p.type.family_var_map[c.family_index]);c=p.instance_vars[g+
t];cr.is_string(c)?n.set_string(c):n.set_float(c)};b.prototype.eval_int=function(n){n.type=cr.exptype.Integer;n.data=this.value};b.prototype.eval_float=function(n){n.type=cr.exptype.Float;n.data=this.value};b.prototype.eval_string=function(n){n.type=cr.exptype.String;n.data=this.value};b.prototype.eval_unaryminus=function(n){this.first.get(n);n.is_number()&&(n.data=-n.data)};b.prototype.eval_add=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data+=a.data,
a.is_float()&&n.make_float());--K};b.prototype.eval_subtract=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data-=a.data,a.is_float()&&n.make_float());--K};b.prototype.eval_multiply=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data*=a.data,a.is_float()&&n.make_float());--K};b.prototype.eval_divide=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data/=a.data,n.make_float());
--K};b.prototype.eval_mod=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data%=a.data,a.is_float()&&n.make_float());--K};b.prototype.eval_power=function(n){this.first.get(n);var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data=Math.pow(n.data,a.data),a.is_float()&&n.make_float());--K};b.prototype.eval_and=function(n){this.first.get(n);var a=k();this.second.get(a);a.is_string()||n.is_string()?this.eval_and_stringconcat(n,a):this.eval_and_logical(n,
a);--K};b.prototype.eval_and_stringconcat=function(n,a){n.is_string()&&a.is_string()?this.eval_and_stringconcat_str_str(n,a):this.eval_and_stringconcat_num(n,a)};b.prototype.eval_and_stringconcat_str_str=function(n,a){n.data+=a.data};b.prototype.eval_and_stringconcat_num=function(n,a){n.is_string()?n.data+=(Math.round(1E10*a.data)/1E10).toString():n.set_string(n.data.toString()+a.data)};b.prototype.eval_and_logical=function(n,a){n.set_int(n.data&&a.data?1:0)};b.prototype.eval_or=function(n){this.first.get(n);
var a=k();this.second.get(a);n.is_number()&&a.is_number()&&(n.data||a.data?n.set_int(1):n.set_int(0));--K};b.prototype.eval_conditional=function(n){this.first.get(n);n.data?this.second.get(n):this.third.get(n)};b.prototype.eval_equal=function(n){this.first.get(n);var a=k();this.second.get(a);n.set_int(n.data===a.data?1:0);--K};b.prototype.eval_notequal=function(n){this.first.get(n);var a=k();this.second.get(a);n.set_int(n.data!==a.data?1:0);--K};b.prototype.eval_less=function(n){this.first.get(n);
var a=k();this.second.get(a);n.set_int(n.data<a.data?1:0);--K};b.prototype.eval_lessequal=function(n){this.first.get(n);var a=k();this.second.get(a);n.set_int(n.data<=a.data?1:0);--K};b.prototype.eval_greater=function(n){this.first.get(n);var a=k();this.second.get(a);n.set_int(n.data>a.data?1:0);--K};b.prototype.eval_greaterequal=function(n){this.first.get(n);var a=k();this.second.get(a);n.set_int(n.data>=a.data?1:0);--K};b.prototype.eval_eventvar_exp=function(n){var a=this.eventvar.getValue();"number"===
typeof a?n.set_float(a):"boolean"===typeof a?n.set_int(a?1:0):n.set_string(a)};cr.expNode=b;A.prototype.is_int=function(){return this.type===cr.exptype.Integer};A.prototype.is_float=function(){return this.type===cr.exptype.Float};A.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};A.prototype.is_string=function(){return this.type===cr.exptype.String};A.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&
(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};A.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};A.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};A.prototype.set_int=function(n){this.type=cr.exptype.Integer;this.data=Math.floor(n)};A.prototype.set_float=function(n){this.type=cr.exptype.Float;this.data=n};A.prototype.set_string=function(n){this.type=
cr.exptype.String;this.data=n};A.prototype.set_any=function(n){cr.is_number(n)?(this.type=cr.exptype.Float,this.data=n):cr.is_string(n)?(this.type=cr.exptype.String,this.data=n.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=A;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(b){this.runtime=b;this.waits=[]};
cr.system_object.prototype.saveToJSON=function(){var b={},k,v,A;b.waits=[];var J=b.waits;var K=0;for(k=this.waits.length;K<k;K++){var n=this.waits[K];var a={t:n.time,st:n.signaltag,s:n.signalled,ev:n.ev.sid,sm:[],sols:{}};n.ev.actions[n.actindex]&&(a.act=n.ev.actions[n.actindex].sid);var c=0;for(v=n.solModifiers.length;c<v;c++)a.sm.push(n.solModifiers[c].sid);for(A in n.sols)if(n.sols.hasOwnProperty(A)){var g=this.runtime.types_by_index[parseInt(A,10)];var p={sa:n.sols[A].sa,insts:[]};c=0;for(v=n.sols[A].insts.length;c<
v;c++)p.insts.push(n.sols[A].insts[c].uid);a.sols[g.sid.toString()]=p}J.push(a)}return b};
cr.system_object.prototype.loadFromJSON=function(b){b=b.waits;var k,v,A,J,K;cr.clearArray(this.waits);var n=0;for(k=b.length;n<k;n++){var a=b[n];if(J=this.runtime.blocksBySid[a.ev.toString()]){var c=-1;var g=0;for(v=J.actions.length;g<v;g++)if(J.actions[g].sid===a.act){c=g;break}if(-1!==c){var p={sols:{},solModifiers:[],deleteme:!1};p.time=a.t;p.signaltag=a.st||"";p.signalled=!!a.s;p.ev=J;p.actindex=c;g=0;for(v=a.sm.length;g<v;g++)(J=this.runtime.getObjectTypeBySid(a.sm[g]))&&p.solModifiers.push(J);
for(A in a.sols)if(a.sols.hasOwnProperty(A)&&(J=this.runtime.getObjectTypeBySid(parseInt(A,10)))){c=a.sols[A];var m={sa:c.sa,insts:[]};g=0;for(v=c.insts.length;g<v;g++)(K=this.runtime.getObjectByUID(c.insts[g]))&&m.insts.push(K);p.sols[J.index.toString()]=m}this.waits.push(p)}}}};
(function(){function b(){}function k(d,h){d=d.extra.c2_feo_val;h=h.extra.c2_feo_val;if(cr.is_number(d)&&cr.is_number(h))return d-h;d=""+d;h=""+h;return d<h?-1:d>h?1:0}function v(d,h){D&&d===z&&h===G||(D=new RegExp(d,h),z=d,G=h);D.lastIndex=0;return D}function A(){}function J(){var d=l.length?l.pop():{sols:{},solModifiers:[]};d.deleteme=!1;return d}function K(){var d=r.length?r.pop():{insts:[]};d.sa=!1;return d}function n(d,h){var B=d[0]-h[0];return 0!==B?B:d[1]-h[1]}function a(d,h){return d[1]-h[1]}
function c(){}function g(d,h,B){if(d!==N||h!==Q||B!==E){var e=v(h,B);y=d.match(e);N=d;Q=h;E=B}}var p=cr.system_object.prototype;b.prototype.EveryTick=function(){return!0};b.prototype.OnLayoutStart=function(){return!0};b.prototype.OnLayoutEnd=function(){return!0};b.prototype.Compare=function(d,h,B){return cr.do_cmp(d,h,B)};b.prototype.CompareTime=function(d,h){var B=this.runtime.kahanTime.sum;return 0===d?(d=this.runtime.getCurrentCondition(),!d.extra.CompareTime_executed&&B>=h?d.extra.CompareTime_executed=
!0:!1):cr.do_cmp(B,d,h)};b.prototype.LayerVisible=function(d){return d?d.visible:!1};b.prototype.LayerEmpty=function(d){return d?!d.instances.length:!1};b.prototype.LayerCmpOpacity=function(d,h,B){return d?cr.do_cmp(100*d.opacity,h,B):!1};b.prototype.Repeat=function(d){var h=this.runtime.getCurrentEventStack(),B=h.current_event,e=h.isModifierAfterCnds();h=this.runtime.pushLoopStack();if(e)for(e=0;e<d&&!h.stopped;e++)this.runtime.pushCopySol(B.solModifiers),h.index=e,B.retrigger(),this.runtime.popSol(B.solModifiers);
else for(e=0;e<d&&!h.stopped;e++)h.index=e,B.retrigger();this.runtime.popLoopStack();return!1};b.prototype.While=function(d){var h=this.runtime.getCurrentEventStack();d=h.current_event;var B=h.isModifierAfterCnds();h=this.runtime.pushLoopStack();if(B)for(B=0;!h.stopped;B++)this.runtime.pushCopySol(d.solModifiers),h.index=B,d.retrigger()||(h.stopped=!0),this.runtime.popSol(d.solModifiers);else for(B=0;!h.stopped;B++)h.index=B,d.retrigger()||(h.stopped=!0);this.runtime.popLoopStack();return!1};b.prototype.For=
function(d,h,B){var e=this.runtime.getCurrentEventStack(),u=e.current_event;e=e.isModifierAfterCnds();d=this.runtime.pushLoopStack(d);if(B<h)if(e)for(;h>=B&&!d.stopped;--h)this.runtime.pushCopySol(u.solModifiers),d.index=h,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(;h>=B&&!d.stopped;--h)d.index=h,u.retrigger();else if(e)for(;h<=B&&!d.stopped;++h)this.runtime.pushCopySol(u.solModifiers),d.index=h,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(;h<=B&&!d.stopped;++h)d.index=
h,u.retrigger();this.runtime.popLoopStack();return!1};var m=[],t=-1;b.prototype.ForEach=function(d){var h=d.getCurrentSol();t++;m.length===t&&m.push([]);var B=m[t];cr.shallowAssignArray(B,h.getObjects());var e=this.runtime.getCurrentEventStack(),u=e.current_event,F=e.isModifierAfterCnds();e=this.runtime.pushLoopStack();var H,R,S=d.is_contained;if(F)for(F=0,H=B.length;F<H&&!e.stopped;F++){this.runtime.pushCopySol(u.solModifiers);var V=B[F];h=d.getCurrentSol();h.select_all=!1;cr.clearArray(h.instances);
h.instances[0]=V;if(S){var T=0;for(R=V.siblings.length;T<R;T++){var Z=V.siblings[T];var aa=Z.type.getCurrentSol();aa.select_all=!1;cr.clearArray(aa.instances);aa.instances[0]=Z}}e.index=F;u.retrigger();this.runtime.popSol(u.solModifiers)}else for(h.select_all=!1,cr.clearArray(h.instances),F=0,H=B.length;F<H&&!e.stopped;F++){V=B[F];h.instances[0]=V;if(S)for(T=0,R=V.siblings.length;T<R;T++)Z=V.siblings[T],aa=Z.type.getCurrentSol(),aa.select_all=!1,cr.clearArray(aa.instances),aa.instances[0]=Z;e.index=
F;u.retrigger()}cr.clearArray(B);this.runtime.popLoopStack();t--;return!1};b.prototype.ForEachOrdered=function(d,h,B){h=d.getCurrentSol();t++;m.length===t&&m.push([]);var e=m[t];cr.shallowAssignArray(e,h.getObjects());var u=this.runtime.getCurrentEventStack(),F=u.current_event,H=this.runtime.getCurrentCondition(),R=u.isModifierAfterCnds();u=this.runtime.pushLoopStack();var S;var V=0;for(S=e.length;V<S;V++)e[V].extra.c2_feo_val=H.parameters[1].get(V);e.sort(k);1===B&&e.reverse();B=d.is_contained;if(R)for(V=
0,S=e.length;V<S&&!u.stopped;V++){this.runtime.pushCopySol(F.solModifiers);var T=e[V];h=d.getCurrentSol();h.select_all=!1;cr.clearArray(h.instances);h.instances[0]=T;if(B)for(H=0,R=T.siblings.length;H<R;H++){var Z=T.siblings[H];var aa=Z.type.getCurrentSol();aa.select_all=!1;cr.clearArray(aa.instances);aa.instances[0]=Z}u.index=V;F.retrigger();this.runtime.popSol(F.solModifiers)}else for(h.select_all=!1,cr.clearArray(h.instances),V=0,S=e.length;V<S&&!u.stopped;V++){T=e[V];h.instances[0]=T;if(B)for(H=
0,R=T.siblings.length;H<R;H++)Z=T.siblings[H],aa=Z.type.getCurrentSol(),aa.select_all=!1,cr.clearArray(aa.instances),aa.instances[0]=Z;u.index=V;F.retrigger()}cr.clearArray(e);this.runtime.popLoopStack();t--;return!1};b.prototype.PickByComparison=function(d,h,B,e){var u,F;if(d){t++;m.length===t&&m.push([]);var H=m[t],R=d.getCurrentSol();cr.shallowAssignArray(H,R.getObjects());R.select_all&&cr.clearArray(R.else_instances);var S=this.runtime.getCurrentCondition();var V=u=0;for(F=H.length;u<F;u++){var T=
H[u];H[V]=T;h=S.parameters[1].get(u);e=S.parameters[3].get(u);cr.do_cmp(h,B,e)?V++:R.else_instances.push(T)}cr.truncateArray(H,V);R.select_all=!1;cr.shallowAssignArray(R.instances,H);cr.clearArray(H);t--;d.applySolToContainer();return!!R.instances.length}};b.prototype.PickByEvaluate=function(d,h){var B,e;if(d){t++;m.length===t&&m.push([]);var u=m[t],F=d.getCurrentSol();cr.shallowAssignArray(u,F.getObjects());F.select_all&&cr.clearArray(F.else_instances);var H=this.runtime.getCurrentCondition();var R=
B=0;for(e=u.length;B<e;B++){var S=u[B];u[R]=S;(h=H.parameters[1].get(B))?R++:F.else_instances.push(S)}cr.truncateArray(u,R);F.select_all=!1;cr.shallowAssignArray(F.instances,u);cr.clearArray(u);t--;d.applySolToContainer();return!!F.instances.length}};b.prototype.TriggerOnce=function(){var d=this.runtime.getCurrentCondition().extra;"undefined"===typeof d.TriggerOnce_lastTick&&(d.TriggerOnce_lastTick=-1);var h=d.TriggerOnce_lastTick,B=this.runtime.tickcount;d.TriggerOnce_lastTick=B;return this.runtime.layout_first_tick||
h!==B-1};b.prototype.Every=function(d){var h=this.runtime.getCurrentCondition(),B=h.extra.Every_lastTime||0,e=this.runtime.kahanTime.sum;"undefined"===typeof h.extra.Every_seconds&&(h.extra.Every_seconds=d);var u=h.extra.Every_seconds;if(e>=B+u)return h.extra.Every_lastTime=B+u,e>=h.extra.Every_lastTime+.04&&(h.extra.Every_lastTime=e),h.extra.Every_seconds=d,!0;e<B-.1&&(h.extra.Every_lastTime=e);return!1};b.prototype.PickNth=function(d,h){if(!d)return!1;var B=d.getCurrentSol(),e=B.getObjects();h=
cr.floor(h);if(0>h||h>=e.length)return!1;B.pick_one(e[h]);d.applySolToContainer();return!0};b.prototype.PickRandom=function(d){if(!d)return!1;var h=d.getCurrentSol(),B=h.getObjects(),e=cr.floor(Math.random()*B.length);if(e>=B.length)return!1;h.pick_one(B[e]);d.applySolToContainer();return!0};b.prototype.CompareVar=function(d,h,B){return cr.do_cmp(d.getValue(),h,B)};b.prototype.CompareBoolVar=function(d){return d.getValue()};b.prototype.IsGroupActive=function(d){return(d=this.runtime.groups_by_name[d.toLowerCase()])&&
d.group_active};b.prototype.IsPreview=function(){return this.runtime.isPreview};b.prototype.PickAll=function(d){if(!d||!d.instances.length)return!1;d.getCurrentSol().select_all=!0;d.applySolToContainer();return!0};b.prototype.IsMobile=function(){return this.runtime.isMobile};b.prototype.CompareBetween=function(d,h,B){return d>=h&&d<=B};b.prototype.Else=function(){var d=this.runtime.getCurrentEventStack();return d.else_branch_ran?!1:!d.last_event_true};b.prototype.OnLoadFinished=function(){return!0};
b.prototype.OnCanvasSnapshot=function(){return!0};b.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};b.prototype.OnSaveComplete=function(){return!0};b.prototype.OnSaveFailed=function(){return!0};b.prototype.OnLoadComplete=function(){return!0};b.prototype.OnLoadFailed=function(){return!0};b.prototype.ObjectUIDExists=function(d){return!!this.runtime.getObjectByUID(d)};b.prototype.IsOnPlatform=function(d){var h=this.runtime;switch(d){case 0:return!h.isNodeWebkit&&!h.isCordova&&!h.isWinJS&&
!h.isWindowsPhone8&&!h.isBlackberry10&&!h.isAmazonWebApp;case 1:return h.isiOS;case 2:return h.isAndroid;case 3:return h.isWindows8App;case 4:return h.isWindowsPhone8;case 5:return h.isBlackberry10;case 6:return h.isTizen;case 7:return!1;case 8:return h.isCordova;case 9:return h.isArcade;case 10:return h.isNodeWebkit;case 11:return h.isCrosswalk;case 12:return h.isAmazonWebApp;case 13:return h.isWindows10;default:return!1}};var D=null,z="",G="";b.prototype.RegexTest=function(d,h,B){return v(h,B).test(d)};
var M=[];b.prototype.PickOverlappingPoint=function(d,h,B){if(!d)return!1;var e=d.getCurrentSol(),u=e.getObjects(),F=this.runtime.getCurrentEventStack().current_event.orblock,H=this.runtime.getCurrentCondition(),R;e.select_all?(cr.shallowAssignArray(M,u),cr.clearArray(e.else_instances),e.select_all=!1,cr.clearArray(e.instances)):F?(cr.shallowAssignArray(M,e.else_instances),cr.clearArray(e.else_instances)):(cr.shallowAssignArray(M,u),cr.clearArray(e.instances));u=0;for(F=M.length;u<F;++u){var S=M[u];
S.update_bbox();(R=cr.xor(S.contains_pt(h,B),H.inverted))?e.instances.push(S):e.else_instances.push(S)}d.applySolToContainer();return cr.xor(!!e.instances.length,H.inverted)};b.prototype.PickLastCreated=function(d){if(!d)return!1;var h=this.runtime.createRow,B,e=null,u=d.is_family;for(B=h.length-1;0<=B;--B){var F=h[B];if(u){if(0<=F.type.families.indexOf(d)){e=F;break}}else if(F.type===d){e=F;break}}!e&&d.instances.length&&(e=d.instances[d.instances.length-1]);if(!e)return!1;d.getCurrentSol().pick_one(e);
d.applySolToContainer();return!0};b.prototype.IsNaN=function(d){return!!isNaN(d)};b.prototype.AngleWithin=function(d,h,B){return cr.angleDiff(cr.to_radians(d),cr.to_radians(B))<=cr.to_radians(h)};b.prototype.IsClockwiseFrom=function(d,h){return cr.angleClockwise(cr.to_radians(d),cr.to_radians(h))};b.prototype.IsBetweenAngles=function(d,h,B){d=cr.to_clamped_radians(d);h=cr.to_clamped_radians(h);B=cr.to_clamped_radians(B);return cr.angleClockwise(B,h)?cr.angleClockwise(d,h)&&!cr.angleClockwise(d,B):
!(!cr.angleClockwise(d,h)&&cr.angleClockwise(d,B))};b.prototype.IsValueType=function(d,h){return"number"===typeof d?0===h:1===h};p.cnds=new b;A.prototype.GoToLayout=function(d){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=d)};A.prototype.NextPrevLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout){var h=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!d||0!==h)if(d||h!==this.runtime.layouts_by_index.length-1)this.runtime.changelayout=
this.runtime.layouts_by_index[h+(d?-1:1)]}};A.prototype.CreateObject=function(d,h,B,e){if(h&&d&&(h=this.runtime.createInstance(d,h,B,e))){this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(d.plugin).cnds.OnCreated,h);if(h.is_contained)for(B=0,e=h.siblings.length;B<e;B++){var u=h.siblings[B];this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u)}this.runtime.isInOnDestroy--;d=d.getCurrentSol();d.select_all=!1;cr.clearArray(d.instances);d.instances[0]=h;if(h.is_contained)for(B=
0,e=h.siblings.length;B<e;B++)u=h.siblings[B],d=u.type.getCurrentSol(),d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=u}};A.prototype.CreateObjectByName=function(d,h,B,e){h&&d&&(d=this.runtime.types_lowercase[d.toLowerCase()])&&A.prototype.CreateObject.call(this,d,h,B,e)};A.prototype.SetLayerVisible=function(d,h){d&&d.visible!==h&&(d.visible=h,this.runtime.redraw=!0)};A.prototype.SetLayerOpacity=function(d,h){d&&(h=cr.clamp(h/100,0,1),d.opacity!==h&&(d.opacity=h,this.runtime.redraw=!0))};
A.prototype.SetLayerScaleRate=function(d,h){d&&d.zoomRate!==h&&(d.zoomRate=h,this.runtime.redraw=!0)};A.prototype.SetLayerForceOwnTexture=function(d,h){d&&(h=!!h,d.forceOwnTexture!==h&&(d.forceOwnTexture=h,this.runtime.redraw=!0))};A.prototype.SetLayoutScale=function(d){this.runtime.running_layout&&this.runtime.running_layout.scale!==d&&(this.runtime.running_layout.scale=d,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};A.prototype.ScrollX=function(d){this.runtime.running_layout.scrollToX(d)};
A.prototype.ScrollY=function(d){this.runtime.running_layout.scrollToY(d)};A.prototype.Scroll=function(d,h){this.runtime.running_layout.scrollToX(d);this.runtime.running_layout.scrollToY(h)};A.prototype.ScrollToObject=function(d){if(d=d.getFirstPicked())this.runtime.running_layout.scrollToX(d.x),this.runtime.running_layout.scrollToY(d.y)};A.prototype.SetVar=function(d,h){0===d.vartype?cr.is_number(h)?d.setValue(h):d.setValue(parseFloat(h)):1===d.vartype&&d.setValue(h.toString())};A.prototype.AddVar=
function(d,h){0===d.vartype?cr.is_number(h)?d.setValue(d.getValue()+h):d.setValue(d.getValue()+parseFloat(h)):1===d.vartype&&d.setValue(d.getValue()+h.toString())};A.prototype.SubVar=function(d,h){0===d.vartype&&(cr.is_number(h)?d.setValue(d.getValue()-h):d.setValue(d.getValue()-parseFloat(h)))};A.prototype.SetBoolVar=function(d,h){d.setValue(0!==h)};A.prototype.ToggleBoolVar=function(d){d.setValue(!d.getValue())};A.prototype.SetGroupActive=function(d,h){if(d=this.runtime.groups_by_name[d.toLowerCase()])switch(h){case 0:d.setGroupActive(!1);
break;case 1:d.setGroupActive(!0);break;case 2:d.setGroupActive(!d.group_active)}};A.prototype.SetTimescale=function(d){0>d&&(d=0);this.runtime.timescale=d};A.prototype.SetObjectTimescale=function(d,h){0>h&&(h=0);if(d){d=d.getCurrentSol().getObjects();var B;var e=0;for(B=d.length;e<B;e++)d[e].my_timescale=h}};A.prototype.RestoreObjectTimescale=function(d){if(!d)return!1;d=d.getCurrentSol().getObjects();var h;var B=0;for(h=d.length;B<h;B++)d[B].my_timescale=-1};var l=[],r=[];A.prototype.Wait=function(d){if(!(0>
d)){var h,B=this.runtime.getCurrentEventStack(),e=J();e.time=this.runtime.kahanTime.sum+d;e.signaltag="";e.signalled=!1;e.ev=B.current_event;e.actindex=B.actindex+1;d=0;for(h=this.runtime.types_by_index.length;d<h;d++){var u=this.runtime.types_by_index[d];var F=u.getCurrentSol();F.select_all&&-1===B.current_event.solModifiers.indexOf(u)||(e.solModifiers.push(u),u=K(),u.sa=F.select_all,cr.shallowAssignArray(u.insts,F.instances),e.sols[d.toString()]=u)}this.waits.push(e);return!0}};A.prototype.WaitForSignal=
function(d){var h,B=this.runtime.getCurrentEventStack(),e=J();e.time=-1;e.signaltag=d.toLowerCase();e.signalled=!1;e.ev=B.current_event;e.actindex=B.actindex+1;d=0;for(h=this.runtime.types_by_index.length;d<h;d++){var u=this.runtime.types_by_index[d];var F=u.getCurrentSol();F.select_all&&-1===B.current_event.solModifiers.indexOf(u)||(e.solModifiers.push(u),u=K(),u.sa=F.select_all,cr.shallowAssignArray(u.insts,F.instances),e.sols[d.toString()]=u)}this.waits.push(e);return!0};A.prototype.Signal=function(d){d=
d.toLowerCase();var h;var B=0;for(h=this.waits.length;B<h;++B){var e=this.waits[B];-1===e.time&&e.signaltag===d&&(e.signalled=!0)}};A.prototype.SetLayerScale=function(d,h){d&&d.scale!==h&&(d.scale=h,this.runtime.redraw=!0)};A.prototype.ResetGlobals=function(){var d;var h=0;for(d=this.runtime.all_global_vars.length;h<d;h++){var B=this.runtime.all_global_vars[h];B.data=B.initial}};A.prototype.SetLayoutAngle=function(d){d=cr.to_radians(d);d=cr.clamp_angle(d);this.runtime.running_layout&&this.runtime.running_layout.angle!==
d&&(this.runtime.running_layout.angle=d,this.runtime.redraw=!0)};A.prototype.SetLayerAngle=function(d,h){d&&(h=cr.to_radians(h),h=cr.clamp_angle(h),d.angle!==h&&(d.angle=h,this.runtime.redraw=!0))};A.prototype.SetLayerParallax=function(d,h,B){if(d&&(d.parallaxX!==h/100||d.parallaxY!==B/100)){d.parallaxX=h/100;d.parallaxY=B/100;if(1!==d.parallaxX||1!==d.parallaxY)for(B=d.instances,d=0,h=B.length;d<h;++d)B[d].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};A.prototype.SetLayerBackground=function(d,
h){if(d){var B=cr.clamp(Math.floor(255*cr.GetRValue(h)),0,255),e=cr.clamp(Math.floor(255*cr.GetGValue(h)),0,255);h=cr.clamp(Math.floor(255*cr.GetBValue(h)),0,255);if(d.background_color[0]!==B||d.background_color[1]!==e||d.background_color[2]!==h)d.background_color[0]=B,d.background_color[1]=e,d.background_color[2]=h,this.runtime.redraw=!0}};A.prototype.SetLayerTransparent=function(d,h){d&&!!h!==!!d.transparent&&(d.transparent=!!h,this.runtime.redraw=!0)};A.prototype.SetLayerBlendMode=function(d,h){d&&
d.blend_mode!==h&&(d.blend_mode=h,d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.runtime.gl&&cr.setGLBlend(d,d.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};A.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};A.prototype.GoToLayoutByName=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var h in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(h)&&cr.equals_nocase(h,d)){this.runtime.changelayout=
this.runtime.layouts[h];break}};A.prototype.RestartLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var h;d=0;for(h=this.runtime.allGroups.length;d<h;d++){var B=this.runtime.allGroups[d];B.setGroupActive(B.initially_activated)}}};A.prototype.SnapshotCanvas=function(d,h){this.runtime.doCanvasSnapshot(0===d?"image/png":"image/jpeg",h/100)};A.prototype.SetCanvasSize=function(d,h){if(!(0>=d||0>=
h)){var B=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(B=this.runtime.fullscreen_scaling);0===B?this.runtime.setSize(d,h,!0):(this.runtime.original_width=d,this.runtime.original_height=h,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};A.prototype.SetLayoutEffectEnabled=function(d,h){this.runtime.running_layout&&this.runtime.glwrap&&(h=
this.runtime.running_layout.getEffectByName(h))&&(d=1===d,h.active!=d&&(h.active=d,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0))};A.prototype.SetLayerEffectEnabled=function(d,h,B){d&&this.runtime.glwrap&&(B=d.getEffectByName(B))&&(h=1===h,B.active!=h&&(B.active=h,d.updateActiveEffects(),this.runtime.redraw=!0))};A.prototype.SetLayoutEffectParam=function(d,h,B){if(this.runtime.running_layout&&this.runtime.glwrap&&(d=this.runtime.running_layout.getEffectByName(d))){var e=
this.runtime.running_layout.effect_params[d.index];h=Math.floor(h);if(!(0>h||h>=e.length)){var u=this.runtime.glwrap.getProgramParameterType(d.shaderindex,h);1===u?B/=100:2===u&&(B=[cr.GetRValue(B),cr.GetGValue(B),cr.GetBValue(B)]);e[h]!==B&&(e[h]=B,d.active&&(this.runtime.redraw=!0))}}};A.prototype.SetLayerEffectParam=function(d,h,B,e){if(d&&this.runtime.glwrap&&(h=d.getEffectByName(h))&&(d=d.effect_params[h.index],B=Math.floor(B),!(0>B||B>=d.length))){var u=this.runtime.glwrap.getProgramParameterType(h.shaderindex,
B);1===u?e/=100:2===u&&(e=[cr.GetRValue(e),cr.GetGValue(e),cr.GetBValue(e)]);d[B]!==e&&(d[B]=e,h.active&&(this.runtime.redraw=!0))}};A.prototype.SaveState=function(d){this.runtime.saveToSlot=d};A.prototype.LoadState=function(d){this.runtime.loadFromSlot=d};A.prototype.LoadStateJSON=function(d){this.runtime.loadFromJson=d};A.prototype.SetHalfFramerateMode=function(d){this.runtime.halfFramerateMode=0!==d};A.prototype.SetFullscreenQuality=function(d){if(document.mozFullScreen||document.webkitIsFullScreen||
document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)this.runtime.wantFullscreenScalingQuality=0!==d,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)};A.prototype.ResetPersisted=function(){var d;var h=0;for(d=this.runtime.layouts_by_index.length;h<d;++h)this.runtime.layouts_by_index[h].persist_data={},this.runtime.layouts_by_index[h].first_visit=!0};A.prototype.RecreateInitialObjects=function(d,h,B,e,u){d&&this.runtime.running_layout.recreateInitialObjects(d,
h,B,e,u)};A.prototype.SetPixelRounding=function(d){this.runtime.pixel_rounding=0!==d;this.runtime.redraw=!0};A.prototype.SetMinimumFramerate=function(d){1>d&&(d=1);120<d&&(d=120);this.runtime.minimumFramerate=d};A.prototype.SortZOrderByInstVar=function(d,h){if(d){var B;var e=d.getCurrentSol().getObjects();var u=[],F=[],H=this.runtime.running_layout,R=d.is_family,S=d.family_index,V=!1;d=0;for(B=e.length;d<B;++d){var T=e[d];if(T.layer){var Z=R?T.instance_vars[h+T.type.family_var_map[S]]:T.instance_vars[h];
u.push([T.layer.index,T.get_zindex()]);F.push([T,Z])}}if(u.length){u.sort(n);F.sort(a);d=0;for(B=u.length;d<B;++d)T=F[d][0],h=H.layers[u[d][0]],e=u[d][1],h.instances[e]!==T&&(h.instances[e]=T,T.layer=h,h.setZIndicesStaleFrom(e),V=!0);V&&(this.runtime.redraw=!0)}}};p.acts=new A;c.prototype.int=function(d,h){cr.is_string(h)?(d.set_int(parseInt(h,10)),isNaN(d.data)&&(d.data=0)):d.set_int(h)};c.prototype.float=function(d,h){cr.is_string(h)?(d.set_float(parseFloat(h)),isNaN(d.data)&&(d.data=0)):d.set_float(h)};
c.prototype.str=function(d,h){cr.is_string(h)?d.set_string(h):d.set_string(h.toString())};c.prototype.len=function(d,h){d.set_int(h.length||0)};c.prototype.random=function(d,h,B){void 0===B?d.set_float(Math.random()*h):d.set_float(Math.random()*(B-h)+h)};c.prototype.sqrt=function(d,h){d.set_float(Math.sqrt(h))};c.prototype.abs=function(d,h){d.set_float(Math.abs(h))};c.prototype.round=function(d,h){d.set_int(Math.round(h))};c.prototype.floor=function(d,h){d.set_int(Math.floor(h))};c.prototype.ceil=
function(d,h){d.set_int(Math.ceil(h))};c.prototype.sign=function(d,h){d.set_float(Math.sign(h))};c.prototype.sin=function(d,h){d.set_float(Math.sin(cr.to_radians(h)))};c.prototype.cos=function(d,h){d.set_float(Math.cos(cr.to_radians(h)))};c.prototype.tan=function(d,h){d.set_float(Math.tan(cr.to_radians(h)))};c.prototype.asin=function(d,h){d.set_float(cr.to_degrees(Math.asin(h)))};c.prototype.acos=function(d,h){d.set_float(cr.to_degrees(Math.acos(h)))};c.prototype.atan=function(d,h){d.set_float(cr.to_degrees(Math.atan(h)))};
c.prototype.exp=function(d,h){d.set_float(Math.exp(h))};c.prototype.ln=function(d,h){d.set_float(Math.log(h))};c.prototype.log10=function(d,h){d.set_float(Math.log(h)/Math.LN10)};c.prototype.max=function(d){var h=arguments[1];"number"!==typeof h&&(h=0);var B;var e=2;for(B=arguments.length;e<B;e++){var u=arguments[e];"number"===typeof u&&h<u&&(h=u)}d.set_float(h)};c.prototype.min=function(d){var h=arguments[1];"number"!==typeof h&&(h=0);var B;var e=2;for(B=arguments.length;e<B;e++){var u=arguments[e];
"number"===typeof u&&h>u&&(h=u)}d.set_float(h)};c.prototype.dt=function(d){d.set_float(this.runtime.dt)};c.prototype.timescale=function(d){d.set_float(this.runtime.timescale)};c.prototype.wallclocktime=function(d){d.set_float((Date.now()-this.runtime.start_time)/1E3)};c.prototype.unixtime=function(d){d.set_float(Date.now())};c.prototype.time=function(d){d.set_float(this.runtime.kahanTime.sum)};c.prototype.tickcount=function(d){d.set_int(this.runtime.tickcount)};c.prototype.objectcount=function(d){d.set_int(this.runtime.objectcount)};
c.prototype.fps=function(d){d.set_int(this.runtime.fps)};c.prototype.loopindex=function(d,h){var B;if(this.runtime.loop_stack.length)if(h){for(B=this.runtime.loop_stack_index;0<=B;--B){var e=this.runtime.loop_stack[B];if(e.name===h){d.set_int(e.index);return}}d.set_int(0)}else e=this.runtime.getCurrentLoop(),d.set_int(e?e.index:-1);else d.set_int(0)};c.prototype.distance=function(d,h,B,e,u){d.set_float(cr.distanceTo(h,B,e,u))};c.prototype.angle=function(d,h,B,e,u){d.set_float(cr.to_degrees(cr.angleTo(h,
B,e,u)))};c.prototype.scrollx=function(d){d.set_float(this.runtime.running_layout.scrollX)};c.prototype.scrolly=function(d){d.set_float(this.runtime.running_layout.scrollY)};c.prototype.newline=function(d){d.set_string("\n")};c.prototype.lerp=function(d,h,B,e){d.set_float(cr.lerp(h,B,e))};c.prototype.qarp=function(d,h,B,e,u){d.set_float(cr.qarp(h,B,e,u))};c.prototype.cubic=function(d,h,B,e,u,F){d.set_float(cr.cubic(h,B,e,u,F))};c.prototype.cosp=function(d,h,B,e){d.set_float(cr.cosp(h,B,e))};c.prototype.windowwidth=
function(d){d.set_int(this.runtime.width)};c.prototype.windowheight=function(d){d.set_int(this.runtime.height)};c.prototype.uppercase=function(d,h){d.set_string(cr.is_string(h)?h.toUpperCase():"")};c.prototype.lowercase=function(d,h){d.set_string(cr.is_string(h)?h.toLowerCase():"")};c.prototype.clamp=function(d,h,B,e){h<B?d.set_float(B):h>e?d.set_float(e):d.set_float(h)};c.prototype.layerscale=function(d,h){(h=this.runtime.getLayer(h))?d.set_float(h.scale):d.set_float(0)};c.prototype.layeropacity=
function(d,h){(h=this.runtime.getLayer(h))?d.set_float(100*h.opacity):d.set_float(0)};c.prototype.layerscalerate=function(d,h){(h=this.runtime.getLayer(h))?d.set_float(h.zoomRate):d.set_float(0)};c.prototype.layerparallaxx=function(d,h){(h=this.runtime.getLayer(h))?d.set_float(100*h.parallaxX):d.set_float(0)};c.prototype.layerparallaxy=function(d,h){(h=this.runtime.getLayer(h))?d.set_float(100*h.parallaxY):d.set_float(0)};c.prototype.layerindex=function(d,h){(h=this.runtime.getLayer(h))?d.set_int(h.index):
d.set_int(-1)};c.prototype.layoutscale=function(d){this.runtime.running_layout?d.set_float(this.runtime.running_layout.scale):d.set_float(0)};c.prototype.layoutangle=function(d){d.set_float(cr.to_degrees(this.runtime.running_layout.angle))};c.prototype.layerangle=function(d,h){(h=this.runtime.getLayer(h))?d.set_float(cr.to_degrees(h.angle)):d.set_float(0)};c.prototype.layoutwidth=function(d){d.set_int(this.runtime.running_layout.width)};c.prototype.layoutheight=function(d){d.set_int(this.runtime.running_layout.height)};
c.prototype.find=function(d,h,B){cr.is_string(h)&&cr.is_string(B)?d.set_int(h.search(new RegExp(cr.regexp_escape(B),"i"))):d.set_int(-1)};c.prototype.findcase=function(d,h,B){cr.is_string(h)&&cr.is_string(B)?d.set_int(h.search(new RegExp(cr.regexp_escape(B),""))):d.set_int(-1)};c.prototype.left=function(d,h,B){d.set_string(cr.is_string(h)?h.substr(0,B):"")};c.prototype.right=function(d,h,B){d.set_string(cr.is_string(h)?h.substr(h.length-B):"")};c.prototype.mid=function(d,h,B,e){d.set_string(cr.is_string(h)?
h.substr(B,e):"")};c.prototype.tokenat=function(d,h,B,e){cr.is_string(h)&&cr.is_string(e)?(h=h.split(e),B=cr.floor(B),0>B||B>=h.length?d.set_string(""):d.set_string(h[B])):d.set_string("")};c.prototype.tokencount=function(d,h,B){cr.is_string(h)&&h.length?d.set_int(h.split(B).length):d.set_int(0)};c.prototype.replace=function(d,h,B,e){cr.is_string(h)&&cr.is_string(B)&&cr.is_string(e)?d.set_string(h.replace(new RegExp(cr.regexp_escape(B),"gi"),e)):d.set_string(cr.is_string(h)?h:"")};c.prototype.trim=
function(d,h){d.set_string(cr.is_string(h)?h.trim():"")};c.prototype.pi=function(d){d.set_float(cr.PI)};c.prototype.layoutname=function(d){this.runtime.running_layout?d.set_string(this.runtime.running_layout.name):d.set_string("")};c.prototype.renderer=function(d){d.set_string(this.runtime.gl?"webgl":"canvas2d")};c.prototype.rendererdetail=function(d){d.set_string(this.runtime.glUnmaskedRenderer)};c.prototype.anglediff=function(d,h,B){d.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(h),cr.to_radians(B))))};
c.prototype.choose=function(d){var h=cr.floor(Math.random()*(arguments.length-1));d.set_any(arguments[h+1])};c.prototype.rgb=function(d,h,B,e){d.set_int(cr.RGB(h,B,e))};c.prototype.rgbex=function(d,h,B,e){d.set_float(cr.RGBEx(h/100,B/100,e/100))};c.prototype.projectversion=function(d){d.set_string(this.runtime.versionstr)};c.prototype.projectname=function(d){d.set_string(this.runtime.name)};c.prototype.anglelerp=function(d,h,B,e){h=cr.to_radians(h);B=cr.to_radians(B);var u=cr.angleDiff(h,B);cr.angleClockwise(B,
h)?d.set_float(cr.to_clamped_degrees(h+u*e)):d.set_float(cr.to_clamped_degrees(h-u*e))};c.prototype.anglerotate=function(d,h,B,e){h=cr.to_radians(h);B=cr.to_radians(B);e=cr.to_radians(e);d.set_float(cr.to_clamped_degrees(cr.angleRotate(h,B,e)))};c.prototype.zeropad=function(d,h,B){var e=0>h?"-":"";0>h&&(h=-h);B-=h.toString().length;for(var u=0;u<B;u++)e+="0";d.set_string(e+h.toString())};c.prototype.cpuutilisation=function(d){d.set_float(this.runtime.cpuutilisation/1E3)};c.prototype.gpuutilisation=
function(d){d.set_float(this.runtime.gpuLastUtilisation)};c.prototype.viewportleft=function(d,h){h=this.runtime.getLayer(h);d.set_float(h?h.viewLeft:0)};c.prototype.viewporttop=function(d,h){h=this.runtime.getLayer(h);d.set_float(h?h.viewTop:0)};c.prototype.viewportright=function(d,h){h=this.runtime.getLayer(h);d.set_float(h?h.viewRight:0)};c.prototype.viewportbottom=function(d,h){h=this.runtime.getLayer(h);d.set_float(h?h.viewBottom:0)};c.prototype.loadingprogress=function(d){d.set_float(this.runtime.loadingprogress)};
c.prototype.unlerp=function(d,h,B,e){d.set_float(cr.unlerp(h,B,e))};c.prototype.canvassnapshot=function(d){d.set_string(this.runtime.snapshotData)};c.prototype.urlencode=function(d,h){d.set_string(encodeURIComponent(h))};c.prototype.urldecode=function(d,h){d.set_string(decodeURIComponent(h))};c.prototype.canvastolayerx=function(d,h,B,e){h=this.runtime.getLayer(h);d.set_float(h?h.canvasToLayer(B,e,!0):0)};c.prototype.canvastolayery=function(d,h,B,e){h=this.runtime.getLayer(h);d.set_float(h?h.canvasToLayer(B,
e,!1):0)};c.prototype.layertocanvasx=function(d,h,B,e){h=this.runtime.getLayer(h);d.set_float(h?h.layerToCanvas(B,e,!0):0)};c.prototype.layertocanvasy=function(d,h,B,e){h=this.runtime.getLayer(h);d.set_float(h?h.layerToCanvas(B,e,!1):0)};c.prototype.savestatejson=function(d){d.set_string(this.runtime.lastSaveJson)};c.prototype.imagememoryusage=function(d){this.runtime.glwrap?d.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):d.set_float(0)};c.prototype.regexsearch=function(d,
h,B,e){B=v(B,e);d.set_int(h?h.search(B):-1)};c.prototype.regexreplace=function(d,h,B,e,u){B=v(B,e);d.set_string(h?h.replace(B,u):"")};var y=[],N="",Q="",E="";c.prototype.regexmatchcount=function(d,h,B,e){v(B,e);g(h.toString(),B,e);d.set_int(y?y.length:0)};c.prototype.regexmatchat=function(d,h,B,e,u){u=Math.floor(u);v(B,e);g(h.toString(),B,e);!y||0>u||u>=y.length?d.set_string(""):d.set_string(y[u])};c.prototype.infinity=function(d){d.set_float(Infinity)};c.prototype.setbit=function(d,h,B,e){B|=0;d.set_int((h|
0)&~(1<<B)|(0!==e?1:0)<<B)};c.prototype.togglebit=function(d,h,B){d.set_int((h|0)^1<<(B|0))};c.prototype.getbit=function(d,h,B){d.set_int((h|0)&1<<(B|0)?1:0)};c.prototype.originalwindowwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalwindowheight=function(d){d.set_int(this.runtime.original_height)};c.prototype.originalviewportwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalviewportheight=function(d){d.set_int(this.runtime.original_height)};
p.exps=new c;p.runWaits=function(){var d,h=this.runtime.getCurrentEventStack();var B=0;for(d=this.waits.length;B<d;B++){var e=this.waits[B];if(-1===e.time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;h.current_event=e.ev;h.actindex=e.actindex;h.cndindex=0;for(H in e.sols)if(e.sols.hasOwnProperty(H)){var u=this.runtime.types_by_index[parseInt(H,10)].getCurrentSol();var F=e.sols[H];u.select_all=F.sa;cr.shallowAssignArray(u.instances,F.insts);u=F;cr.clearArray(u.insts);
r.push(u)}e.ev.resume_actions_and_subevents();this.runtime.clearSol(e.solModifiers);e.deleteme=!0}var H=B=0;for(d=this.waits.length;B<d;B++)e=this.waits[B],this.waits[H]=e,e.deleteme?(cr.wipe(e.sols),cr.clearArray(e.solModifiers),l.push(e)):H++;cr.truncateArray(this.waits,H)}})();
(function(){cr.add_common_aces=function(k,v){var A=k[1],J=k[3],K=k[4],n=k[5],a=k[6],c=k[7],g=k[8],p=k[10],m=k[11];k=k[12];v.cnds||(v.cnds={});v.acts||(v.acts={});v.exps||(v.exps={});var t=v.cnds,D=v.acts;v=v.exps;J&&(t.CompareX=function(z,G){return cr.do_cmp(this.x,z,G)},t.CompareY=function(z,G){return cr.do_cmp(this.y,z,G)},t.IsOnScreen=function(){var z=this.layer;this.update_bbox();var G=this.bbox;return!(G.right<z.viewLeft||G.bottom<z.viewTop||G.left>z.viewRight||G.top>z.viewBottom)},t.IsOutsideLayout=
function(){this.update_bbox();var z=this.bbox,G=this.runtime.running_layout;return 0>z.right||0>z.bottom||z.left>G.width||z.top>G.height},t.PickDistance=function(z,G,M){var l=this.getCurrentSol(),r=l.getObjects();if(!r.length)return!1;var y=r[0],N=y,Q=cr.distanceTo(y.x,y.y,G,M),E;var d=1;for(E=r.length;d<E;d++){y=r[d];var h=cr.distanceTo(y.x,y.y,G,M);if(0===z&&h<Q||1===z&&h>Q)Q=h,N=y}l.pick_one(N);return!0},D.SetX=function(z){this.x!==z&&(this.x=z,this.set_bbox_changed())},D.SetY=function(z){this.y!==
z&&(this.y=z,this.set_bbox_changed())},D.SetPos=function(z,G){if(this.x!==z||this.y!==G)this.x=z,this.y=G,this.set_bbox_changed()},D.SetPosToObject=function(z,G){var M=z.getPairedInstance(this);M&&(M.getImagePoint?(z=M.getImagePoint(G,!0),G=M.getImagePoint(G,!1)):(z=M.x,G=M.y),this.x!==z||this.y!==G)&&(this.x=z,this.y=G,this.set_bbox_changed())},D.MoveForward=function(z){0!==z&&(this.x+=Math.cos(this.angle)*z,this.y+=Math.sin(this.angle)*z,this.set_bbox_changed())},D.MoveAtAngle=function(z,G){0!==
G&&(this.x+=Math.cos(cr.to_radians(z))*G,this.y+=Math.sin(cr.to_radians(z))*G,this.set_bbox_changed())},v.X=function(z){z.set_float(this.x)},v.Y=function(z){z.set_float(this.y)},v.dt=function(z){z.set_float(this.runtime.getDt(this))});K&&(t.CompareWidth=function(z,G){return cr.do_cmp(this.width,z,G)},t.CompareHeight=function(z,G){return cr.do_cmp(this.height,z,G)},D.SetWidth=function(z){this.width!==z&&(this.width=z,this.set_bbox_changed())},D.SetHeight=function(z){this.height!==z&&(this.height=z,
this.set_bbox_changed())},D.SetSize=function(z,G){if(this.width!==z||this.height!==G)this.width=z,this.height=G,this.set_bbox_changed()},v.Width=function(z){z.set_float(this.width)},v.Height=function(z){z.set_float(this.height)},v.BBoxLeft=function(z){this.update_bbox();z.set_float(this.bbox.left)},v.BBoxTop=function(z){this.update_bbox();z.set_float(this.bbox.top)},v.BBoxRight=function(z){this.update_bbox();z.set_float(this.bbox.right)},v.BBoxBottom=function(z){this.update_bbox();z.set_float(this.bbox.bottom)});
n&&(t.AngleWithin=function(z,G){return cr.angleDiff(this.angle,cr.to_radians(G))<=cr.to_radians(z)},t.IsClockwiseFrom=function(z){return cr.angleClockwise(this.angle,cr.to_radians(z))},t.IsBetweenAngles=function(z,G){z=cr.to_clamped_radians(z);G=cr.to_clamped_radians(G);var M=cr.clamp_angle(this.angle);return cr.angleClockwise(G,z)?cr.angleClockwise(M,z)&&!cr.angleClockwise(M,G):!(!cr.angleClockwise(M,z)&&cr.angleClockwise(M,G))},D.SetAngle=function(z){z=cr.to_radians(cr.clamp_angle_degrees(z));isNaN(z)||
this.angle===z||(this.angle=z,this.set_bbox_changed())},D.RotateClockwise=function(z){0===z||isNaN(z)||(this.angle+=cr.to_radians(z),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},D.RotateCounterclockwise=function(z){0===z||isNaN(z)||(this.angle-=cr.to_radians(z),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},D.RotateTowardAngle=function(z,G){z=cr.angleRotate(this.angle,cr.to_radians(G),cr.to_radians(z));isNaN(z)||this.angle===z||(this.angle=z,this.set_bbox_changed())},
D.RotateTowardPosition=function(z,G,M){z=cr.angleRotate(this.angle,Math.atan2(M-this.y,G-this.x),cr.to_radians(z));isNaN(z)||this.angle===z||(this.angle=z,this.set_bbox_changed())},D.SetTowardPosition=function(z,G){z=Math.atan2(G-this.y,z-this.x);isNaN(z)||this.angle===z||(this.angle=z,this.set_bbox_changed())},v.Angle=function(z){z.set_float(cr.to_clamped_degrees(this.angle))});A||(t.CompareInstanceVar=function(z,G,M){return cr.do_cmp(this.instance_vars[z],G,M)},t.IsBoolInstanceVarSet=function(z){return this.instance_vars[z]},
t.PickInstVarHiLow=function(z,G){var M=this.getCurrentSol(),l=M.getObjects();if(!l.length)return!1;var r=l[0],y=r,N=r.instance_vars[G],Q;var E=1;for(Q=l.length;E<Q;E++){r=l[E];var d=r.instance_vars[G];if(0===z&&d<N||1===z&&d>N)N=d,y=r}M.pick_one(y);return!0},t.PickByUID=function(z){var G;if(this.runtime.getCurrentCondition().inverted){var M=this.getCurrentSol();if(M.select_all){M.select_all=!1;cr.clearArray(M.instances);cr.clearArray(M.else_instances);var l=this.instances;var r=0;for(G=l.length;r<
G;r++){var y=l[r];y.uid===z?M.else_instances.push(y):M.instances.push(y)}}else{l=r=0;for(G=M.instances.length;r<G;r++)y=M.instances[r],M.instances[l]=y,y.uid===z?M.else_instances.push(y):l++;cr.truncateArray(M.instances,l)}this.applySolToContainer();return!!M.instances.length}y=this.runtime.getObjectByUID(z);if(!y)return!1;M=this.getCurrentSol();if(!M.select_all&&-1===M.instances.indexOf(y))return!1;if(this.is_family)for(z=y.type.families,r=0,G=z.length;r<G;r++){if(z[r]===this)return M.pick_one(y),
this.applySolToContainer(),!0}else if(y.type===this)return M.pick_one(y),this.applySolToContainer(),!0;return!1},t.OnCreated=function(){return!0},t.OnDestroyed=function(){return!0},D.SetInstanceVar=function(z,G){var M=this.instance_vars;cr.is_number(M[z])?cr.is_number(G)?M[z]=G:M[z]=parseFloat(G):cr.is_string(M[z])&&(cr.is_string(G)?M[z]=G:M[z]=G.toString())},D.AddInstanceVar=function(z,G){var M=this.instance_vars;cr.is_number(M[z])?cr.is_number(G)?M[z]+=G:M[z]+=parseFloat(G):cr.is_string(M[z])&&
(cr.is_string(G)?M[z]+=G:M[z]+=G.toString())},D.SubInstanceVar=function(z,G){var M=this.instance_vars;cr.is_number(M[z])&&(cr.is_number(G)?M[z]-=G:M[z]-=parseFloat(G))},D.SetBoolInstanceVar=function(z,G){this.instance_vars[z]=G?1:0},D.ToggleBoolInstanceVar=function(z){this.instance_vars[z]=1-this.instance_vars[z]},D.Destroy=function(){this.runtime.DestroyInstance(this)},D.LoadFromJsonString||(D.LoadFromJsonString=function(z){try{var G=JSON.parse(z)}catch(l){return}this.runtime.loadInstanceFromJSON(this,
G,!0);this.afterLoad&&this.afterLoad();if(this.behavior_insts)for(z=0,G=this.behavior_insts.length;z<G;++z){var M=this.behavior_insts[z];M.afterLoad&&M.afterLoad()}}),v.Count=function(z){var G=z.object_class.instances.length,M;var l=0;for(M=this.runtime.createRow.length;l<M;l++){var r=this.runtime.createRow[l];z.object_class.is_family?0<=r.type.families.indexOf(z.object_class)&&G++:r.type===z.object_class&&G++}z.set_int(G)},v.PickedCount=function(z){z.set_int(z.object_class.getCurrentSol().getObjects().length)},
v.UID=function(z){z.set_int(this.uid)},v.IID=function(z){z.set_int(this.get_iid())},v.AsJSON||(v.AsJSON=function(z){z.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));a&&(t.IsVisible=function(){return this.visible},D.SetVisible=function(z){z=2===z?!this.visible:0!==z;z!==this.visible&&(this.visible=z,this.runtime.redraw=!0)},t.CompareOpacity=function(z,G){return cr.do_cmp(cr.round6dp(100*this.opacity),z,G)},D.SetOpacity=function(z){z/=100;0>z?z=0:1<z&&(z=1);z!==this.opacity&&
(this.opacity=z,this.runtime.redraw=!0)},v.Opacity=function(z){z.set_float(cr.round6dp(100*this.opacity))});c&&(t.IsOnLayer=function(z){return z?this.layer===z:!1},t.PickTopBottom=function(z){var G=this.getCurrentSol(),M=G.getObjects();if(!M.length)return!1;var l=M[0],r=l,y;var N=1;for(y=M.length;N<y;N++)if(l=M[N],0===z){if(l.layer.index>r.layer.index||l.layer.index===r.layer.index&&l.get_zindex()>r.get_zindex())r=l}else if(l.layer.index<r.layer.index||l.layer.index===r.layer.index&&l.get_zindex()<
r.get_zindex())r=l;G.pick_one(r);return!0},D.MoveToTop=function(){var z=this.layer,G=z.instances;G.length&&G[G.length-1]===this||(z.removeFromInstanceList(this,!1),z.appendToInstanceList(this,!1),this.runtime.redraw=!0)},D.MoveToBottom=function(){var z=this.layer,G=z.instances;G.length&&G[0]===this||(z.removeFromInstanceList(this,!1),z.prependToInstanceList(this,!1),this.runtime.redraw=!0)},D.MoveToLayer=function(z){z&&z!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=z,z.appendToInstanceList(this,
!0),this.runtime.redraw=!0)},D.ZMoveToObject=function(z,G){z=0===z;G&&(G=G.getFirstPicked(this))&&G.uid!==this.uid&&(this.layer.index!==G.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=G.layer,G.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,G,z),this.runtime.redraw=!0)},v.LayerNumber=function(z){z.set_int(this.layer.number)},v.LayerName=function(z){z.set_string(this.layer.name)},v.ZIndex=function(z){z.set_int(this.get_zindex())});g&&(D.SetEffectEnabled=
function(z,G){this.runtime.glwrap&&(G=this.type.getEffectIndexByName(G),0>G||(z=1===z,this.active_effect_flags[G]!==z&&(this.active_effect_flags[G]=z,this.updateActiveEffects(),this.runtime.redraw=!0)))},D.SetEffectParam=function(z,G,M){if(this.runtime.glwrap){var l=this.type.getEffectIndexByName(z);if(!(0>l||(z=this.type.effect_types[l],l=this.effect_params[l],G=Math.floor(G),0>G||G>=l.length))){var r=this.runtime.glwrap.getProgramParameterType(z.shaderindex,G);1===r&&(M/=100);if(2===r){r=cr.GetRValue(M);
var y=cr.GetGValue(M);M=cr.GetBValue(M);G=l[G];if(G[0]===r&&G[1]===y&&G[2]===M)return;G[0]=r;G[1]=y;G[2]=M}else{if(l[G]===M)return;l[G]=M}z.active&&(this.runtime.redraw=!0)}}});p&&(D.SetVisible=function(z){this.visible=0!==z},D.SetCSSStyle=function(z,G){this.elem.style[cr.cssToCamelCase(z)]=G});m&&(D.SetFocus=function(){(this.inputElem||this.elem).focus()},D.SetBlur=function(){(this.inputElem||this.elem).blur()});k&&(D.SetEnabled=function(z){(this.inputElem||this.elem).disabled=0===z})};cr.set_bbox_changed=
function(){this.cell_changed=this.bbox_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;var k,v=this.bbox_changed_callbacks;var A=0;for(k=v.length;A<k;++A)v[A](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(k){k&&this.bbox_changed_callbacks.push(k)};cr.update_bbox=function(){if(this.bbox_changed){var k=this.bbox,v=this.bquad;k.set(this.x,this.y,this.x+this.width,this.y+this.height);k.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);
this.angle?(k.offset(-this.x,-this.y),v.set_from_rotated_rect(k,this.angle),v.offset(this.x,this.y),v.bounding_box(k)):v.set_from_rect(k);k.normalize();this.bbox_changed=!1;this.update_render_cell()}};var b=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var k=this.layer.render_grid,v=this.bbox;b.set(k.XToCell(v.left),k.YToCell(v.top),k.XToCell(v.right),k.YToCell(v.bottom));this.rendercells.equals(b)||(this.rendercells.right<this.rendercells.left?k.update(this,
null,b):k.update(this,this.rendercells,b),this.rendercells.copy(b),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var k=this.type.collision_grid,v=this.bbox;b.set(k.XToCell(v.left),k.YToCell(v.top),k.XToCell(v.right),k.YToCell(v.bottom));this.collcells.equals(b)||(this.collcells.right<this.collcells.left?k.update(this,null,b):k.update(this,this.collcells,b),this.collcells.copy(b),this.cell_changed=!1)}};cr.inst_contains_pt=
function(k,v){return this.bbox.contains_pt(k,v)&&this.bquad.contains_pt(k,v)?this.tilemap_exists?this.testPointOverlapTile(k,v):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(k-this.x,v-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
var k,v=!0;var A=0;for(k=this.active_effect_flags.length;A<k;A++)if(this.active_effect_flags[A]){var J=this.type.effect_types[A];this.active_effect_types.push(J);J.preservesOpaqueness||(v=!1)}this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=v};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(k){if(k&&k.is_contained&&k.type!=this){var v;var A=0;for(v=k.siblings.length;A<v;A++){var J=k.siblings[A];if(J.type==this)return J}}k=this.getCurrentSol().getObjects();
return k.length?k[0]:null};cr.type_getPairedInstance=function(k){var v=this.getCurrentSol().getObjects();return v.length?v[k.get_iid()%v.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var k;var v=0;for(k=this.instances.length;v<k;v++)this.instances[v].iid=v;var A=v,J=this.runtime.createRow;v=0;for(k=J.length;v<k;++v)J[v].type===this&&(J[v].iid=A++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(k){if(k<this.instances.length)return this.instances[k];k-=this.instances.length;
var v=this.runtime.createRow,A;var J=0;for(A=v.length;J<A;++J)if(v[J].type===this){if(0===k)return v[J];--k}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&
this.solstack.push(new cr.selection(this));var k=this.solstack[this.cur_sol],v=this.solstack[this.cur_sol-1];v.select_all?k.select_all=!0:(k.select_all=!1,cr.shallowAssignArray(k.instances,v.instances));cr.clearArray(k.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(k){var v,A,J=0;if(!this.is_family){var K=0;for(v=this.families.length;K<v;K++){var n=this.families[K];var a=0;for(A=n.behaviors.length;a<A;a++){if(k===n.behaviors[a].name)return this.extra.lastBehIndex=
J,n.behaviors[a];J++}}}K=0;for(v=this.behaviors.length;K<v;K++){if(k===this.behaviors[K].name)return this.extra.lastBehIndex=J,this.behaviors[K];J++}return null};cr.type_getBehaviorIndexByName=function(k){return this.getBehaviorByName(k)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(k){var v;var A=0;for(v=this.effect_types.length;A<v;A++)if(this.effect_types[A].name===k)return A;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var k,v,A;this.updateIIDs();
var J=this.getCurrentSol();var K=J.select_all,n=(k=this.runtime.getCurrentEventStack())&&k.current_event&&k.current_event.orblock;k=0;for(v=this.container.length;k<v;k++){var a=this.container[k];if(a!==this){a.updateIIDs();var c=a.getCurrentSol();c.select_all=K;if(!K){cr.clearArray(c.instances);var g=0;for(A=J.instances.length;g<A;++g)c.instances[g]=a.getInstanceByIID(J.instances[g].iid);if(n)for(cr.clearArray(c.else_instances),g=0,A=J.else_instances.length;g<A;++g)c.else_instances[g]=a.getInstanceByIID(J.else_instances[g].iid)}}}}};
cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(k,v,A){if("undefined"===typeof k||"undefined"===typeof A)return!1;switch(v){case 0:return k===A;case 1:return k!==A;case 2:return k<A;case 3:return k<=A;case 4:return k>A;case 5:return k>=A;default:return!1}}})();cr.shaders={};cr.plugins_.Text=function(b){this.runtime=b};
(function(){function b(){return p.length?p.pop():{}}function k(m){var t;var D=0;for(t=m.length;D<t;D++)p.push(m[D]);cr.clearArray(m)}function v(m){return m.length&&" "===m.charAt(m.length-1)?m.substring(0,m.length-1):m}function A(){}function J(){}function K(){}var n=cr.plugins_.Text.prototype;n.onCreate=function(){n.acts.SetWidth=function(m){this.width!==m&&(this.width=m,this.text_changed=!0,this.set_bbox_changed())}};n.Type=function(m){this.plugin=m;this.runtime=m.runtime};var a=n.Type.prototype;
a.onCreate=function(){};a.onLostWebGLContext=function(){if(!this.is_family){var m;var t=0;for(m=this.instances.length;t<m;t++){var D=this.instances[t];D.mycanvas=null;D.myctx=null;D.mytex=null}}};n.Instance=function(m){this.type=m;this.runtime=m.runtime;this.recycled?cr.clearArray(this.lines):this.lines=[];this.text_changed=!0};a=n.Instance.prototype;var c={};a.onCreate=function(){this.text=this.properties[0];this.facename=this.properties[2];this.ptSize=this.properties[3];this.line_height_offset=
this.properties[4];this.isBold=this.properties[5];this.isItalic=this.properties[6];var m=this.properties[7];this.color="rgb("+Math.floor(255*m[0])+","+Math.floor(255*m[1])+","+Math.floor(255*m[2])+")";this.halign=this.properties[8];this.valign=this.properties[9];this.wrapbyword=0===this.properties[10];this.visible=this.properties[11];this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height;this.fontstyle=this.font="";this.textHeight=this.textWidth=this.pxHeight=0;this.updateFont();
this.mytex=this.myctx=this.mycanvas=null;this.need_text_redraw=!1;this.last_render_tick=this.runtime.tickcount;this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1);this.runtime.glwrap&&this.runtime.tickMe(this)};a.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}};
a.loadFromJSON=function(m){this.text=m.t;this.font=m.f;this.color=m.c;this.halign=m.ha;this.valign=m.va;this.wrapbyword=m.wr;this.line_height_offset=m.lho;this.facename=m.fn;this.fontstyle=m.fs;this.ptSize=m.ps;this.pxHeight=m.pxh;this.textWidth=m.tw;this.textHeight=m.th;this.last_render_tick=m.lrt;this.isBold=0!==this.fontstyle.indexOf("bold");this.isItalic=0!==this.fontstyle.indexOf("italic");this.text_changed=!0;this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height};a.tick=function(){if(this.runtime.glwrap&&
this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var m=this.layer;this.update_bbox();var t=this.bbox;if(t.right<m.viewLeft||t.bottom<m.viewTop||t.left>m.viewRight||t.top>m.viewBottom)this.runtime.glwrap.deleteTexture(this.mytex),this.mycanvas=this.myctx=this.mytex=null}};a.onDestroy=function(){this.mycanvas=this.myctx=null;this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex);this.mytex=null};a.updateFont=function(){this.pxHeight=Math.ceil(this.ptSize/72*96)+
4;var m=[];this.isBold&&m.push("bold");this.isItalic&&m.push("italic");this.fontstyle=m.join(" ");this.font=this.fontstyle+" "+this.ptSize.toString()+"pt '"+this.facename+"'";this.text_changed=!0;this.runtime.redraw=!0};a.draw=function(m,t){m.font=this.font;m.textBaseline="top";m.fillStyle=this.color;m.globalAlpha=t?1:this.opacity;if(t){var D=this.layer.getScale();m.save();m.scale(D,D)}if(this.text_changed||this.width!==this.lastwrapwidth)this.type.plugin.WordWrap(this.text,this.lines,m,this.width,
this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width;this.update_bbox();D=t?0:this.bquad.tlx;var z=t?0:this.bquad.tly;this.runtime.pixel_rounding&&(D=D+.5|0,z=z+.5|0);0===this.angle||t||(m.save(),m.translate(D,z),m.rotate(this.angle),z=D=0);var G=z+this.height,M=this.pxHeight;M+=this.line_height_offset;var l;1===this.valign?z+=Math.max(this.height/2-this.lines.length*M/2,0):2===this.valign&&(z+=Math.max(this.height-this.lines.length*M-2,0));for(l=0;l<this.lines.length;l++){var r=D;
1===this.halign?r=D+(this.width-this.lines[l].width)/2:2===this.halign&&(r=D+(this.width-this.lines[l].width));m.fillText(this.lines[l].text,r,z);z+=M;if(z>=G-M)break}(0!==this.angle||t)&&m.restore();this.last_render_tick=this.runtime.tickcount};a.drawGL=function(m){if(!(1>this.width||1>this.height)){var t=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var D=this.layer.getScale(),z=this.layer.getAngle(),G=this.rcTex,M=D*this.width,l=D*this.height,r=Math.ceil(M),y=Math.ceil(l),N=
this.runtime.draw_width/2,Q=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=r,this.mycanvas.height=y,this.lastwidth=r,this.lastheight=y,t=!0,this.myctx=this.mycanvas.getContext("2d"));if(r!==this.lastwidth||y!==this.lastheight)this.mycanvas.width=r,this.mycanvas.height=y,this.mytex&&(m.deleteTexture(this.mytex),this.mytex=null),t=!0;t&&(this.myctx.clearRect(0,0,r,y),this.draw(this.myctx,!0),this.mytex||(this.mytex=m.createEmptyTexture(r,y,
this.runtime.linearSampling,this.runtime.isMobile)),m.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile));this.lastwidth=r;this.lastheight=y;m.setTexture(this.mytex);m.setOpacity(this.opacity);m.resetModelView();m.translate(-N,-Q);m.updateModelView();var E=this.bquad;t=this.layer.layerToCanvas(E.tlx,E.tly,!0,!0);N=this.layer.layerToCanvas(E.tlx,E.tly,!1,!0);Q=this.layer.layerToCanvas(E.trx,E.try_,!0,!0);var d=this.layer.layerToCanvas(E.trx,E.try_,!1,!0),h=this.layer.layerToCanvas(E.brx,
E.bry,!0,!0),B=this.layer.layerToCanvas(E.brx,E.bry,!1,!0),e=this.layer.layerToCanvas(E.blx,E.bly,!0,!0);E=this.layer.layerToCanvas(E.blx,E.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===z){var u=(t+.5|0)-t,F=(N+.5|0)-N;t+=u;N+=F;Q+=u;d+=F;h+=u;B+=F;e+=u;E+=F}0===this.angle&&0===z?(Q=t+r,d=N,h=Q,B=N+y,e=t,E=B,G.right=1,G.bottom=1):(G.right=M/r,G.bottom=l/y);m.quadTex(t,N,Q,d,h,B,e,E,G);m.resetModelView();m.scale(D,D);m.rotateZ(-this.layer.getAngle());m.translate((this.layer.viewLeft+
this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2);m.updateModelView();this.last_render_tick=this.runtime.tickcount}};var g=[];n.TokeniseWords=function(m){cr.clearArray(g);for(var t="",D,z=0;z<m.length;)if(D=m.charAt(z),"\n"===D)t.length&&(g.push(t),t=""),g.push("\n"),++z;else if(" "===D||"\t"===D||"-"===D){do t+=m.charAt(z),z++;while(z<m.length&&(" "===m.charAt(z)||"\t"===m.charAt(z)));g.push(t);t=""}else z<m.length&&(t+=D,z++);t.length&&g.push(t)};var p=[];n.WordWrap=function(m,
t,D,z,G){if(m&&m.length)if(2>=z)k(t);else{if(100>=m.length&&-1===m.indexOf("\n")){var M=D.measureText(m).width;if(M<=z){k(t);t.push(b());t[0].text=m;t[0].width=M;return}}this.WrapText(m,t,D,z,G)}else k(t)};n.WrapText=function(m,t,D,z,G){G&&(this.TokeniseWords(m),m=g);var M="",l,r=0;for(l=0;l<m.length;l++)if("\n"===m[l]){r>=t.length&&t.push(b());M=v(M);var y=t[r];y.text=M;y.width=D.measureText(M).width;r++;M=""}else{var N=M;M+=m[l];y=D.measureText(v(M)).width;y>=z&&(r>=t.length&&t.push(b()),N=v(N),
y=t[r],y.text=N,y.width=D.measureText(N).width,r++,M=m[l],G||" "!==M||(M=""))}M.length&&(r>=t.length&&t.push(b()),M=v(M),y=t[r],y.text=M,y.width=D.measureText(M).width,r++);for(l=r;l<t.length;l++)p.push(t[l]);t.length=r};A.prototype.CompareText=function(m,t){return t?this.text==m:cr.equals_nocase(this.text,m)};n.cnds=new A;J.prototype.SetText=function(m){cr.is_number(m)&&1E9>m&&(m=Math.round(1E10*m)/1E10);m=m.toString();this.text!==m&&(this.text=m,this.text_changed=!0,this.runtime.redraw=!0)};J.prototype.AppendText=
function(m){cr.is_number(m)&&(m=Math.round(1E10*m)/1E10);if(m=m.toString())this.text+=m,this.text_changed=!0,this.runtime.redraw=!0};J.prototype.SetFontFace=function(m,t){var D=!1,z=!1;switch(t){case 1:D=!0;break;case 2:z=!0;break;case 3:z=D=!0}if(m!==this.facename||this.isBold!==D||this.isItalic!==z)this.facename=m,this.isBold=D,this.isItalic=z,this.updateFont()};J.prototype.SetFontSize=function(m){this.ptSize!==m&&(this.ptSize=m,this.updateFont())};J.prototype.SetFontColor=function(m){var t=cr.clamp(Math.floor(255*
cr.GetRValue(m)),0,255),D=cr.clamp(Math.floor(255*cr.GetGValue(m)),0,255);m=cr.clamp(Math.floor(255*cr.GetBValue(m)),0,255);t="rgb("+t+","+D+","+m+")";t!==this.color&&(this.color=t,this.need_text_redraw=!0,this.runtime.redraw=!0)};J.prototype.SetWebFont=function(m,t){var D=this,z=function(){D.runtime.redraw=!0;D.text_changed=!0};if(c.hasOwnProperty(t)){if(m="'"+m+"'",this.facename!==m)for(this.facename=m,this.updateFont(),m=1;10>m;m++)setTimeout(z,100*m),setTimeout(z,1E3*m)}else{var G=document.createElement("link");
G.href=t;G.rel="stylesheet";G.type="text/css";G.onload=z;document.getElementsByTagName("head")[0].appendChild(G);c[t]=!0;this.facename="'"+m+"'";this.updateFont();for(m=1;10>m;m++)setTimeout(z,100*m),setTimeout(z,1E3*m)}};J.prototype.SetEffect=function(m){this.blend_mode=m;this.compositeOp=cr.effectToCompositeOp(m);cr.setGLBlend(this,m,this.runtime.gl);this.runtime.redraw=!0};n.acts=new J;K.prototype.Text=function(m){m.set_string(this.text)};K.prototype.FaceName=function(m){m.set_string(this.facename)};
K.prototype.FaceSize=function(m){m.set_int(this.ptSize)};K.prototype.TextWidth=function(m){var t=0,D;var z=0;for(D=this.lines.length;z<D;z++){var G=this.lines[z].width;t<G&&(t=G)}m.set_int(t)};K.prototype.TextHeight=function(m){m.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)};n.exps=new K})();cr.plugins_.AJAX=function(b){this.runtime=b};
(function(){function b(){}function k(){}function v(){}var A=!1,J=null,K=null,n="",a=cr.plugins_.AJAX.prototype;a.Type=function(m){this.plugin=m;this.runtime=m.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(m){this.type=m;this.runtime=m.runtime;this.curTag=this.lastData="";this.progress=0;this.timeout=-1;if(A=this.runtime.isNWjs)J=require("path"),K=require("fs"),n=J.dirname((window.process||nw.process).execPath)+"\\"};var c=a.Instance.prototype;c.onCreate=function(){};c.saveToJSON=
function(){return{lastData:this.lastData}};c.loadFromJSON=function(m){this.lastData=m.lastData;this.curTag="";this.progress=0};var g={},p="";c.doRequest=function(m,t,D,z){var G=this,M=null,l=function(){G.curTag=m;G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,G);G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,G)},r=function(){if(A){var Q=n+t;K.existsSync(Q)?K.readFile(Q,{encoding:"utf8"},function(E,d){E?l():(G.curTag=m,G.lastData=d.replace(/\r\n/g,"\n"),G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,
G),G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,G))}):l()}else l()},y=function(Q){Q.lengthComputable&&(G.progress=Q.loaded/Q.total,G.curTag=m,G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,G))};try{M=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;M.onreadystatechange=function(){4===M.readyState&&(G.curTag=m,G.lastData=M.responseText?M.responseText.replace(/\r\n/g,"\n"):"",400<=M.status?(G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,
G),G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,G)):A&&!G.lastData.length||!A&&0===M.status&&!G.lastData.length||(G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,G),G.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,G)))};this.runtime.isWindowsPhone8||(M.onerror=r,M.ontimeout=r,M.onabort=r,M.onprogress=y);M.open(D,t);!this.runtime.isWindowsPhone8&&0<=this.timeout&&"undefined"!==typeof M.timeout&&(M.timeout=this.timeout);M.responseType="text";z&&M.setRequestHeader&&
!g.hasOwnProperty("Content-Type")&&M.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(M.setRequestHeader){for(var N in g)if(g.hasOwnProperty(N))try{M.setRequestHeader(N,g[N])}catch(Q){}g={}}if(p&&M.overrideMimeType){try{M.overrideMimeType(p)}catch(Q){}p=""}z?M.send(z):M.send()}catch(Q){r()}};b.prototype.OnComplete=function(m){return cr.equals_nocase(m,this.curTag)};b.prototype.OnAnyComplete=function(m){return!0};b.prototype.OnError=function(m){return cr.equals_nocase(m,this.curTag)};
b.prototype.OnAnyError=function(m){return!0};b.prototype.OnProgress=function(m){return cr.equals_nocase(m,this.curTag)};a.cnds=new b;k.prototype.Request=function(m,t){var D=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(z){D.curTag=m;D.lastData=z.replace(/\r\n/g,"\n");D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,D);D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,D)},function(z){D.curTag=m;D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,
D);D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,D)}):this.runtime.isPreview&&!this.runtime.isAbsoluteUrl(t)?this.doRequest(m,this.runtime.getLocalFileUrl(t),"GET"):this.doRequest(m,t,"GET")};k.prototype.RequestFile=function(m,t){var D=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(z){D.curTag=m;D.lastData=z.replace(/\r\n/g,"\n");D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,D);D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,
D)},function(z){D.curTag=m;D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,D);D.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,D)}):this.doRequest(m,this.runtime.getLocalFileUrl(t),"GET")};k.prototype.Post=function(m,t,D,z){this.doRequest(m,t,z,D)};k.prototype.SetTimeout=function(m){this.timeout=1E3*m};k.prototype.SetHeader=function(m,t){g[m]=t};k.prototype.OverrideMIMEType=function(m){p=m};a.acts=new k;v.prototype.LastData=function(m){m.set_string(this.lastData)};v.prototype.Progress=
function(m){m.set_float(this.progress)};v.prototype.Tag=function(m){m.set_string(this.curTag)};a.exps=new v})();cr.plugins_.Arr=function(b){this.runtime=b};
(function(){function b(){return c.length?c.pop():[]}function k(g){var p;var m=0;for(p=g.length;m<p;m++)Array.isArray(g[m])&&k(g[m]);cr.clearArray(g);c.push(g)}function v(){}function A(){}function J(g,p){if(cr.is_number(g)&&cr.is_number(p))return g-p;g=""+g;p=""+p;return g<p?-1:g>p?1:0}function K(){}var n=cr.plugins_.Arr.prototype;n.Type=function(g){this.plugin=g;this.runtime=g.runtime};n.Type.prototype.onCreate=function(){};n.Instance=function(g){this.type=g;this.runtime=g.runtime};var a=n.Instance.prototype,
c=[];Array.isArray||(Array.isArray=function(g){return"[object Array]"===Object.prototype.toString.call(g)});a.onCreate=function(){this.cx=this.properties[0];this.cy=this.properties[1];this.cz=this.properties[2];this.recycled||(this.arr=b());var g=this.arr;g.length=this.cx;var p,m,t;for(p=0;p<this.cx;p++)for(g[p]||(g[p]=b()),g[p].length=this.cy,m=0;m<this.cy;m++)for(g[p][m]||(g[p][m]=b()),g[p][m].length=this.cz,t=0;t<this.cz;t++)g[p][m][t]=0;this.forX=[];this.forY=[];this.forZ=[];this.forDepth=-1};
a.onDestroy=function(){var g;for(g=0;g<this.cx;g++)k(this.arr[g]);cr.clearArray(this.arr)};a.at=function(g,p,m){g=Math.floor(g);p=Math.floor(p);m=Math.floor(m);return isNaN(g)||0>g||g>this.cx-1||isNaN(p)||0>p||p>this.cy-1||isNaN(m)||0>m||m>this.cz-1?0:this.arr[g][p][m]};a.set=function(g,p,m,t){g=Math.floor(g);p=Math.floor(p);m=Math.floor(m);isNaN(g)||0>g||g>this.cx-1||isNaN(p)||0>p||p>this.cy-1||isNaN(m)||0>m||m>this.cz-1||(this.arr[g][p][m]=t)};a.getAsJSON=function(){return JSON.stringify({c2array:!0,
size:[this.cx,this.cy,this.cz],data:this.arr})};a.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}};a.loadFromJSON=function(g){var p=g.size;this.cx=p[0];this.cy=p[1];this.cz=p[2];this.arr=g.data};a.setSize=function(g,p,m){0>g&&(g=0);0>p&&(p=0);0>m&&(m=0);if(this.cx!==g||this.cy!==p||this.cz!==m){this.cx=g;this.cy=p;this.cz=m;var t,D,z=this.arr;z.length=g;for(g=0;g<this.cx;g++)for(cr.is_undefined(z[g])&&(z[g]=b()),z[g].length=p,t=0;t<this.cy;t++)for(cr.is_undefined(z[g][t])&&
(z[g][t]=b()),z[g][t].length=m,D=0;D<this.cz;D++)cr.is_undefined(z[g][t][D])&&(z[g][t][D]=0)}};a.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0};a.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0};a.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};v.prototype.CompareX=function(g,p,m){return cr.do_cmp(this.at(g,0,0),p,m)};v.prototype.CompareXY=
function(g,p,m,t){return cr.do_cmp(this.at(g,p,0),m,t)};v.prototype.CompareXYZ=function(g,p,m,t,D){return cr.do_cmp(this.at(g,p,m),t,D)};a.doForEachTrigger=function(g){this.runtime.pushCopySol(g.solModifiers);g.retrigger();this.runtime.popSol(g.solModifiers)};v.prototype.ArrForEach=function(g){var p=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var m=this.forDepth;m===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[m]=0,this.forY[m]=0,this.forZ[m]=
0);switch(g){case 0:for(this.forX[m]=0;this.forX[m]<this.cx;this.forX[m]++)for(this.forY[m]=0;this.forY[m]<this.cy;this.forY[m]++)for(this.forZ[m]=0;this.forZ[m]<this.cz;this.forZ[m]++)this.doForEachTrigger(p);break;case 1:for(this.forX[m]=0;this.forX[m]<this.cx;this.forX[m]++)for(this.forY[m]=0;this.forY[m]<this.cy;this.forY[m]++)this.doForEachTrigger(p);break;case 2:for(this.forX[m]=0;this.forX[m]<this.cx;this.forX[m]++)this.doForEachTrigger(p)}this.forDepth--;return!1};v.prototype.CompareCurrent=
function(g,p){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),g,p)};v.prototype.Contains=function(g){var p,m,t;for(p=0;p<this.cx;p++)for(m=0;m<this.cy;m++)for(t=0;t<this.cz;t++)if(this.arr[p][m][t]===g)return!0;return!1};v.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz};v.prototype.CompareSize=function(g,p,m){var t=0;switch(g){case 0:t=this.cx;break;case 1:t=this.cy;break;case 2:t=this.cz}return cr.do_cmp(t,p,m)};n.cnds=new v;A.prototype.Clear=function(g){var p,
m,t;for(p=0;p<this.cx;p++)for(m=0;m<this.cy;m++)for(t=0;t<this.cz;t++)this.arr[p][m][t]=g};A.prototype.SetSize=function(g,p,m){this.setSize(g,p,m)};A.prototype.SetX=function(g,p){this.set(g,0,0,p)};A.prototype.SetXY=function(g,p,m){this.set(g,p,0,m)};A.prototype.SetXYZ=function(g,p,m,t){this.set(g,p,m,t)};A.prototype.Push=function(g,p,m){var t=0,D=0,z=this.arr;switch(m){case 0:0===g?(t=z.length,z.push(b())):(t=0,z.unshift(b()));for(z[t].length=this.cy;D<this.cy;D++)for(z[t][D]=b(),z[t][D].length=
this.cz,m=0;m<this.cz;m++)z[t][D][m]=p;this.cx++;break;case 1:for(;t<this.cx;t++)for(0===g?(D=z[t].length,z[t].push(b())):(D=0,z[t].unshift(b())),z[t][D].length=this.cz,m=0;m<this.cz;m++)z[t][D][m]=p;this.cy++;break;case 2:for(;t<this.cx;t++)for(D=0;D<this.cy;D++)0===g?z[t][D].push(p):z[t][D].unshift(p);this.cz++}};A.prototype.Pop=function(g,p){var m=0,t=this.arr;switch(p){case 0:if(0===this.cx)break;0===g?k(t.pop()):k(t.shift());this.cx--;break;case 1:if(0===this.cy)break;for(;m<this.cx;m++)0===
g?k(t[m].pop()):k(t[m].shift());this.cy--;break;case 2:if(0!==this.cz){for(;m<this.cx;m++)for(p=0;p<this.cy;p++)0===g?t[m][p].pop():t[m][p].shift();this.cz--}}};A.prototype.Reverse=function(g){var p=0,m=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(g){case 0:m.reverse();break;case 1:for(;p<this.cx;p++)m[p].reverse();break;case 2:for(;p<this.cx;p++)for(g=0;g<this.cy;g++)m[p][g].reverse()}};A.prototype.Sort=function(g){var p=0,m=0,t=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(g){case 0:t.sort(function(D,
z){return J(D[0][0],z[0][0])});break;case 1:for(;p<this.cx;p++)t[p].sort(function(D,z){return J(D[0],z[0])});break;case 2:for(;p<this.cx;p++)for(m=0;m<this.cy;m++)t[p][m].sort(J)}};A.prototype.Delete=function(g,p){var m=0;g=Math.floor(g);var t=this.arr;if(!(0>g))switch(p){case 0:if(g>=this.cx)break;k(t[g]);t.splice(g,1);this.cx--;break;case 1:if(g>=this.cy)break;for(;m<this.cx;m++)k(t[m][g]),t[m].splice(g,1);this.cy--;break;case 2:if(!(g>=this.cz)){for(;m<this.cx;m++)for(p=0;p<this.cy;p++)t[m][p].splice(g,
1);this.cz--}}};A.prototype.Insert=function(g,p,m){var t=0,D=0;p=Math.floor(p);var z=this.arr;if(!(0>p))switch(m){case 0:if(p>this.cx)break;t=p;z.splice(t,0,b());for(z[t].length=this.cy;D<this.cy;D++)for(z[t][D]=b(),z[t][D].length=this.cz,m=0;m<this.cz;m++)z[t][D][m]=g;this.cx++;break;case 1:if(p>this.cy)break;for(;t<this.cx;t++)for(D=p,z[t].splice(D,0,b()),z[t][D].length=this.cz,m=0;m<this.cz;m++)z[t][D][m]=g;this.cy++;break;case 2:if(!(p>this.cz)){for(;t<this.cx;t++)for(D=0;D<this.cy;D++)z[t][D].splice(p,
0,g);this.cz++}}};A.prototype.JSONLoad=function(g){try{var p=JSON.parse(g)}catch(m){return}p.c2array&&(g=p.size,this.cx=g[0],this.cy=g[1],this.cz=g[2],this.arr=p.data)};A.prototype.JSONDownload=function(g){var p=document.createElement("a");if("undefined"===typeof p.download)g="data:text/html,"+encodeURIComponent("<p><a download='"+g+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>'),window.open(g);else{var m=document.getElementsByTagName("body")[0];p.textContent=
g;p.href="data:application/json,"+encodeURIComponent(this.getAsJSON());p.download=g;m.appendChild(p);p.click();m.removeChild(p)}};n.acts=new A;K.prototype.At=function(g,p,m,t){g.set_any(this.at(p,m||0,t||0))};K.prototype.Width=function(g){g.set_int(this.cx)};K.prototype.Height=function(g){g.set_int(this.cy)};K.prototype.Depth=function(g){g.set_int(this.cz)};K.prototype.CurX=function(g){g.set_int(this.getForX())};K.prototype.CurY=function(g){g.set_int(this.getForY())};K.prototype.CurZ=function(g){g.set_int(this.getForZ())};
K.prototype.CurValue=function(g){g.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))};K.prototype.Front=function(g){g.set_any(this.at(0,0,0))};K.prototype.Back=function(g){g.set_any(this.at(this.cx-1,0,0))};K.prototype.IndexOf=function(g,p){for(var m=0;m<this.cx;m++)if(this.arr[m][0][0]===p){g.set_int(m);return}g.set_int(-1)};K.prototype.LastIndexOf=function(g,p){for(var m=this.cx-1;0<=m;m--)if(this.arr[m][0][0]===p){g.set_int(m);return}g.set_int(-1)};K.prototype.AsJSON=function(g){g.set_string(this.getAsJSON())};
n.exps=new K})();cr.plugins_.Function=function(b){this.runtime=b};
(function(){function b(){this.name="";this.retVal=0;this.params=[]}function k(){c++;c===a.length&&a.push(new b);return a[c]}function v(){return 0>c?null:a[c]}function A(){}function J(){}function K(){}var n=cr.plugins_.Function.prototype;n.Type=function(g){this.plugin=g;this.runtime=g.runtime};n.Type.prototype.onCreate=function(){};n.Instance=function(g){this.type=g;this.runtime=g.runtime};var a=[],c=-1;n.Instance.prototype.onCreate=function(){var g=this;window.c2_callFunction=function(p,m){var t,
D=k();D.name=p.toLowerCase();D.retVal=0;if(m)for(D.params.length=m.length,p=0,t=m.length;p<t;++p){var z=m[p];D.params[p]="number"===typeof z||"string"===typeof z?z:"boolean"===typeof z?z?1:0:0}else cr.clearArray(D.params);g.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,g,D.name);c--;return D.retVal}};A.prototype.OnFunction=function(g){var p=v();return p?cr.equals_nocase(g,p.name):!1};A.prototype.CompareParam=function(g,p,m){var t=v();if(!t)return!1;g=cr.floor(g);var D=0;0<=g&&g<t.params.length&&
(D=t.params[g]);return cr.do_cmp(D,p,m)};n.cnds=new A;J.prototype.CallFunction=function(g,p){var m=k();m.name=g.toLowerCase();m.retVal=0;cr.shallowAssignArray(m.params,p);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,m.name);c--};J.prototype.SetReturnValue=function(g){var p=v();p&&(p.retVal=g)};J.prototype.CallExpression=function(g){};n.acts=new J;K.prototype.ReturnValue=function(g){if(a.length){var p=c+1;p>=a.length&&(p=a.length-1);p=a[p]}else p=null;p?g.set_any(p.retVal):
g.set_int(0)};K.prototype.ParamCount=function(g){var p=v();p?g.set_int(p.params.length):g.set_int(0)};K.prototype.Param=function(g,p){p=cr.floor(p);var m=v();m?0<=p&&p<m.params.length?g.set_any(m.params[p]):g.set_int(0):g.set_int(0)};K.prototype.Call=function(g,p){var m=k();m.name=p.toLowerCase();m.retVal=0;cr.clearArray(m.params);var t;var D=2;for(t=arguments.length;D<t;D++)m.params.push(arguments[D]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,m.name);c--;g.set_any(m.retVal)};
n.exps=new K})();cr.plugins_.Touch=function(b){this.runtime=b};
(function(){function b(l){g=l.x;p=l.y;m=l.z}function k(l,r,y,N){var Q=t.length?t.pop():new v;Q.init(l,r,y,N);return Q}function v(){this.startindex=this.id=this.lasty=this.lastx=this.y=this.x=this.starty=this.startx=this.lasttime=this.time=this.starttime=0;this.tooFarForHold=this.triggeredHold=!1}function A(l){return l.sourceCapabilities&&l.sourceCapabilities.firesTouchEvents||l.originalEvent&&l.originalEvent.sourceCapabilities&&l.originalEvent.sourceCapabilities.firesTouchEvents}function J(){}function K(){}
function n(){}var a=cr.plugins_.Touch.prototype;a.Type=function(l){this.plugin=l;this.runtime=l.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(l){this.type=l;this.runtime=l.runtime;this.touches=[];this.mouseDown=!1};var c=a.Instance.prototype;c.findTouch=function(l){var r;var y=0;for(r=this.touches.length;y<r;y++)if(this.touches[y].id===l)return y;return-1};var g=0,p=0,m=0,t=[];v.prototype.init=function(l,r,y,N){var Q=cr.performance_now();this.starttime=this.lasttime=this.time=
Q;this.startx=l;this.starty=r;this.x=l;this.y=r;this.lastx=l;this.lasty=r;this.pressure=this.height=this.width=0;this.id=y;this.startindex=N;this.tooFarForHold=this.triggeredHold=!1};v.prototype.update=function(l,r,y,N,Q,E){this.lasttime=this.time;this.time=l;this.lastx=this.x;this.lasty=this.y;this.x=r;this.y=y;this.width=N;this.height=Q;this.pressure=E;!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)};v.prototype.maybeTriggerHold=function(l,
r){!this.triggeredHold&&500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,l.trigger_index=this.startindex,l.trigger_id=this.id,l.getTouchIndex=r,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,l),l.getTouchIndex=0)};var D=-1E3,z=-1E3,G=-1E4;v.prototype.maybeTriggerTap=function(l,
r){if(!this.triggeredHold){var y=cr.performance_now();333>=y-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(l.trigger_index=this.startindex,l.trigger_id=this.id,l.getTouchIndex=r,666>=y-G&&25>cr.distanceTo(D,z,this.x,this.y)?(l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,l),z=D=-1E3,G=-1E4):(l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,
l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,l),D=this.x,z=this.y,G=y),l.getTouchIndex=0)}};c.onCreate=function(){this.isWindows8=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.getTouchIndex=this.trigger_permission=this.trigger_id=this.trigger_index=this.curTouchY=this.curTouchX=this.acc_z=this.acc_y=this.acc_x=this.acc_g_z=this.acc_g_y=this.acc_g_x=this.orient_gamma=this.orient_beta=this.orient_alpha=0;this.useMouseInput=
this.properties[0];var l=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,r=document,y=this;"undefined"!==typeof PointerEvent?(l.addEventListener("pointerdown",function(h){y.onPointerStart(h)},!1),l.addEventListener("pointermove",function(h){y.onPointerMove(h)},!1),r.addEventListener("pointerup",function(h){y.onPointerEnd(h,!1)},!1),r.addEventListener("pointercancel",function(h){y.onPointerEnd(h,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(h){h.preventDefault()},
!1),document.addEventListener("MSGestureHold",function(h){h.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(h){h.preventDefault()},!1),document.addEventListener("gesturehold",function(h){h.preventDefault()},!1))):window.navigator.msPointerEnabled?(l.addEventListener("MSPointerDown",function(h){y.onPointerStart(h)},!1),l.addEventListener("MSPointerMove",function(h){y.onPointerMove(h)},!1),r.addEventListener("MSPointerUp",function(h){y.onPointerEnd(h,!1)},!1),r.addEventListener("MSPointerCancel",
function(h){y.onPointerEnd(h,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(h){h.preventDefault()},!1),document.addEventListener("MSGestureHold",function(h){h.preventDefault()},!1))):(l.addEventListener("touchstart",function(h){y.onTouchStart(h)},!1),l.addEventListener("touchmove",function(h){y.onTouchMove(h)},!1),r.addEventListener("touchend",function(h){y.onTouchEnd(h,!1)},!1),r.addEventListener("touchcancel",function(h){y.onTouchEnd(h,!0)},!1));if(this.isWindows8){var N=
function(h){h=h.reading;y.acc_x=h.accelerationX;y.acc_y=h.accelerationY;y.acc_z=h.accelerationZ},Q=function(h){h=h.reading;y.orient_alpha=h.yawDegrees;y.orient_beta=h.pitchDegrees;y.orient_gamma=h.rollDegrees},E=Windows.Devices.Sensors.Accelerometer.getDefault();E&&(E.reportInterval=Math.max(E.minimumReportInterval,16),E.addEventListener("readingchanged",N));var d=Windows.Devices.Sensors.Inclinometer.getDefault();d&&(d.reportInterval=Math.max(d.minimumReportInterval,16),d.addEventListener("readingchanged",
Q));document.addEventListener("visibilitychange",function(h){document.hidden||document.msHidden?(E&&E.removeEventListener("readingchanged",N),d&&d.removeEventListener("readingchanged",Q)):(E&&E.addEventListener("readingchanged",N),d&&d.addEventListener("readingchanged",Q))},!1)}else window.addEventListener("deviceorientation",function(h){y.orient_alpha=h.alpha||0;y.orient_beta=h.beta||0;y.orient_gamma=h.gamma||0},!1),window.addEventListener("devicemotion",function(h){h.accelerationIncludingGravity&&
(y.acc_g_x=h.accelerationIncludingGravity.x||0,y.acc_g_y=h.accelerationIncludingGravity.y||0,y.acc_g_z=h.accelerationIncludingGravity.z||0);h.acceleration&&(y.acc_x=h.acceleration.x||0,y.acc_y=h.acceleration.y||0,y.acc_z=h.acceleration.z||0)},!1);this.useMouseInput&&(document.addEventListener("mousemove",function(h){y.onMouseMove(h)}),document.addEventListener("mousedown",function(h){y.onMouseDown(h)}),document.addEventListener("mouseup",function(h){y.onMouseUp(h)}));!this.runtime.isiOS&&this.runtime.isCordova&&
navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(b,null,{frequency:40});this.runtime.tick2Me(this)};c.onPointerMove=function(l){if(l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType){l.preventDefault&&l.preventDefault();var r=this.findTouch(l.pointerId),y=cr.performance_now();0<=r&&(r=this.touches[r],2>y-r.time||r.update(y,l.pageX-this.runtime.canvas.offsetLeft,l.pageY-this.runtime.canvas.offsetTop,l.width||0,l.height||0,l.pressure||
0))}};c.onPointerStart=function(l){if(l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType&&-1===this.findTouch(l.pointerId)){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();var r=l.pageX-this.runtime.canvas.offsetLeft,y=l.pageY-this.runtime.canvas.offsetTop;cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=l.pointerId;this.touches.push(k(r,y,l.pointerId,this.trigger_index));this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,
this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=r;this.curTouchY=y;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=!1}};c.onPointerEnd=function(l,r){l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType&&(l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault(),l=this.findTouch(l.pointerId),this.trigger_index=0<=l?this.touches[l].startindex:-1,this.trigger_id=0<=l?this.touches[l].id:
-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=l&&(r||this.touches[l].maybeTriggerTap(this,l),100>t.length&&t.push(this.touches[l]),this.touches.splice(l,1)),this.runtime.isInUserInputEvent=!1)};c.onTouchMove=function(l){l.preventDefault&&l.preventDefault();var r=cr.performance_now(),y;var N=0;for(y=l.changedTouches.length;N<y;N++){var Q=l.changedTouches[N];var E=
this.findTouch(Q.identifier);if(0<=E){var d=this.runtime.canvas.offsetLeft,h=this.runtime.canvas.offsetTop;E=this.touches[E];2>r-E.time||E.update(r,Q.pageX-d,Q.pageY-h,2*(Q.radiusX||Q.webkitRadiusX||Q.mozRadiusX||Q.msRadiusX||0),2*(Q.radiusY||Q.webkitRadiusY||Q.mozRadiusY||Q.msRadiusY||0),Q.force||Q.webkitForce||Q.mozForce||Q.msForce||0)}}};c.onTouchStart=function(l){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();var r=this.runtime.canvas.offsetLeft,y=this.runtime.canvas.offsetTop;
cr.performance_now();this.runtime.isInUserInputEvent=!0;var N;var Q=0;for(N=l.changedTouches.length;Q<N;Q++){var E=l.changedTouches[Q];var d=this.findTouch(E.identifier);if(-1===d){d=E.pageX-r;var h=E.pageY-y;this.trigger_index=this.touches.length;this.trigger_id=E.identifier;this.touches.push(k(d,h,E.identifier,this.trigger_index));this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=d;
this.curTouchY=h;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}}this.runtime.isInUserInputEvent=!1};c.onTouchEnd=function(l,r){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();this.runtime.isInUserInputEvent=!0;var y;var N=0;for(y=l.changedTouches.length;N<y;N++){var Q=l.changedTouches[N];Q=this.findTouch(Q.identifier);0<=Q&&(this.trigger_index=this.touches[Q].startindex,this.trigger_id=this.touches[Q].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,
this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),r||this.touches[Q].maybeTriggerTap(this,Q),100>t.length&&t.push(this.touches[Q]),this.touches.splice(Q,1))}this.runtime.isInUserInputEvent=!1};c.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==m?90*m:this.orient_alpha};c.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==p?90*p:this.orient_beta};c.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&
0!==g?90*g:this.orient_gamma};c.onMouseDown=function(l){A(l)||(this.onTouchStart({changedTouches:[{pageX:l.pageX,pageY:l.pageY,identifier:0}]}),this.mouseDown=!0)};c.onMouseMove=function(l){if(this.mouseDown&&!A(l))this.onTouchMove({changedTouches:[{pageX:l.pageX,pageY:l.pageY,identifier:0}]})};c.onMouseUp=function(l){l.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&l.preventDefault();this.runtime.had_a_click=!0;A(l)||(this.onTouchEnd({changedTouches:[{pageX:l.pageX,pageY:l.pageY,
identifier:0}]}),this.mouseDown=!1)};c.isClientPosOverCanvas=function(l,r){return 0<=l&&0<=r&&l<this.runtime.width&&r<this.runtime.height};c.tick2=function(){var l,r=cr.performance_now();var y=0;for(l=this.touches.length;y<l;++y){var N=this.touches[y];N.time<=r-50&&(N.lasttime=r);N.maybeTriggerHold(this,y)}};J.prototype.OnTouchStart=function(){return!0};J.prototype.OnTouchEnd=function(){return!0};J.prototype.IsInTouch=function(){return this.touches.length};J.prototype.OnTouchObject=function(l){return l&&
this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};var M=[];J.prototype.IsTouchingObject=function(l){if(!l)return!1;var r=l.getCurrentSol(),y=r.getObjects(),N,Q;var E=0;for(N=y.length;E<N;E++){var d=y[E];d.update_bbox();var h=0;for(Q=this.touches.length;h<Q;h++){var B=this.touches[h];if(this.isClientPosOverCanvas(B.x,B.y)){var e=d.layer.canvasToLayer(B.x,B.y,!0);B=d.layer.canvasToLayer(B.x,B.y,!1);if(d.contains_pt(e,
B)){M.push(d);break}}}}return M.length?(r.select_all=!1,cr.shallowAssignArray(r.instances,M),l.applySolToContainer(),cr.clearArray(M),!0):!1};J.prototype.CompareTouchSpeed=function(l,r,y){l=Math.floor(l);if(0>l||l>=this.touches.length)return!1;var N=this.touches[l];l=cr.distanceTo(N.x,N.y,N.lastx,N.lasty);N=(N.time-N.lasttime)/1E3;var Q=0;0<N&&(Q=l/N);return cr.do_cmp(Q,r,y)};J.prototype.OrientationSupported=function(){return"undefined"!==typeof window.DeviceOrientationEvent};J.prototype.MotionSupported=
function(){return"undefined"!==typeof window.DeviceMotionEvent};J.prototype.CompareOrientation=function(l,r,y){l=0===l?this.getAlpha():1===l?this.getBeta():this.getGamma();return cr.do_cmp(l,r,y)};J.prototype.CompareAcceleration=function(l,r,y){var N=0;0===l?N=this.acc_g_x:1===l?N=this.acc_g_y:2===l?N=this.acc_g_z:3===l?N=this.acc_x:4===l?N=this.acc_y:5===l&&(N=this.acc_z);return cr.do_cmp(N,r,y)};J.prototype.OnNthTouchStart=function(l){l=Math.floor(l);return l===this.trigger_index};J.prototype.OnNthTouchEnd=
function(l){l=Math.floor(l);return l===this.trigger_index};J.prototype.HasNthTouch=function(l){l=Math.floor(l);return this.touches.length>=l+1};J.prototype.OnHoldGesture=function(){return!0};J.prototype.OnTapGesture=function(){return!0};J.prototype.OnDoubleTapGesture=function(){return!0};J.prototype.OnHoldGestureObject=function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};J.prototype.OnTapGestureObject=
function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};J.prototype.OnDoubleTapGestureObject=function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};J.prototype.OnPermissionGranted=function(l){return this.trigger_permission===l};J.prototype.OnPermissionDenied=function(l){return this.trigger_permission===
l};a.cnds=new J;K.prototype.RequestPermission=function(l){var r=this,y=Promise.resolve(!0);0===l?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(y=window.DeviceOrientationEvent.requestPermission().then(function(N){return"granted"===N})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(y=window.DeviceMotionEvent.requestPermission().then(function(N){return"granted"===N}));y.then(function(N){r.trigger_permission=l;N?r.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,
r):r.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,r)})};a.acts=new K;n.prototype.TouchCount=function(l){l.set_int(this.touches.length)};n.prototype.X=function(l,r){var y=this.getTouchIndex;if(0>y||y>=this.touches.length)l.set_float(0);else if(cr.is_undefined(r)){r=this.runtime.getLayerByNumber(0);var N=r.scale;var Q=r.zoomRate;var E=r.parallaxX;var d=r.angle;r.scale=1;r.zoomRate=1;r.parallaxX=1;r.angle=0;l.set_float(r.canvasToLayer(this.touches[y].x,this.touches[y].y,!0));r.scale=
N;r.zoomRate=Q;r.parallaxX=E;r.angle=d}else(r=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r))?l.set_float(r.canvasToLayer(this.touches[y].x,this.touches[y].y,!0)):l.set_float(0)};n.prototype.XAt=function(l,r,y){r=Math.floor(r);if(0>r||r>=this.touches.length)l.set_float(0);else if(cr.is_undefined(y)){y=this.runtime.getLayerByNumber(0);var N=y.scale;var Q=y.zoomRate;var E=y.parallaxX;var d=y.angle;y.scale=1;y.zoomRate=1;y.parallaxX=1;y.angle=0;l.set_float(y.canvasToLayer(this.touches[r].x,
this.touches[r].y,!0));y.scale=N;y.zoomRate=Q;y.parallaxX=E;y.angle=d}else(y=cr.is_number(y)?this.runtime.getLayerByNumber(y):this.runtime.getLayerByName(y))?l.set_float(y.canvasToLayer(this.touches[r].x,this.touches[r].y,!0)):l.set_float(0)};n.prototype.XForID=function(l,r,y){r=this.findTouch(r);if(0>r)l.set_float(0);else if(r=this.touches[r],cr.is_undefined(y)){y=this.runtime.getLayerByNumber(0);var N=y.scale;var Q=y.zoomRate;var E=y.parallaxX;var d=y.angle;y.scale=1;y.zoomRate=1;y.parallaxX=1;
y.angle=0;l.set_float(y.canvasToLayer(r.x,r.y,!0));y.scale=N;y.zoomRate=Q;y.parallaxX=E;y.angle=d}else(y=cr.is_number(y)?this.runtime.getLayerByNumber(y):this.runtime.getLayerByName(y))?l.set_float(y.canvasToLayer(r.x,r.y,!0)):l.set_float(0)};n.prototype.Y=function(l,r){var y=this.getTouchIndex;if(0>y||y>=this.touches.length)l.set_float(0);else if(cr.is_undefined(r)){r=this.runtime.getLayerByNumber(0);var N=r.scale;var Q=r.zoomRate;var E=r.parallaxY;var d=r.angle;r.scale=1;r.zoomRate=1;r.parallaxY=
1;r.angle=0;l.set_float(r.canvasToLayer(this.touches[y].x,this.touches[y].y,!1));r.scale=N;r.zoomRate=Q;r.parallaxY=E;r.angle=d}else(r=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r))?l.set_float(r.canvasToLayer(this.touches[y].x,this.touches[y].y,!1)):l.set_float(0)};n.prototype.YAt=function(l,r,y){r=Math.floor(r);if(0>r||r>=this.touches.length)l.set_float(0);else if(cr.is_undefined(y)){y=this.runtime.getLayerByNumber(0);var N=y.scale;var Q=y.zoomRate;var E=y.parallaxY;
var d=y.angle;y.scale=1;y.zoomRate=1;y.parallaxY=1;y.angle=0;l.set_float(y.canvasToLayer(this.touches[r].x,this.touches[r].y,!1));y.scale=N;y.zoomRate=Q;y.parallaxY=E;y.angle=d}else(y=cr.is_number(y)?this.runtime.getLayerByNumber(y):this.runtime.getLayerByName(y))?l.set_float(y.canvasToLayer(this.touches[r].x,this.touches[r].y,!1)):l.set_float(0)};n.prototype.YForID=function(l,r,y){r=this.findTouch(r);if(0>r)l.set_float(0);else if(r=this.touches[r],cr.is_undefined(y)){y=this.runtime.getLayerByNumber(0);
var N=y.scale;var Q=y.zoomRate;var E=y.parallaxY;var d=y.angle;y.scale=1;y.zoomRate=1;y.parallaxY=1;y.angle=0;l.set_float(y.canvasToLayer(r.x,r.y,!1));y.scale=N;y.zoomRate=Q;y.parallaxY=E;y.angle=d}else(y=cr.is_number(y)?this.runtime.getLayerByNumber(y):this.runtime.getLayerByName(y))?l.set_float(y.canvasToLayer(r.x,r.y,!1)):l.set_float(0)};n.prototype.AbsoluteX=function(l){this.touches.length?l.set_float(this.touches[0].x):l.set_float(0)};n.prototype.AbsoluteXAt=function(l,r){r=Math.floor(r);0>r||
r>=this.touches.length?l.set_float(0):l.set_float(this.touches[r].x)};n.prototype.AbsoluteXForID=function(l,r){r=this.findTouch(r);0>r?l.set_float(0):l.set_float(this.touches[r].x)};n.prototype.AbsoluteY=function(l){this.touches.length?l.set_float(this.touches[0].y):l.set_float(0)};n.prototype.AbsoluteYAt=function(l,r){r=Math.floor(r);0>r||r>=this.touches.length?l.set_float(0):l.set_float(this.touches[r].y)};n.prototype.AbsoluteYForID=function(l,r){r=this.findTouch(r);0>r?l.set_float(0):l.set_float(this.touches[r].y)};
n.prototype.SpeedAt=function(l,r){r=Math.floor(r);if(0>r||r>=this.touches.length)l.set_float(0);else{var y=this.touches[r];r=cr.distanceTo(y.x,y.y,y.lastx,y.lasty);y=(y.time-y.lasttime)/1E3;0>=y?l.set_float(0):l.set_float(r/y)}};n.prototype.SpeedForID=function(l,r){r=this.findTouch(r);if(0>r)l.set_float(0);else{var y=this.touches[r];r=cr.distanceTo(y.x,y.y,y.lastx,y.lasty);y=(y.time-y.lasttime)/1E3;0>=y?l.set_float(0):l.set_float(r/y)}};n.prototype.AngleAt=function(l,r){r=Math.floor(r);0>r||r>=this.touches.length?
l.set_float(0):(r=this.touches[r],l.set_float(cr.to_degrees(cr.angleTo(r.lastx,r.lasty,r.x,r.y))))};n.prototype.AngleForID=function(l,r){r=this.findTouch(r);0>r?l.set_float(0):(r=this.touches[r],l.set_float(cr.to_degrees(cr.angleTo(r.lastx,r.lasty,r.x,r.y))))};n.prototype.Alpha=function(l){l.set_float(this.getAlpha())};n.prototype.Beta=function(l){l.set_float(this.getBeta())};n.prototype.Gamma=function(l){l.set_float(this.getGamma())};n.prototype.AccelerationXWithG=function(l){l.set_float(this.acc_g_x)};
n.prototype.AccelerationYWithG=function(l){l.set_float(this.acc_g_y)};n.prototype.AccelerationZWithG=function(l){l.set_float(this.acc_g_z)};n.prototype.AccelerationX=function(l){l.set_float(this.acc_x)};n.prototype.AccelerationY=function(l){l.set_float(this.acc_y)};n.prototype.AccelerationZ=function(l){l.set_float(this.acc_z)};n.prototype.TouchIndex=function(l){l.set_int(this.trigger_index)};n.prototype.TouchID=function(l){l.set_float(this.trigger_id)};n.prototype.WidthForID=function(l,r){r=this.findTouch(r);
0>r?l.set_float(0):l.set_float(this.touches[r].width)};n.prototype.HeightForID=function(l,r){r=this.findTouch(r);0>r?l.set_float(0):l.set_float(this.touches[r].height)};n.prototype.PressureForID=function(l,r){r=this.findTouch(r);0>r?l.set_float(0):l.set_float(this.touches[r].pressure)};a.exps=new n})();cr.plugins_.WebStorage=function(b){this.runtime=b};
(function(){function b(){}function k(){}function v(){}var A=cr.plugins_.WebStorage.prototype;A.Type=function(c){this.plugin=c;this.runtime=c.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(c){this.type=c;this.runtime=c.runtime};var J=A.Instance.prototype,K="",n="undefined"!==typeof window.is_scirra_arcade;n&&(K="arcade"+window.scirra_arcade_id);var a=!1;try{localStorage.getItem("test"),a=!0}catch(c){a=!1}J.onCreate=function(){a||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")};
b.prototype.LocalStorageEnabled=function(){return a};b.prototype.SessionStorageEnabled=function(){return a};b.prototype.LocalStorageExists=function(c){return a?null!=localStorage.getItem(K+c):!1};b.prototype.SessionStorageExists=function(c){return a?null!=sessionStorage.getItem(K+c):!1};b.prototype.OnQuotaExceeded=function(){return!0};b.prototype.CompareKeyText=function(c,g,p){if(!a)return!1;c=localStorage.getItem(K+c)||"";return p?c==g:cr.equals_nocase(c,g)};b.prototype.CompareKeyNumber=function(c,
g,p){if(!a)return!1;c=localStorage.getItem(K+c)||"";return cr.do_cmp(parseFloat(c),g,p)};A.cnds=new b;k.prototype.StoreLocal=function(c,g){if(a)try{localStorage.setItem(K+c,g)}catch(p){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};k.prototype.StoreSession=function(c,g){if(a)try{sessionStorage.setItem(K+c,g)}catch(p){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};k.prototype.RemoveLocal=function(c){a&&localStorage.removeItem(K+
c)};k.prototype.RemoveSession=function(c){a&&sessionStorage.removeItem(K+c)};k.prototype.ClearLocal=function(){a&&(n||localStorage.clear())};k.prototype.ClearSession=function(){a&&(n||sessionStorage.clear())};k.prototype.JSONLoad=function(c,g){if(a){try{var p=JSON.parse(c)}catch(t){return}if(p.c2dictionary){c=p.data;0!==g||n||localStorage.clear();for(var m in c)if(c.hasOwnProperty(m))try{localStorage.setItem(K+m,c[m])}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,
this);break}}}};A.acts=new k;v.prototype.LocalValue=function(c,g){a?c.set_string(localStorage.getItem(K+g)||""):c.set_string("")};v.prototype.SessionValue=function(c,g){a?c.set_string(sessionStorage.getItem(K+g)||""):c.set_string("")};v.prototype.LocalCount=function(c){a?c.set_int(n?0:localStorage.length):c.set_int(0)};v.prototype.SessionCount=function(c){a?c.set_int(n?0:sessionStorage.length):c.set_int(0)};v.prototype.LocalAt=function(c,g){n||!a?c.set_string(""):c.set_string(localStorage.getItem(localStorage.key(g))||
"")};v.prototype.SessionAt=function(c,g){n||!a?c.set_string(""):c.set_string(sessionStorage.getItem(sessionStorage.key(g))||"")};v.prototype.LocalKeyAt=function(c,g){n||!a?c.set_string(""):c.set_string(localStorage.key(g)||"")};v.prototype.SessionKeyAt=function(c,g){n||!a?c.set_string(""):c.set_string(sessionStorage.key(g)||"")};v.prototype.AsJSON=function(c){if(a){var g={},p;var m=0;for(p=localStorage.length;m<p;m++){var t=localStorage.key(m);n?t.substr(0,K.length)===K&&(g[t.substr(K.length)]=localStorage.getItem(t)):
g[t]=localStorage.getItem(t)}c.set_string(JSON.stringify({c2dictionary:!0,data:g}))}else c.set_string("")};A.exps=new v})();cr.plugins_.TiledBg=function(b){this.runtime=b};
(function(){function b(){}function k(){}function v(){}var A=cr.plugins_.TiledBg.prototype;A.Type=function(K){this.plugin=K;this.runtime=K.runtime};var J=A.Type.prototype;J.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,
this.texture_file)),this.webGL_texture=this.pattern=null)};J.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};J.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));var K;var n=0;for(K=this.instances.length;n<K;n++)this.instances[n].webGL_texture=this.webGL_texture}};J.loadTextures=function(){this.is_family||
this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};J.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};J.preloadCanvas2D=function(K){K.drawImage(this.texture_img,0,0)};A.Instance=function(K){this.type=K;this.runtime=K.runtime};J=A.Instance.prototype;J.onCreate=function(){this.visible=
this.properties[0];this.rcTex=new cr.rect(0,0,0,0);this.has_own_texture=!1;this.texture_img=this.type.texture_img;this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)};J.afterLoad=function(){this.has_own_texture=!1;this.texture_img=this.type.texture_img};J.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&
(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};J.draw=function(K){K.globalAlpha=this.opacity;K.save();K.fillStyle=this.pattern;var n=this.x,a=this.y;this.runtime.pixel_rounding&&(n=Math.round(n),a=Math.round(a));var c=-(this.hotspotX*this.width),g=-(this.hotspotY*this.height),p=c%this.texture_img.width,m=g%this.texture_img.height;0>p&&(p+=this.texture_img.width);0>m&&(m+=this.texture_img.height);K.translate(n,a);K.rotate(this.angle);K.translate(p,m);K.fillRect(c-
p,g-m,this.width,this.height);K.restore()};J.drawGL_earlyZPass=function(K){this.drawGL(K)};J.drawGL=function(K){K.setTexture(this.webGL_texture);K.setOpacity(this.opacity);var n=this.rcTex;n.right=this.width/this.texture_img.width;n.bottom=this.height/this.texture_img.height;var a=this.bquad;if(this.runtime.pixel_rounding){var c=Math.round(this.x)-this.x,g=Math.round(this.y)-this.y;K.quadTex(a.tlx+c,a.tly+g,a.trx+c,a.try_+g,a.brx+c,a.bry+g,a.blx+c,a.bly+g,n)}else K.quadTex(a.tlx,a.tly,a.trx,a.try_,
a.brx,a.bry,a.blx,a.bly,n)};b.prototype.OnURLLoaded=function(){return!0};A.cnds=new b;k.prototype.SetEffect=function(K){this.blend_mode=K;this.compositeOp=cr.effectToCompositeOp(K);cr.setGLBlend(this,K,this.runtime.gl);this.runtime.redraw=!0};k.prototype.LoadURL=function(K,n){var a=new Image,c=this;a.onload=function(){c.texture_img=a;c.runtime.glwrap?(c.has_own_texture&&c.webGL_texture&&c.runtime.glwrap.deleteTexture(c.webGL_texture),c.webGL_texture=c.runtime.glwrap.loadTexture(a,!0,c.runtime.linearSampling)):
c.pattern=c.runtime.ctx.createPattern(a,"repeat");c.has_own_texture=!0;c.runtime.redraw=!0;c.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,c)};"data:"!==K.substr(0,5)&&0===n&&(a.crossOrigin="anonymous");this.runtime.setImageSrc(a,K)};A.acts=new k;v.prototype.ImageWidth=function(K){K.set_float(this.texture_img.width)};v.prototype.ImageHeight=function(K){K.set_float(this.texture_img.height)};A.exps=new v})();cr.plugins_.Sprite=function(b){this.runtime=b};
(function(){function b(){if(0===this.datauri.length){var E=document.createElement("canvas");E.width=this.width;E.height=this.height;var d=E.getContext("2d");this.spritesheeted?d.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):d.drawImage(this.texture_img,0,0,this.width,this.height);this.datauri=E.toDataURL("image/png")}return this.datauri}function k(){}function v(E){E[0]=0;E[1]=0;E[2]=0;z.push(E)}function A(E,d){return E<d?""+E+","+d:""+d+","+E}function J(E,
d,h,B){d=d.uid;h=h.uid;var e=A(d,h);if(E.hasOwnProperty(e))E[e][2]=B;else{var u=z.length?z.pop():[0,0,0];u[0]=d;u[1]=h;u[2]=B;E[e]=u}}function K(E,d,h){d=A(d.uid,h.uid);E.hasOwnProperty(d)&&(v(E[d]),delete E[d])}function n(E,d,h){d=A(d.uid,h.uid);if(E.hasOwnProperty(d))return G=E[d][2],!0;G=-2;return!1}function a(E,d,h){if(!E)return!1;var B=0!==d||0!==h,e=!1,u=this.runtime.getCurrentCondition(),F=u.type;u=u.inverted;var H=E.getCurrentSol();var R=this.runtime.getCurrentEventStack().current_event.orblock;
H.select_all?(this.update_bbox(),Q.copy(this.bbox),Q.offset(d,h),this.runtime.getCollisionCandidates(this.layer,E,Q,N),H=N):H=R?this.runtime.isCurrentConditionFirst()&&!H.else_instances.length&&H.instances.length?H.instances:H.else_instances:H.instances;l=E;y=F!==E&&!u;if(B){var S=this.x;var V=this.y;this.x+=d;this.y+=h;this.set_bbox_changed()}d=0;for(h=H.length;d<h;d++)if(R=H[d],this.runtime.testOverlap(this,R)){e=!0;if(u)break;F!==E&&r.add(R)}B&&(this.x=S,this.y=V,this.set_bbox_changed());cr.clearArray(N);
return e}function c(){}function g(){}var p=cr.plugins_.Sprite.prototype;p.Type=function(E){this.plugin=E;this.runtime=E.runtime};var m=p.Type.prototype;m.onCreate=function(){if(!this.is_family){var E,d;this.all_frames=[];this.has_loaded_textures=!1;var h=0;for(E=this.animations.length;h<E;h++){var B=this.animations[h];var e={};e.name=B[0];e.speed=B[1];e.loop=B[2];e.repeatcount=B[3];e.repeatto=B[4];e.pingpong=B[5];e.sid=B[6];e.frames=[];var u=0;for(d=B[7].length;u<d;u++){var F=B[7][u];var H={};H.texture_file=
F[0];H.texture_filesize=F[1];H.offx=F[2];H.offy=F[3];H.width=F[4];H.height=F[5];H.duration=F[6];H.hotspotX=F[7];H.hotspotY=F[8];H.image_points=F[9];H.poly_pts=F[10];H.pixelformat=F[11];H.spritesheeted=0!==H.width;H.datauri="";H.getDataUri=b;var R={left:0,top:0,right:1,bottom:1};H.sheetTex=R;H.webGL_texture=null;(R=this.runtime.findWaitingTexture(F[0]))?H.texture_img=R:(H.texture_img=new Image,H.texture_img.cr_src=F[0],H.texture_img.cr_filesize=F[1],H.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(H.texture_img,
F[0]));cr.seal(H);e.frames.push(H);this.all_frames.push(H)}cr.seal(e);this.animations[h]=e}}};m.updateAllCurrentTexture=function(){var E;var d=0;for(E=this.instances.length;d<E;d++){var h=this.instances[d];h.curWebGLTexture=h.curFrame.webGL_texture}};m.onLostWebGLContext=function(){if(!this.is_family){var E;var d=0;for(E=this.all_frames.length;d<E;++d){var h=this.all_frames[d];h.texture_img.c2webGL_texture=null;h.webGL_texture=null}this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};m.onRestoreWebGLContext=
function(){if(!this.is_family&&this.instances.length){var E;var d=0;for(E=this.all_frames.length;d<E;++d){var h=this.all_frames[d];h.webGL_texture=this.runtime.glwrap.loadTexture(h.texture_img,!1,this.runtime.linearSampling,h.pixelformat)}this.updateAllCurrentTexture()}};m.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var E;var d=0;for(E=this.all_frames.length;d<E;++d){var h=this.all_frames[d];h.webGL_texture=this.runtime.glwrap.loadTexture(h.texture_img,
!1,this.runtime.linearSampling,h.pixelformat)}this.has_loaded_textures=!0}};m.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var E;var d=0;for(E=this.all_frames.length;d<E;++d){var h=this.all_frames[d];this.runtime.glwrap.deleteTexture(h.webGL_texture);h.webGL_texture=null}this.has_loaded_textures=!1}};var t=[];m.preloadCanvas2D=function(E){var d;cr.clearArray(t);var h=0;for(d=this.all_frames.length;h<d;++h){var B=this.all_frames[h].texture_img;-1===
t.indexOf(B)&&(E.drawImage(B,0,0),t.push(B))}};p.Instance=function(E){this.type=E;this.runtime=E.runtime;E=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(E):this.collision_poly=new cr.CollisionPoly(E)};var D=p.Instance.prototype;D.onCreate=function(){this.visible=this.properties[0];this.inAnimTrigger=this.isTicking=!1;this.collisionsEnabled=this.properties[3];this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=
this.properties[2];0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var E=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(E.poly_pts);this.hotspotX=E.hotspotX;this.hotspotY=E.hotspotY;this.animForwards=0<=this.cur_animation.speed;this.cur_anim_speed=Math.abs(this.cur_animation.speed);this.cur_anim_repeatto=this.cur_animation.repeatto;1===this.type.animations.length&&1===this.type.animations[0].frames.length||
0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0);this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder;this.frameStart=this.getNowTime();this.animPlaying=!0;this.animRepeats=0;this.changeAnimName=this.animTriggerName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var d,h;E=0;for(d=this.type.animations.length;E<d;E++){var B=this.type.animations[E];var e=0;for(h=B.frames.length;e<h;e++){var u=B.frames[e];0===u.width&&(u.width=u.texture_img.width,
u.height=u.texture_img.height);if(u.spritesheeted){var F=u.texture_img;var H=u.sheetTex;H.left=u.offx/F.width;H.top=u.offy/F.height;H.right=(u.offx+u.width)/F.width;H.bottom=(u.offy+u.height)/F.height;0===u.offx&&0===u.offy&&u.width===F.width&&u.height===F.height&&(u.spritesheeted=!1)}}}this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};D.saveToJSON=function(){var E={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,
ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};this.animPlaying||(E.ap=this.animPlaying);this.animForwards||(E.af=this.animForwards);return E};D.loadFromJSON=function(E){var d=this.getAnimationBySid(E.a);d&&(this.cur_animation=d);this.cur_frame=E.f;0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=E.cas;this.frameStart=E.fs;this.animRepeats=E.ar;this.animTimer.reset();
this.animTimer.sum=E.at;this.animPlaying=E.hasOwnProperty("ap")?E.ap:!0;this.animForwards=E.hasOwnProperty("af")?E.af:!0;E.hasOwnProperty("rt")?this.cur_anim_repeatto=E.rt:this.cur_anim_repeatto=this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};D.animationFinish=function(E){this.cur_frame=E?
0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};D.getNowTime=function(){return this.animTimer.sum};D.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();0<=this.changeAnimFrame&&
this.doChangeAnimFrame();var E=this.getNowTime(),d=this.cur_animation,h=d.frames[this.cur_frame],B=h.duration/this.cur_anim_speed;this.animPlaying&&E>=this.frameStart+B&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=B,this.cur_frame>=d.frames.length&&(d.pingpong?(this.animForwards=!1,this.cur_frame=d.frames.length-2):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),
0>this.cur_frame&&(d.pingpong?(this.cur_frame=1,this.animForwards=!0,d.loop||(this.animRepeats++,this.animRepeats>=d.repeatcount&&this.animationFinish(!0))):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=d.frames.length&&(this.cur_frame=d.frames.length-1),E>this.frameStart+d.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=
E),E=d.frames[this.cur_frame],this.OnFrameChanged(h,E),this.runtime.redraw=!0)};D.getAnimationByName=function(E){var d;var h=0;for(d=this.type.animations.length;h<d;h++){var B=this.type.animations[h];if(cr.equals_nocase(B.name,E))return B}return null};D.getAnimationBySid=function(E){var d;var h=0;for(d=this.type.animations.length;h<d;h++){var B=this.type.animations[h];if(B.sid===E)return B}return null};D.doChangeAnim=function(){var E=this.cur_animation.frames[this.cur_frame],d=this.getAnimationByName(this.changeAnimName);
this.changeAnimName="";!d||cr.equals_nocase(d.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=d,this.animForwards=0<=d.speed,this.cur_anim_speed=Math.abs(d.speed),this.cur_anim_repeatto=d.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(E,this.cur_animation.frames[this.cur_frame]),
this.runtime.redraw=!0)};D.doChangeAnimFrame=function(){var E=this.cur_animation.frames[this.cur_frame],d=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);d!==this.cur_frame&&(this.OnFrameChanged(E,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};D.OnFrameChanged=function(E,
d){var h=E.width,B=E.height,e=d.width,u=d.height;h!=e&&(this.width*=e/h);B!=u&&(this.height*=u/B);this.hotspotX=d.hotspotX;this.hotspotY=d.hotspotY;this.collision_poly.set_pts(d.poly_pts);this.set_bbox_changed();this.curFrame=d;this.curWebGLTexture=d.webGL_texture;h=0;for(B=this.behavior_insts.length;h<B;h++)if(e=this.behavior_insts[h],e.onSpriteFrameChanged)e.onSpriteFrameChanged(E,d);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};D.draw=function(E){E.globalAlpha=this.opacity;
var d=this.curFrame,h=d.spritesheeted,B=d.texture_img,e=this.x,u=this.y,F=this.width,H=this.height;if(0===this.angle&&0<=F&&0<=H)e-=this.hotspotX*F,u-=this.hotspotY*H,this.runtime.pixel_rounding&&(e=Math.round(e),u=Math.round(u)),h?E.drawImage(B,d.offx,d.offy,d.width,d.height,e,u,F,H):E.drawImage(B,e,u,F,H);else{this.runtime.pixel_rounding&&(e=Math.round(e),u=Math.round(u));E.save();var R=0<F?1:-1,S=0<H?1:-1;E.translate(e,u);1===R&&1===S||E.scale(R,S);E.rotate(this.angle*R*S);e=-(this.hotspotX*cr.abs(F));
u=-(this.hotspotY*cr.abs(H));h?E.drawImage(B,d.offx,d.offy,d.width,d.height,e,u,cr.abs(F),cr.abs(H)):E.drawImage(B,e,u,cr.abs(F),cr.abs(H));E.restore()}};D.drawGL_earlyZPass=function(E){this.drawGL(E)};D.drawGL=function(E){E.setTexture(this.curWebGLTexture);E.setOpacity(this.opacity);var d=this.curFrame,h=this.bquad;if(this.runtime.pixel_rounding){var B=Math.round(this.x)-this.x,e=Math.round(this.y)-this.y;d.spritesheeted?E.quadTex(h.tlx+B,h.tly+e,h.trx+B,h.try_+e,h.brx+B,h.bry+e,h.blx+B,h.bly+e,
d.sheetTex):E.quad(h.tlx+B,h.tly+e,h.trx+B,h.try_+e,h.brx+B,h.bry+e,h.blx+B,h.bly+e)}else d.spritesheeted?E.quadTex(h.tlx,h.tly,h.trx,h.try_,h.brx,h.bry,h.blx,h.bly,d.sheetTex):E.quad(h.tlx,h.tly,h.trx,h.try_,h.brx,h.bry,h.blx,h.bly)};D.getImagePointIndexByName=function(E){var d=this.curFrame,h;var B=0;for(h=d.image_points.length;B<h;B++)if(cr.equals_nocase(E,d.image_points[B][0]))return B;return-1};D.getImagePoint=function(E,d){var h=this.curFrame,B=h.image_points;var e=cr.is_string(E)?this.getImagePointIndexByName(E):
E-1;e=cr.floor(e);if(0>e||e>=B.length)return d?this.x:this.y;E=(B[e][1]-h.hotspotX)*this.width;B=B[e][2];B=(B-h.hotspotY)*this.height;h=Math.cos(this.angle);e=Math.sin(this.angle);var u=E*h-B*e;B=B*h+E*e;E=u+this.x;B+=this.y;return d?E:B};var z=[],G=-2,M=[];k.prototype.OnCollision=function(E){if(!E)return!1;var d=this.runtime,h=d.getCurrentCondition(),B=h.type,e=null;h.extra.collmemory?e=h.extra.collmemory:(e={},h.extra.collmemory=e);h.extra.spriteCreatedDestroyCallback||(h.extra.spriteCreatedDestroyCallback=
!0,d.addDestroyCallback(function(C){var w=h.extra.collmemory;C=C.uid;var I;for(I in w)if(w.hasOwnProperty(I)){var L=w[I];if(L[0]===C||L[1]===C)v(w[I]),delete w[I]}}));var u=B.getCurrentSol(),F=E.getCurrentSol();u=u.getObjects();var H,R,S=this.runtime.tickcount,V=S-1,T=d.getCurrentEventStack().current_event;for(H=0;H<u.length;H++){var Z=u[H];if(F.select_all){Z.update_bbox();this.runtime.getCollisionCandidates(Z.layer,E,Z.bbox,M);var aa=M;this.runtime.addRegisteredCollisionCandidates(Z,E,aa)}else aa=
F.getObjects();for(R=0;R<aa.length;R++){var f=aa[R];if(d.testOverlap(Z,f)||d.checkRegisteredCollision(Z,f)){var q=n(e,Z,f);q=!q||G<V;J(e,Z,f,S);if(q){d.pushCopySol(T.solModifiers);q=B.getCurrentSol();var x=E.getCurrentSol();q.select_all=!1;x.select_all=!1;B===E?(q.instances.length=2,q.instances[0]=Z,q.instances[1]=f,B.applySolToContainer()):(q.instances.length=1,x.instances.length=1,q.instances[0]=Z,x.instances[0]=f,B.applySolToContainer(),E.applySolToContainer());T.retrigger();d.popSol(T.solModifiers)}}else K(e,
Z,f)}cr.clearArray(M)}return!1};var l=null,r=new cr.ObjectSet,y=!1,N=[],Q=new cr.rect(0,0,0,0);m.finish=function(E){if(y){if(E){var d=this.runtime.getCurrentEventStack().current_event.orblock;E=l.getCurrentSol();var h=r.valuesRef(),B;if(E.select_all){E.select_all=!1;cr.clearArray(E.instances);var e=0;for(B=h.length;e<B;++e)E.instances[e]=h[e];if(d)for(cr.clearArray(E.else_instances),e=0,B=l.instances.length;e<B;++e)h=l.instances[e],r.contains(h)||E.else_instances.push(h)}else if(d)for(d=E.instances.length,
e=0,B=h.length;e<B;++e)E.instances[d+e]=h[e],cr.arrayFindRemove(E.else_instances,h[e]);else cr.shallowAssignArray(E.instances,h);l.applySolToContainer()}r.clear();y=!1}};k.prototype.IsOverlapping=function(E){return a.call(this,E,0,0)};k.prototype.IsOverlappingOffset=function(E,d,h){return a.call(this,E,d,h)};k.prototype.IsAnimPlaying=function(E){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,E):cr.equals_nocase(this.cur_animation.name,E)};k.prototype.CompareFrame=function(E,
d){return cr.do_cmp(this.cur_frame,E,d)};k.prototype.CompareAnimSpeed=function(E,d){return cr.do_cmp(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed,E,d)};k.prototype.OnAnimFinished=function(E){return cr.equals_nocase(this.animTriggerName,E)};k.prototype.OnAnyAnimFinished=function(){return!0};k.prototype.OnFrameChanged=function(){return!0};k.prototype.IsMirrored=function(){return 0>this.width};k.prototype.IsFlipped=function(){return 0>this.height};k.prototype.OnURLLoaded=function(){return!0};
k.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};p.cnds=new k;c.prototype.Spawn=function(E,d,h){if(E&&d&&(d=this.runtime.createInstance(E,d,this.getImagePoint(h,!0),this.getImagePoint(h,!1)))){"undefined"!==typeof d.angle&&(d.angle=this.angle,d.set_bbox_changed());this.runtime.isInOnDestroy++;var B;this.runtime.trigger(Object.getPrototypeOf(E.plugin).cnds.OnCreated,d);if(d.is_contained){var e=0;for(B=d.siblings.length;e<B;e++){var u=d.siblings[e];this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,
u)}}this.runtime.isInOnDestroy--;e=this.runtime.getCurrentAction();h=!1;if(cr.is_undefined(e.extra.Spawn_LastExec)||e.extra.Spawn_LastExec<this.runtime.execcount)h=!0,e.extra.Spawn_LastExec=this.runtime.execcount;if(E!=this.type&&(E=E.getCurrentSol(),E.select_all=!1,h?(cr.clearArray(E.instances),E.instances[0]=d):E.instances.push(d),d.is_contained))for(e=0,B=d.siblings.length;e<B;e++)u=d.siblings[e],E=u.type.getCurrentSol(),E.select_all=!1,h?(cr.clearArray(E.instances),E.instances[0]=u):E.instances.push(u)}};
c.prototype.SetEffect=function(E){this.blend_mode=E;this.compositeOp=cr.effectToCompositeOp(E);cr.setGLBlend(this,E,this.runtime.gl);this.runtime.redraw=!0};c.prototype.StopAnim=function(){this.animPlaying=!1};c.prototype.StartAnim=function(E){this.animPlaying=!0;this.frameStart=this.getNowTime();1===E&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnim=function(E,d){this.changeAnimName=
E;this.changeAnimFrom=d;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};c.prototype.SetAnimFrame=function(E){this.changeAnimFrame=E;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};c.prototype.SetAnimSpeed=function(E){this.cur_anim_speed=cr.abs(E);this.animForwards=0<=E;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnimRepeatToFrame=function(E){E=Math.floor(E);
0>E&&(E=0);E>=this.cur_animation.frames.length&&(E=this.cur_animation.frames.length-1);this.cur_anim_repeatto=E};c.prototype.SetMirrored=function(E){E=cr.abs(this.width)*(0===E?-1:1);this.width!==E&&(this.width=E,this.set_bbox_changed())};c.prototype.SetFlipped=function(E){E=cr.abs(this.height)*(0===E?-1:1);this.height!==E&&(this.height=E,this.set_bbox_changed())};c.prototype.SetScale=function(E){var d=this.curFrame,h=d.width*E*(0>this.width?-1:1);E=d.height*E*(0>this.height?-1:1);if(this.width!==
h||this.height!==E)this.width=h,this.height=E,this.set_bbox_changed()};c.prototype.LoadURL=function(E,d,h){var B=new Image,e=this,u=this.curFrame;B.onload=function(){u.texture_img.src===B.src?e.runtime.glwrap&&e.curFrame===u&&(e.curWebGLTexture=u.webGL_texture):(u.texture_img=B,u.offx=0,u.offy=0,u.width=B.width,u.height=B.height,u.spritesheeted=!1,u.datauri="",u.pixelformat=0,e.runtime.glwrap&&(u.webGL_texture&&e.runtime.glwrap.deleteTexture(u.webGL_texture),u.webGL_texture=e.runtime.glwrap.loadTexture(B,
!1,e.runtime.linearSampling),e.curFrame===u&&(e.curWebGLTexture=u.webGL_texture),e.type.updateAllCurrentTexture()));0===d&&(e.width=B.width,e.height=B.height,e.set_bbox_changed());e.runtime.redraw=!0;e.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,e)};"data:"!==E.substr(0,5)&&0===h&&(B.crossOrigin="anonymous");this.runtime.setImageSrc(B,E)};c.prototype.SetCollisions=function(E){this.collisionsEnabled!==(0!==E)&&((this.collisionsEnabled=0!==E)?this.set_bbox_changed():(this.collcells.right>=
this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};p.acts=new c;g.prototype.AnimationFrame=function(E){E.set_int(this.cur_frame)};g.prototype.AnimationFrameCount=function(E){E.set_int(this.cur_animation.frames.length)};g.prototype.AnimationName=function(E){E.set_string(this.cur_animation.name)};g.prototype.AnimationSpeed=function(E){E.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};g.prototype.ImagePointX=function(E,
d){E.set_float(this.getImagePoint(d,!0))};g.prototype.ImagePointY=function(E,d){E.set_float(this.getImagePoint(d,!1))};g.prototype.ImagePointCount=function(E){E.set_int(this.curFrame.image_points.length)};g.prototype.ImageWidth=function(E){E.set_float(this.curFrame.width)};g.prototype.ImageHeight=function(E){E.set_float(this.curFrame.height)};p.exps=new g})();cr.plugins_.TextBox=function(b){this.runtime=b};
(function(){function b(){}function k(){}function v(){}var A=cr.plugins_.TextBox.prototype;A.Type=function(n){this.plugin=n;this.runtime=n.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(n){this.type=n;this.runtime=n.runtime};var J=A.Instance.prototype,K="text password email number tel url textarea search".split(" ");-1<navigator.userAgent.indexOf("MSIE 9")&&(K[2]="text",K[3]="text",K[4]="text",K[5]="text",K[7]="text");J.onCreate=function(){6===this.properties[7]?(this.elem=document.createElement("textarea"),
this.elem.style.resize="none"):(this.elem=document.createElement("input"),this.elem.type=K[this.properties[7]]);this.elem.id=this.properties[9];document.body.appendChild(this.elem);this.elem.autocomplete="off";this.elem.value=this.properties[0];this.elem.placeholder=this.properties[1];this.elem.title=this.properties[2];this.elem.disabled=!this.properties[4];this.elem.readOnly=this.properties[5];this.elem.spellcheck=this.properties[6];this.autoFontSize=this.properties[8];this.element_hidden=!1;this.properties[3]||
(this.elem.style.display="none",this.visible=!1,this.element_hidden=!0);var n=function(a){return function(){a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnTextChanged,a)}}(this);this.elem.oninput=n;-1!==navigator.userAgent.indexOf("MSIE")&&(this.elem.oncut=n);this.elem.onclick=function(a){return function(c){c.stopPropagation();a.runtime.isInUserInputEvent=!0;a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnClicked,a);a.runtime.isInUserInputEvent=!1}}(this);this.elem.ondblclick=function(a){return function(c){c.stopPropagation();
a.runtime.isInUserInputEvent=!0;a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnDoubleClicked,a);a.runtime.isInUserInputEvent=!1}}(this);this.elem.addEventListener("touchstart",function(a){a.stopPropagation()},!1);this.elem.addEventListener("touchmove",function(a){a.stopPropagation()},!1);this.elem.addEventListener("touchend",function(a){a.stopPropagation()},!1);this.elem.addEventListener("mousedown",function(a){a.stopPropagation()});this.elem.addEventListener("mouseup",function(a){a.stopPropagation()});
this.elem.addEventListener("keydown",function(a){13!==a.which&&27!=a.which&&a.stopPropagation()});this.elem.addEventListener("keyup",function(a){13!==a.which&&27!=a.which&&a.stopPropagation()});this.lastWinHeight=this.lastWinWidth=this.lastBottom=this.lastRight=this.lastTop=this.lastLeft=0;this.updatePosition(!0);this.runtime.tickMe(this)};J.saveToJSON=function(){return{text:this.elem.value,placeholder:this.elem.placeholder,tooltip:this.elem.title,disabled:!!this.elem.disabled,readonly:!!this.elem.readOnly,
spellcheck:!!this.elem.spellcheck}};J.loadFromJSON=function(n){this.elem.value=n.text;this.elem.placeholder=n.placeholder;this.elem.title=n.tooltip;this.elem.disabled=n.disabled;this.elem.readOnly=n.readonly;this.elem.spellcheck=n.spellcheck};J.onDestroy=function(){this.elem.parentElement.removeChild(this.elem);this.elem=null};J.tick=function(){this.updatePosition()};J.updatePosition=function(n){var a=this.layer.layerToCanvas(this.x,this.y,!0),c=this.layer.layerToCanvas(this.x,this.y,!1),g=this.layer.layerToCanvas(this.x+
this.width,this.y+this.height,!0),p=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),m=this.runtime.width/this.runtime.devicePixelRatio,t=this.runtime.height/this.runtime.devicePixelRatio;!this.visible||!this.layer.visible||0>=g||0>=p||a>=m||c>=t?(this.element_hidden||(this.elem.style.display="none"),this.element_hidden=!0):(1>a&&(a=1),1>c&&(c=1),g>=m&&(g=m-1),p>=t&&(p=t-1),m=window.innerWidth,t=window.innerHeight,n||this.lastLeft!==a||this.lastTop!==c||this.lastRight!==g||this.lastBottom!==
p||this.lastWinWidth!==m||this.lastWinHeight!==t?(this.lastLeft=a,this.lastTop=c,this.lastRight=g,this.lastBottom=p,this.lastWinWidth=m,this.lastWinHeight=t,this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1),n=Math.round(a)+this.runtime.canvas.offsetLeft,m=Math.round(c)+this.runtime.canvas.offsetTop,this.elem.style.position="absolute",this.elem.style.left=n+"px",this.elem.style.top=m+"px",this.elem.style.width=Math.round(g-a)+"px",this.elem.style.height=Math.round(p-c)+"px",
this.autoFontSize&&(this.elem.style.fontSize=this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")):this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1))};J.draw=function(n){};J.drawGL=function(n){};b.prototype.CompareText=function(n,a){return 0===a?cr.equals_nocase(this.elem.value,n):this.elem.value===n};b.prototype.OnTextChanged=function(){return!0};b.prototype.OnClicked=function(){return!0};b.prototype.OnDoubleClicked=function(){return!0};A.cnds=new b;k.prototype.SetText=
function(n){this.elem.value=n};k.prototype.SetPlaceholder=function(n){this.elem.placeholder=n};k.prototype.SetTooltip=function(n){this.elem.title=n};k.prototype.SetReadOnly=function(n){this.elem.readOnly=0===n};k.prototype.ScrollToBottom=function(){this.elem.scrollTop=this.elem.scrollHeight};A.acts=new k;v.prototype.Text=function(n){n.set_string(this.elem.value)};A.exps=new v})();
cr.getObjectRefTable=function(){return[cr.plugins_.Text,cr.plugins_.AJAX,cr.plugins_.Arr,cr.plugins_.Function,cr.plugins_.Touch,cr.plugins_.WebStorage,cr.plugins_.TiledBg,cr.plugins_.Sprite,cr.plugins_.TextBox,cr.system_object.prototype.cnds.OnLayoutStart,cr.system_object.prototype.acts.ResetGlobals,cr.plugins_.AJAX.prototype.acts.Request,cr.plugins_.Text.prototype.acts.SetText,cr.plugins_.Function.prototype.acts.CallFunction,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.Function.prototype.cnds.OnFunction,
cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.exps.trim,cr.system_object.prototype.exps.tokenat,cr.plugins_.Arr.prototype.exps.At,cr.system_object.prototype.acts.SetVar,cr.system_object.prototype.cnds.Else,cr.system_object.prototype.cnds.For,cr.plugins_.Arr.prototype.acts.SetX,cr.plugins_.AJAX.prototype.exps.LastData,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.Text.prototype.exps.Text,cr.plugins_.Function.prototype.exps.Param,
cr.plugins_.Text.prototype.acts.SetVisible,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.cnds.Every,cr.system_object.prototype.acts.SubVar,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.exps.random,cr.system_object.prototype.cnds.While,cr.system_object.prototype.cnds.Compare,cr.plugins_.Arr.prototype.cnds.ArrForEach,cr.plugins_.Arr.prototype.exps.CurX,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,
cr.system_object.prototype.exps.zeropad,cr.plugins_.TextBox.prototype.cnds.OnTextChanged,cr.plugins_.TextBox.prototype.acts.SetEnabled,cr.system_object.prototype.cnds.RegexTest,cr.plugins_.TextBox.prototype.exps.Text,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.exps.len,cr.plugins_.TextBox.prototype.acts.SetText,cr.system_object.prototype.exps.left,cr.system_object.prototype.exps.urlencode,cr.plugins_.AJAX.prototype.acts.Post,cr.plugins_.Sprite.prototype.acts.Destroy]};
self.C3_JsPropNameTable=[{QuestionText:0},{AnswerChoice1:0},{AnswerChoice2:0},{AnswerChoice3:0},{AnswerChoice4:0},{AJAX:0},{QuestionsArray:0},{Function:0},{Touch:0},{FeedbackText:0},{ScoreText:0},{TitleText:0},{PlayButton:0},{WebStorage:0},{QuitButton:0},{RestartButton:0},{TimerText:0},{Used_Array:0},{TiledBackground:0},{HomeButton:0},{AboutText:0},{AboutButton:0},{Sprite11:0},{play_again:0},{Sprite18:0},{Sprite12:0},{NameInput:0},{EmailInput:0},{PhoneInput:0},{NameText:0},{EmailText:0},{Text2:0},
{Confirmation:0},{Display:0},{Discore:0},{final:0},{replay:0},{home:0},{Top_10:0},{submit_button:0},{order_id:0},{Logo:0},{count:0},{Is_Answered:0},{Point:0},{random_number:0},{questions_asked:0},{current_answer:0},{questions_file_name:0},{point_bonus:0},{timer:0},{number_of_questions:0},{Game_Name:0},{SECONDSPERTICK:0},{s:0},{web_app_url:0},{stop:0},{value0:0},{value1:0},{value2:0},{sum:0},{string0:0},{string1:0},{string2:0}];